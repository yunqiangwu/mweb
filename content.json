[{"title":"ä»€ä¹ˆæ˜¯ wasm(webassembly) æŠ€æœ¯","date":"2022-07-10T12:08:58.000Z","path":"2022/07/10/wasm/","text":"ä»€ä¹ˆæ˜¯ wasm wasi wapm æŠ€æœ¯ä»€ä¹ˆæ˜¯ wasm wasmå®˜ç½‘: https://webassembly.org/ wasm å…¨ç§° WebAssemblyï¼Œæ˜¯ä¸€ç§é€šç”¨å­—èŠ‚ç çš„æŠ€æœ¯ï¼Œé€šè¿‡è¯¥æŠ€æœ¯å°†å…¶ä»–è¯­è¨€ï¼ˆæ¯”å¦‚ go, rust, c&#x2F;c++, ç­‰ï¼‰çš„ç¨‹åºä»£ç ç¼–è¯‘æˆå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œçš„å­—èŠ‚ç ç¨‹åºã€‚å› ä¸ºè¯¥ WebAssembly æ˜¯ä¸€ç§å­—é€šç”¨çš„èŠ‚ç æŠ€æœ¯è§„èŒƒï¼Œæ‰€ä»¥ WebAssembly ä¸ä»…ä»…å¯ä»¥åœ¨æµè§ˆå™¨æ‰§è¡Œï¼Œè¿˜å¯ä»¥åœ¨å…¶ä»–å˜æˆè¯­è¨€ç¯å¢ƒä¸­æ‰§è¡Œï¼Œæ¯”å¦‚ ï¼Œpythonï¼Œ cï¼Œgoï¼Œ rustï¼Œç­‰. ä¸ºä»€ä¹ˆéœ€è¦æä¸€ä¸ª wasm å­—èŠ‚ç ï¼Œä¸èƒ½æ‰€ä»¥å¹³å°éƒ½ç”¨ js åšä¸º é€šç”¨ç¼–ç æŠ€æœ¯å—ï¼Ÿç†è®ºä¸Š åœ¨å…¶ä»–è¯­è¨€ç¯å¢ƒä¸­å®ç° js æ‰§è¡Œå¼•æ“ï¼Œ æ˜¯å¯ä»¥æŠŠ js åšä¸ºä¸€ä¸ª é€šç”¨ç¼–ç æŠ€æœ¯çš„ã€‚é‚£ä¸ºä»€ä¹ˆè¿˜éœ€åšä¸€ä¸ª wasm å‡ºæ¥å‘¢ã€‚ æˆ‘è®¤ä¸ºæœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š js ä»£ç æ˜¯æ–‡æœ¬æ–‡ä»¶æ ¼å¼ã€‚åœ¨ web ç¯å¢ƒä¸‹ï¼Œç½‘ç»œä¼ è¾“æ•ˆç‡è¿œè¿œä¸å¦‚ wasm äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ã€‚ js ç›¸å¯¹äº c å’Œ rust ï¼Œè€Œå·²ï¼Œæ˜¯ä¸€ç§å¼±ç±»å‹è¯­è¨€ï¼Œå†™ä»£ç æ²¡æœ‰ä¸¥æ ¼ç±»å‹æ ¡éªŒï¼Œå®¹æ˜“å†™æˆä¸ç¨³å®šçš„ä»£ç ã€‚ js æ˜¯æœ‰ GC(è‡ªåŠ¨åƒåœ¾æ¸…ç†åŠŸèƒ½)ï¼Œç”¨æˆ·ä¸ç”¨å…³æ³¨å†…å­˜çš„å¤„ç†ï¼Œå¯¼è‡´çš„ç»“æœå°±æ˜¯ GC å¤„ç†è¿‡ç¨‹ä¸¥é‡æ‹–æ…¢æ€§èƒ½ï¼Œ è€Œä¸”ç”±äºæ˜¯ç³»ç»Ÿ GCï¼Œ ç”¨æˆ·å¾ˆéš¾ç²¾ç¡®æ§åˆ¶å†…å­˜ã€‚å®¹æ˜“å¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ã€‚ js æ˜¯æ–‡æœ¬è§£æå‹ç¼–ç¨‹è¯­è¨€ï¼Œæ–‡æœ¬è§£ææ•ˆç‡ä½ï¼Œwasm äºŒè¿›åˆ¶ä»£ç è§£ææ‰§è¡Œæ•ˆç‡ä¼šé«˜äº jsã€‚ js ç”±äºå†å²åŸå› ï¼Œjs æœ¬èº«å°±å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼ˆjs ä¹‹çˆ¶è¯´çš„ï¼‰ï¼Œè€Œä¸” js å¼•æ“éœ€è¦å®ç°çš„æˆæœ¬è¿‡é«˜ï¼Œ wasm çš„æ‰§è¡Œå¼•æ“å¯ä»¥è¯´æ˜¯ æ¯” js æ–°çš„äº§ç‰©ï¼Œ åœ¨è®¾è®¡ wasm å­—èŠ‚ç çš„æ—¶å€™ï¼Œè€ƒè™‘å„ä¸ªæ–¹ä¾¿æ¯”è¾ƒå®Œå–„ï¼Œæ¼æ´ä¹Ÿæ¯”è¾ƒå°‘ã€‚ ä»€ä¹ˆæ˜¯ wasi wasiå®˜ç½‘: https://wasi.dev/ wasi å…¨ç§° The WebAssembly System Interface é€šä¿—æ¥è®²å°±æ˜¯ä¸€ä¸ªå¯¹æ¥è§„èŒƒã€‚ å°±åƒå‰åç«¯åˆ†ç¦»çš„ RestFul ç±»ä¼¼ï¼Œåªè¦å‰åç«¯çº¦å®šä¸€å¥— RESTful æ¥å£å¯¹æ¥è§„èŒƒ ï¼Œæ— è®ºå‰ç«¯ä½¿ç”¨çš„æ¡†æ¶æ˜¯ jQuery æˆ– vue æˆ– react ï¼Œ æ— è®ºåç«¯ä½¿ç”¨ java node.js æˆ–è€… java è¿˜æ˜¯ goã€‚ éƒ½å¯ä»¥è¿›è¡Œå‰åç«¯é€šä¿¡ã€‚ wasi ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œ wasi çº¦å®šäº†ä¹Ÿè¡Œå‡½æ•°æ¥å£ï¼Œä¸åŒçš„è¯­è¨€ä»£ç çš„ç”Ÿæˆçš„å­—èŠ‚ç è§„åˆ™æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å…¶ä»–å¹³å°æ‰§è¡Œè¿™ä¸ªå­—èŠ‚ç ã€‚ ä¸¾ä¸ªæ —å­ï¼š æ¯”å¦‚æˆ‘ç”¨ cè¯­è¨€ å†™äº†ä¸€ä¸ªç¨‹åºï¼Œè¯»å–æŸä¸ªæ–‡ä»¶ï¼Œ æŠŠæ–‡ä»¶å†…å®¹è¾“å‡ºåˆ°å±å¹•ã€‚ ç„¶åæˆ‘æŠŠè¿™ä¸ªç¨‹åºç¼–è¯‘æˆ wasm å­—èŠ‚ç ã€‚ ç„¶åè®© web æµè§ˆå™¨å»æ‰§è¡Œã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ æµè§ˆå™¨æ˜¯ä¸å¯ä»¥ç›´æ¥è¯»å–ç³»ç»Ÿæ–‡ä»¶çš„ã€‚é‚£ä¹ˆ web æµè§ˆå™¨åº”è¯¥å¦‚ä½•å»æ‰§è¡Œè¿™ä¸ªå­—èŠ‚ç ç¨‹åºå‘¢ï¼Ÿ é€šè¿‡ wasi (åæ–‡ä¼šä»‹ç») åè®®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ æµè§ˆå™¨ç¯å¢ƒä¸­ç”¨ JavaScript å†™ è¯»å–æ–‡ä»¶çš„ API å›è°ƒå‡½æ•°ï¼Œç„¶ååœ¨æ‰§è¡Œå­—èŠ‚ç ç¨‹åºä¹‹å‰ï¼ŒæŠŠè¿™ä¸ª options ä¼ ç»™ wasm æ‰§è¡Œå¼•æ“ã€‚ js ä¸­å¯ä»¥å®ç° æ–‡ä»¶è¯»å–é€»è¾‘ï¼ˆå¯èƒ½æ˜¯ä»ç½‘ç»œä¸­è¯»å–ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€æ®µå­—ç¬¦ä¸²ï¼‰ã€‚ ç„¶å web æµè§ˆå™¨ å°±å¯ä»¥æ— éšœç¢çš„æ‰§è¡Œè¿™æ®µ å­—èŠ‚ç ç¨‹åºäº†ã€‚ wasmçš„å¥½å¤„: å¯ä»¥ç§»æ¤å…¶ä»–å¹³å°çš„ä»£ç ç»™ä¸åŒå¹³å°æ‰§è¡Œï¼ˆè·¨å¹³å°è·¨è¯­è¨€æ‰§è¡Œèƒ½åŠ›ï¼‰ å¯ä»¥ç”¨åˆ°å…¶ä»–è¯­è¨€çš„ç‰¹æ€§ï¼Œç»™æµè§ˆå™¨æ‰§è¡Œç¯å¢ƒèµ‹èƒ½ï¼Œæ¯”å¦‚é€šè¿‡ rust ç”Ÿæˆçš„ wasmï¼Œæœ‰æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜å®‰å…¨ç‰¹æ€§ã€‚ é€šè¿‡ wasi å¯ä»¥åœ¨æµè§ˆå™¨ç«¯å®ç°æ¨¡æ‹Ÿ æ–‡ä»¶ç³»ç»Ÿï¼Œ sock ç½‘ç»œæœåŠ¡ç­‰ï¼Œ å®ç°ç±»ä¼¼ webide å¦‚ä½•ç”Ÿæˆ wasm å­—èŠ‚ç ç¨‹åºå› ä¸º wasm æ˜¯ä¸€ç§é€šç”¨çš„å­—èŠ‚ç äº¤äº’æŠ€æœ¯ï¼Œå¤§éƒ¨åˆ†æµè¡Œçš„è¯­è¨€çš„ç¯å¢ƒçš„ sdk å·¥å…·åŒ…ä¸­å°±å†…ç½®äº† wasm ç›¸å…³çš„å·¥å…·ã€‚ æ¯”å¦‚ go è¯­è¨€ä¸­å¯ä»¥é€š GOOS=js GOARCH=wasm go build -o static/main.wasm ç”Ÿæˆ wasm å­—èŠ‚ç ç¨‹åºã€‚ å¦å¤–è¿˜æœ‰å…¶ä»–ç¬¬ä¸‰æ–¹æˆ–è€… wasmå®˜æ–¹çš„å·¥å…·ã€‚ç›®å‰æ¯”è¾ƒé€šç”¨çš„ä¸€ä¸ªå·¥å…·æ˜¯ï¼šwasmtime wasmtimeå®˜ç½‘æ–‡æ¡£: https://docs.wasmtime.dev/ è¿™é‡Œç®€å•ä¸¾ä¸ªæ —å­ ç”¨ Rust ç”Ÿæˆå­—èŠ‚ç ã€‚ ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦å®‰è£… Rust è¯­è¨€ç¯å¢ƒï¼š å®‰è£… rust æ–‡æ¡£ ç¬¬äºŒæ­¥ å®‰è£… rust çš„ wasm å·¥å…· 1$ cargo install cargo-wasi ç¬¬ä¸‰æ­¥ åˆ›å»º rust hello é¡¹ç›® 12$ cargo new hello-world$ cd hello-world ä¿®æ”¹ src&#x2F;main.rs æ·»åŠ å¯¼å‡ºå‡½æ•° 123pub fn main() &#123; println!(&quot;Hello, world! wasm!&quot;);&#125; è°ƒè¯•è¿è¡Œ rust wasi å­—èŠ‚ç ç¨‹åº 123456789$ cargo wasi runinfo: downloading component &#x27;rust-std&#x27; for &#x27;wasm32-wasi&#x27;info: installing component &#x27;rust-std&#x27; for &#x27;wasm32-wasi&#x27; Compiling hello-world v0.1.0 (/hello-world) Finished dev [unoptimized + debuginfo] target(s) in 0.16s Running `/.cargo/bin/cargo-wasi target/wasm32-wasi/debug/hello-world.wasm` Running `target/wasm32-wasi/debug/hello-world.wasm`Hello, world! é€šè¿‡ wasmtime å·¥å…· è¿è¡Œ wasi å­—èŠ‚ç ç¨‹åºã€‚ éœ€è¦å®‰è£… wasmtime å·¥å…·ï¼Œ å®‰è£…æ–‡æ¡£ï¼šhttps://docs.wasmtime.dev/cli-install.html 12wasmtime target/wasm32-wasi/debug/hello-world.wasmHello, world! åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬å°±å®ç°ç”Ÿæˆäº† wasm å­—èŠ‚ç ç¨‹åºäº† ä¸ºä»€ä¹ˆæˆ‘æ›´æ¨èä½¿ç”¨ rust å­—èŠ‚ç ç¨‹åºã€‚å› ä¸º rust æ˜¯ä¸€ç§å¼ºç±»å‹ï¼Œæ€§èƒ½æ¯”è¾ƒä¼˜ç§€çš„çš„ ç¼–ç¨‹è¯­è¨€ã€‚ å’Œ c è¯­è¨€ä¸€æ ·æ²¡æœ‰ gcï¼Œä½†æ˜¯ rust åœ¨å†…å­˜æ“ä½œæ–¹é¢ï¼Œrust ç¼–è¯‘å™¨æœ‰ä¼˜ç§€çš„ è¯­æ³•æ£€æŸ¥æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥è®©ç”¨æˆ·å†™å‡ºä¼˜ç§€çš„å†…å­˜å®‰å…¨ä»£ç ã€‚ è€Œä¸” rust å’Œ c è¯­è¨€ç›¸æ¯”ï¼Œ ç”±äº rust æ˜¯åè¾ˆï¼Œ æ‰€ä»¥ rust æœ‰å¾ˆå¤šæ–°çš„ç°ä»£è¯­è¨€ç‰¹æ€§ï¼Œ å¯ä»¥é€šè¿‡ç®€å•çš„ä»£ç è¯­æ³•ç³–ï¼Œå®ç° cè¯­è¨€çš„éœ€è¦å¾ˆå¤šä»£ç å®ç°çš„åŠŸèƒ½ã€‚ å¦‚ä½•åœ¨ nodejs ç¯å¢ƒæ‰§è¡Œ wasm ä»£ç nodejs 16 å†…ç½®äº† WebAssembly API åœ¨ åˆšåˆšçš„ rust é¡¹ç›®ä¸‹ï¼Œ åˆ›å»º ä¸€ä¸ª test.js è„šæœ¬ï¼Œ å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116(async () =&gt; &#123; try&#123; const fs = require(&#x27;fs&#x27;); const path = require(&#x27;path&#x27;); // å®šä¹‰ wasm ç¯å¢ƒå˜é‡ const env = &#123; PWD: &#x27;/&#x27; &#125;; // wasm å†…å­˜æ“ä½œå¯¹è±¡ let thisView = null; // wasm ç¨‹åºæ¥å£å¯¹è±¡ let wasmRes = null; // wasm å†…å­˜å¯¹è±¡ let thisMemory = null; // æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ç¼“å­˜å˜é‡ let consoleLogData = &#x27;&#x27;; const refreshMemory = () =&gt; &#123; if (!thisView || thisView.buffer.byteLength === 0) &#123; thisView = new DataView(thisMemory.buffer); &#125; &#125; const getiovs = (iovs, iovsLen) =&gt; &#123; refreshMemory(); const buffers = Array.from(&#123; length: iovsLen &#125;, (_, i) =&gt; &#123; const ptr = iovs + i * 8; const buf = thisView.getUint32(ptr, true); const bufLen = thisView.getUint32(ptr + 4, true); return new Uint8Array(thisMemory.buffer, buf, bufLen); &#125;); return buffers; &#125;; function Uint8ArrayToString(fileData)&#123; var dataString = &quot;&quot;; for (var i = 0; i &lt; fileData.length; i++) &#123; dataString += String.fromCharCode(fileData[i]); &#125; return dataString &#125; const importObject = &#123; wasi_snapshot_preview1: &#123; fd_write: (fd, iovs, iovsLen, nwritten) =&gt; &#123; let written = 0; const buffers = getiovs(iovs, iovsLen); buffers.forEach(buffer =&gt; &#123; consoleLogData+= Uint8ArrayToString(buffer); written+=buffer.length; &#125;); thisView.setUint32(nwritten, written, true); return 0; &#125;, environ_get: (environ, environBuf) =&gt; &#123; refreshMemory(); let coffset = environ; let offset = environBuf; Object.entries(env).forEach(([key, value]) =&gt; &#123; thisView.setUint32(coffset, offset, true); coffset += 4; offset += Buffer.from(thisMemory.buffer).write( `$&#123;key&#125;=$&#123;value&#125;\\0`, offset ); &#125;); return 0; &#125;, environ_sizes_get: (environCount, environBufSize) =&gt; &#123; refreshMemory(); const envProcessed = Object.entries(env).map( ([key, value]) =&gt; `$&#123;key&#125;=$&#123;value&#125;\\0` ); const size = envProcessed.reduce( (acc, e) =&gt; acc + Buffer.byteLength(e), 0 ); thisView.setUint32(environCount, envProcessed.length, true); thisView.setUint32(environBufSize, size, true); return 0; &#125;, proc_exit: (rval) =&gt; &#123; return 0; &#125;, &#125; &#125;; const wasmFileBuffer = fs.readFileSync(path.join(__dirname, &#x27;target/wasm32-wasi/debug/code-stock.wasm&#x27;)); wasmRes = await WebAssembly.instantiate(wasmFileBuffer, importObject); thisMemory = wasmRes.instance.exports.memory; // wasmRes.instance.exports._start &amp;&amp; wasmRes.instance.exports._start(); wasmRes.instance.exports.main(); console.log(&#123; consoleLogData, &#125;); &#125; catch(e) &#123; console.error(e); &#125;&#125;)(); ç„¶åç›´æ¥é€šè¿‡ node test.js æ—¢å¯æ‰§è¡Œ wasm ä»£ç  å¦‚ä½•åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ wasm ç¨‹åºç›®å‰æ–°ç‰ˆæœ¬çš„ç°ä»£æµè§ˆå™¨åŸºæœ¬ä¸Šéƒ½æœ‰ WebAssembly API 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108(async () =&gt; &#123; try&#123; const env = &#123; PWD: &#x27;/&#x27; &#125;; let thisView = null; let wasmRes = null; let thisMemory = null; let consoleLogData = &#x27;&#x27;; const refreshMemory = () =&gt; &#123; if (!thisView || thisView.buffer.byteLength === 0) &#123; thisView = new DataView(thisMemory.buffer); &#125; &#125; const getiovs = (iovs, iovsLen) =&gt; &#123; refreshMemory(); const buffers = Array.from(&#123; length: iovsLen &#125;, (_, i) =&gt; &#123; const ptr = iovs + i * 8; const buf = thisView.getUint32(ptr, true); const bufLen = thisView.getUint32(ptr + 4, true); return new Uint8Array(thisMemory.buffer, buf, bufLen); &#125;); return buffers; &#125;; function Uint8ArrayToString(fileData)&#123; var dataString = &quot;&quot;; for (var i = 0; i &lt; fileData.length; i++) &#123; dataString += String.fromCharCode(fileData[i]); &#125; return dataString &#125; const importObject = &#123; wasi_snapshot_preview1: &#123; fd_write: (fd, iovs, iovsLen, nwritten) =&gt; &#123; let written = 0; const buffers = getiovs(iovs, iovsLen); buffers.forEach(buffer =&gt; &#123; consoleLogData+= Uint8ArrayToString(buffer); written+=buffer.length; &#125;); thisView.setUint32(nwritten, written, true); return 0; &#125;, environ_get: (environ, environBuf) =&gt; &#123; refreshMemory(); let coffset = environ; let offset = environBuf; Object.entries(env).forEach(([key, value]) =&gt; &#123; thisView.setUint32(coffset, offset, true); coffset += 4; offset += Buffer.from(thisMemory.buffer).write( `$&#123;key&#125;=$&#123;value&#125;\\0`, offset ); &#125;); return 0; &#125;, environ_sizes_get: (environCount, environBufSize) =&gt; &#123; refreshMemory(); const envProcessed = Object.entries(env).map( ([key, value]) =&gt; `$&#123;key&#125;=$&#123;value&#125;\\0` ); const size = envProcessed.reduce( (acc, e) =&gt; acc + Buffer.byteLength(e), 0 ); thisView.setUint32(environCount, envProcessed.length, true); thisView.setUint32(environBufSize, size, true); return 0; &#125;, proc_exit: (rval) =&gt; &#123; return 0; &#125;, &#125; &#125;; const wasmFileBuffer = fetch(&#x27;target/wasm32-wasi/debug/code-stock.wasm&#x27;); wasmRes = await WebAssembly.instantiate(wasmFileBuffer, importObject); thisMemory = wasmRes.instance.exports.memory; // wasmRes.instance.exports._start &amp;&amp; wasmRes.instance.exports._start(); wasmRes.instance.exports.main(); console.log(&#123; consoleLogData, &#125;); &#125; catch(e) &#123; console.error(e); &#125;&#125;)(); ä»€ä¹ˆæ˜¯ wapm wampå®˜ç½‘: https://wapm.io/ wapm å…¨ç§°æ˜¯ webassembly Package management , æ˜¯ä¸€ä¸ªçº¿ä¸Šçš„ wasm äºŒè¿›åˆ¶åŒ…ç®¡ç†ä»“åº“ã€‚ä½œç”¨ç±»ä¼¼äº node.js çš„ npm æˆ– java çš„ maven æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªä»“åº“ä¸Š å‘å¸ƒè‡ªå·±çš„ wasm ç¨‹åºï¼Œæˆ–è€…ä¸‹è½½è¿è¡Œåˆ«äººå‘å¸ƒçš„ wasm ç¨‹åºã€‚ git repo rust ç”Ÿæˆ wams: https://github.com/yunqiangwu/wasmide/tree/main/rust/code-stock node.js è°ƒç”¨ wamsï¼š https://github.com/yunqiangwu/wasmide/blob/main/rust/code-stock/test.js æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ wams: https://github.com/yunqiangwu/wasmide/tree/main/ui","tags":[{"name":"wasm webassembly nodejs","slug":"wasm-webassembly-nodejs","permalink":"http://blog.jajabjbj.top/tags/wasm-webassembly-nodejs/"}]},{"title":"å‰ç«¯æŒç»­é›†æˆç¯å¢ƒæ­å»º","date":"2020-02-19T00:00:00.000Z","path":"2020/02/19/2020-02-19/","text":"jenkins + nginx å®ç°æŒç»­é›†æˆæ­å»ºjenkinsjenkins æ˜¯ä¸€ä¸ªå¼€æºæŒç»­é›†æˆå·¥å…·ï¼Œå®‰è£…éå¸¸ç®€å•ï¼Œä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œè¿™é‡Œä½¿ç”¨ docker è¿›è¡Œå®‰è£…ã€‚ å®‰è£… dockercentos å®‰è£… docker 1sudo yum install docker å¯åŠ¨ docker æœåŠ¡ 1sudo systemctl start docker å®‰è£… jenkinsåˆ›å»º jenkins æ•°æ®æŒä¹…åŒ–ç›®å½• 123sudo mkdir -p /datasudo chmod 777 /datamkdir -p /data/jenkins_home é€šè¿‡dockerå®¹å™¨å®‰è£…jenkins 12345678910docker run \\ -u root \\ --rm \\ --name jenkins-server \\ -d \\ -p 8080:8080 \\ -p 50000:50000 \\ -v /data/jenkins_home:/var/jenkins_home \\ -v /var/run/docker.sock:/var/run/docker.sock \\ registry.cn-hangzhou.aliyuncs.com/hzero-cli/jenkins å…³äº docker å‘½ä»¤çš„å­¦ä¹ å¯ä»¥çœ‹è¿™é‡Œ ğŸ‘‰ Docker å‘½ä»¤å¤§å…¨ ä¸Šé¢å‘½ä»¤è¿è¡Œå®Œæˆä¹‹åæˆ‘ä»¬å°±å·²ç»æˆåŠŸè¿è¡Œäº† jenkins æœåŠ¡ æˆ‘ä»¬å¯ä»¥æ‰“å¼€åœ°å€ https:&#x2F;&#x2F;centosæœåŠ¡å™¨ip:8080ï¼Œå¯ä»¥çœ‹åˆ° jenkins çš„ç•Œé¢ã€‚ è¿™é‡Œçš„ centosæœåŠ¡å™¨ip å°±æ˜¯ä½ è‡ªå·±çš„æœåŠ¡å™¨ ipï¼Œåœ¨è¿™ä¸ªæ•™ç¨‹é‡Œé¢ï¼Œæˆ‘ä»¬æ¼”ç¤ºçš„æœåŠ¡å™¨ipæ˜¯ 172.22.0.4ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è·å–jenkinsåˆå§‹åŒ–å¯†ç ã€‚ 12docker exec -it jenkins-server \\ cat /var/jenkins_home/secrets/initialAdminPassword è¿™é‡Œè¿”å›çš„ä¸€æ®µå­—ç¬¦ä¸²6c46ccc61c804279a1017b743ab22aa4å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å¯†ç  è¾“å…¥å¯†ç ä¹‹åï¼Œé€‰æ‹©å®‰è£…åˆå§‹åŒ–çš„æ’ä»¶ æ’ä»¶å®‰è£…å¥½ä¹‹åï¼Œç³»ç»Ÿä¼šæç¤ºä½ è®¾ç½®ç”¨æˆ·åå¯†ç ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œç›´æ¥ç”¨ admin è´¦å·ã€‚é‡æ–°è¿›å…¥ jenkins ç•Œé¢ã€‚ç‚¹å‡»è¾“å…¥è´¦å·é‡Œé¢ï¼Œè¿™é‡Œçš„å¯†ç å°±æ˜¯ä¸Šæ–‡è·å–åˆ°çš„ jenkins åˆå§‹åŒ–å¯†ç  6c46ccc61c804279a1017b743ab22aa4ï¼Œç‚¹å‡»ç™»å½•ï¼Œè¿›å…¥ç³»ç»Ÿ: åˆ°æ­¤ä¸ºæ­¢ã€‚jenkins å°±ç®—æ˜¯å®‰è£…å¥½äº† æˆ‘ä»¬å¦‚æœæƒ³è¦å¸è½½ jenkins çš„è¯ï¼Œåªéœ€è¦è¿è¡Œ docker rm -f jenkins-server å°±å¯ä»¥äº†ã€‚ å› ä¸ºæˆ‘ä»¬é…ç½®äº† jenkins æ•°æ®æŒä¹…åŒ–çš„ç›®å½• /data/jenkins_homeï¼Œ åªè¦è¿™ä¸ªæ–‡ä»¶å¤¹è¿˜åœ¨ï¼Œjenkins é…ç½®å°±å¯ä»¥ä¸€ç›´ä¿ç•™ï¼Œä¸‹æ¬¡æƒ³è¿è¡Œ jenkins æ˜¯ï¼Œè¿è¡Œä¸Šæ–‡å®‰è£… jenkins çš„ docker run å‘½ä»¤å°±å¯ä»¥æ¢å¤ docker è¿è¡Œäº†ã€‚ é…ç½® jenkins çš„ nodejs æ’ä»¶å®‰è£…å®Œ jenkins ä¹‹åï¼Œ éœ€è¦é…ç½®ä¸€ä¸‹ nodejs æ’ä»¶ï¼Œåé¢æ‰èƒ½è®© jenkins è·‘å‰ç«¯æŒç»­é›†æˆä»»åŠ¡ã€‚ ç‚¹å‡» ç³»ç»Ÿç®¡ç† è¿›å…¥ jenkins ç³»ç»Ÿç®¡ç†é¡µé¢ ç‚¹å‡» æ’ä»¶ç®¡ç† è¿›å…¥æ’ä»¶ç®¡ç† è¿›å…¥ å¯é€‰æ’ä»¶ é€‰é¡¹å¡ï¼Œæœç´¢å¹¶å®‰è£… nodejs æ’ä»¶ å‹¾é€‰ å®‰è£…å®Œæˆåé‡å¯é€‰é¡¹ï¼Œå®‰è£…å®Œæ’ä»¶ä¹‹å jenkins ä¼š è‡ªåŠ¨é‡å¯ è¿›å…¥ å…¨å±€å·¥å…·é…ç½® é…ç½® nodejs å…¨å±€å·¥å…· ç‚¹å‡» æ–°å¢ NodeJS æŒ‰é”®æ–°å¢ä¸€ä¸ª nodejs å…¨å±€å·¥å…·ï¼Œå‹¾é€‰ è‡ªåŠ¨å®‰è£… æ³¨æ„: å®‰è£… nodejs æ—¶éœ€è¦å®‰è£…ä¸¤ä¸ª node å…¨å±€å‘½ä»¤ yarn å’Œ lerna, ç„¶åç‚¹å‡»ä¿å­˜ã€‚ æµ‹è¯• nodejs æ’ä»¶æˆ‘ä»¬å®‰è£…å®Œäº† nodejs æ’ä»¶ä¹‹åï¼Œå…ˆå›åˆ°é¦–é¡µ æ–°å»ºä¸€ä¸ª jenkins ä»»åŠ¡æµ‹è¯•ä¸€ä¸‹ nodejsã€‚ ç‚¹å‡» åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ æ‰“å¼€ä»»åŠ¡ç¼–è¾‘ç•Œé¢é€‰æ‹© æ„å»ºè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ï¼Œ è¾“å…¥ä¸€ä¸ªä»»åŠ¡åå­—test-node-demo: åœ¨æ„å»ºç¯å¢ƒè¿™é‡Œé€‰æ‹©æˆ‘ä»¬åˆšåˆšé…ç½®çš„ nodejs å…¨å±€å·¥å…· åœ¨æ„å»ºè¿™é‡Œ ç‚¹å‡» å¢åŠ æ„å»ºæ­¥éª¤ ï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­é€‰æ‹© æ‰§è¡Œshell ï¼š åœ¨å‘½ä»¤è¾“å…¥æ¡†ä¸­è¾“å…¥,ç„¶åç‚¹å‡»ä¿å­˜æŒ‰é’® 12node -e &#x27;console.log(&quot;Hello Hzero!&quot;);&#x27;node --version ç„¶åç‚¹å‡»è¿™ä¸ªä»»åŠ¡çš„ ç«‹å³æ„å»º æŒ‰é’® æ„å»ºæ—¶ï¼Œåœ¨ä¸‹é¢ä¼šå‡ºç°ä¸€ä¸ªè¿›åº¦æ¡ï¼Œç‚¹å‡»è¿›åº¦æ¡ å¯ä»¥çœ‹æ‰§è¡Œçš„æ—¥å¿— è¿›å…¥æ—¥å¿—ä¹‹åï¼Œå°†çœ‹åˆ°çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ åˆ°æ­¤ï¼Œnodejs æ’ä»¶æµ‹è¯•æˆåŠŸï¼ å®‰è£… nginxcentos å®‰è£… nginx ä¹Ÿéå¸¸ç®€å• ï¼Œä¸€å¥å‘½ä»¤ sudo yum install nginx å°±èƒ½æå®šï¼Œ ä½†æ˜¯è¿™æ ·å®‰è£… nginx ä¹‹åï¼Œé…ç½®ç®¡ç†å’Œnginxå‡çº§éƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨ docker æ¥å®‰è£… nginx ã€‚ è¿™é‡Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸¤ä¸ªæ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥ä¿å­˜ nginx çš„éƒ¨ç½²æ–‡ä»¶å’Œ nginx çš„é…ç½® /data/nginx/wwwroot nginx çš„éƒ¨ç½²æ–‡ä»¶å¤¹ /data/nginx/nginx_hzero.conf hzero çš„ nginx é…ç½® é¦–å…ˆåˆ›å»º nginx æ•°æ®æŒä¹…åŒ–æ–‡ä»¶å¤¹å’Œ é…ç½®ä¿å­˜æ–‡ä»¶å¤¹, 12sudo mkdir -p /data/nginx/wwwrootsudo mkdir -p /data/nginx/cfg åˆ›å»º nginx é…ç½®æ–‡ä»¶, ä¿å­˜åœ¨ /data/nginx/cfg/nginx_hzero.conf åœ¨å‘½ä»¤è¡Œè¿è¡Œä¸‹é¢å‘½ä»¤ï¼š 12345678910111213141516171819202122232425262728293031323334353637# /data/nginx/cfg/nginx_hzero.confsudo -s # è¿›å…¥rootç”¨æˆ·æ¨¡å¼cat &gt; /data/nginx/cfg/nginx_hzero.conf &lt;&lt; ENDserver &#123; listen 80; server_name localhost; root /usr/share/nginx/html/dist; location / &#123; try_files \\$uri /index.html; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root /usr/share/nginx/html/dist; &#125; # Media: images, icons, video, audio, HTC location ~* \\.(jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ &#123; expires 1M; access_log off; add_header Cache-Control &quot;public&quot;; &#125; # CSS and Javascript location ~* \\.(css|js)$ &#123; expires 1y; access_log off; add_header Cache-Control &quot;public&quot;; &#125;&#125;END è¿è¡Œnginxé•œåƒ 123456789docker run \\ -u root \\ --rm \\ --name nginx \\ -d \\ -p 40080:80 \\ -v /data/nginx/cfg/:/etc/nginx/conf.d/ \\ -v /data/nginx/wwwroot/:/usr/share/nginx/html/ \\ nginx æ·»åŠ æµ‹è¯•æ–‡ä»¶ 12sudo mkdir -p /data/nginx/wwwroot/distsudo echo Hello Nginx &gt; /data/nginx/wwwroot/dist/test.txt æµ‹è¯• nginx è¿è¡Œæ•ˆæœ 1curl http://172.22.0.4:40080/test.txt å¦‚æœèƒ½æ˜¾ç¤º Hello Nginx è¯´æ˜ nginx å®‰è£…æˆåŠŸ é…ç½® jenkins æŒç»­é›†æˆä»»åŠ¡æ„å»ºé…ç½® jenkins ä»»åŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸ª hzero-front å·¥ç¨‹çš„ä»£ç ä»“åº“åœ°å€ï¼šhttps://code.choerodon.com.cn/hft/hzero-front-demo.git å›åˆ° jenkins é¦–é¡µ æ–°å»ºä¸€ä¸ª jenkins ä»»åŠ¡ã€‚ ç‚¹å‡» åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ æ‰“å¼€ä»»åŠ¡ç¼–è¾‘ç•Œé¢é€‰æ‹© æ„å»ºè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ï¼Œ è¾“å…¥ä¸€ä¸ªä»»åŠ¡åå­—hzero-front-ci: ç‚¹å‡»ä¿å­˜åä¼šè¿›å…¥ä»»åŠ¡ç¼–è¾‘é¡µé¢ï¼š åœ¨ä»»åŠ¡ç¼–è¾‘ç•Œé¢çš„æºä»£ç ç®¡ç† é€‰æ‹© git é€‰é¡¹å®‰è£…å›¾ç‰‡å¡«å†™ä¸‹é¢ä¿¡æ¯ï¼š Repository URLï¼š è¾“å…¥ä»£ç åº“åœ°å€ï¼ˆhttps://code.choerodon.com.cn/hft/hzero-front-demo.gitï¼‰ Credentialsï¼šæ·»åŠ  code.choerodon.com.cn çš„è´¦å·å¯†ç  åœ¨ç¼–è¯‘ç¯å¢ƒè®¾ç½®é‡Œé¢å‹¾é€‰ä¸Š nodejs å·¥å…·ã€‚ æ·»åŠ ä¸€ä¸ªæ„å»ºæ­¥éª¤ æ‰§è¡Œ shell è¾“å…¥ä¸‹é¢çš„ shell è„šæœ¬: 123456789101112131415yarn installcat &gt; src/config/.env.production.yml.local &lt;&lt; ENDBASE_PATH: /PLATFORM_VERSION: SAASCLIENT_ID: localhostGENERATE_SOURCEMAP: falseAPI_HOST: http://backend.hft.jajabjbj.topWEBSOCKET_HOST: ws://ws.hft.jajabjbj.topSKIP_TS_CHECK_IN_START: falseENABLE_VUE_SUPPORT: falseSKIP_ESLINT_CHECK_IN_START: falseENDyarn run build:productiontar -zcf dist.tar.gz ./dist ç‚¹å‡»ä¿å­˜ã€‚ ä¸‹ä¸€æ­¥ç„¶åç‚¹å‡» ç«‹å³æ„å»ºï¼Œè¿™é‡Œä¼šæ„å»ºå¹¶ç”Ÿæˆ dist æ–‡ä»¶ éƒ¨ç½²æ„å»ºå®Œæˆç”Ÿæˆäº† dist æ–‡ä»¶ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬è¦æŠŠ æ„å»ºç”Ÿæˆçš„æ–‡ä»¶éƒ¨ç½²åˆ° nginx çš„ www ç›®å½• /data/nginx/wwwroot æ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®ä¸€ä¸‹ dist éƒ¨ç½²æµç¨‹ éƒ¨ç½²é€šå¸¸éƒ½æ˜¯æŒ‡æŠŠæ„å»ºå¥½çš„ dist æ–‡ä»¶éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œéƒ¨ç½²çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ ftpã€ æ„å»º dockerç­‰ã€ssh ï¼Œ è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•é€šè¿‡ ssh è¿œç¨‹éƒ¨ç½² dist æ–‡ä»¶åˆ° nginx æœåŠ¡å™¨ä¸Šã€‚ é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ª jenkins æ’ä»¶ Publish Over SSHã€‚ æ’ä»¶çš„å®‰è£…æ–¹æ³•ä¸Šæ–‡ä¸­æœ‰æåˆ°ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚ å®‰è£…å¥½ä¹‹åï¼Œæ‰“å¼€ ç³»ç»Ÿç®¡ç† &gt; é…ç½®ä¸­å¿ƒ æŠŠ nginx æœåŠ¡å™¨çš„ä¿¡æ¯ æ·»åŠ åˆ° Publish Over SSH çš„ ssh é…ç½®ã€‚ å¯¹å…³é”®é…ç½®é¡¹çš„è§£é‡Šï¼š name: ç»™æœåŠ¡å™¨èµ·ä¸€ä¸ªåå­—ï¼Œåœ¨åé¢è®¾ç½®ä»»åŠ¡æ—¶ä¼šç”¨åˆ°è¿™ä¸ªåå­—ã€‚ Hostname: sshd æœåŠ¡å™¨çš„ipåœ°å€, ä¹Ÿå°±æ˜¯ nginx æœåŠ¡å™¨ipåœ°å€ã€‚ Remote Directory: è¿™é‡Œæ˜¯è®¾ç½®æœåŠ¡å™¨ä¸Šä¼ ç›®å½•ï¼Œç”±äºåœ¨ jenkins ä»»åŠ¡é‡Œé¢å¯ä»¥é…ç½®ï¼Œ ä¸ºäº†ä¸å¼•èµ·è¯¯è§£ï¼Œè¿™é‡Œè®¾ç½®æˆ / å°±å¯ä»¥äº†ã€‚ Passphrase&#x2F;Password: è¿™é‡Œæ˜¯æœåŠ¡å™¨ ssh ç™»å½•å¯†ç ï¼Œå¦‚æœæ˜¯é€šè¿‡ç§é’¥è¿æ¥æœåŠ¡å™¨ï¼Œå¯ä»¥ä¸è¾“å…¥å¯†ç ã€‚ Key: è¿™é‡Œæ˜¯æœåŠ¡å™¨çš„ç§é’¥æ–‡ä»¶å†…å®¹ã€‚å¦‚æœä½ æ˜¯é€šè¿‡ å¯†ç  è¿æ¥ ssh æœåŠ¡å™¨çš„è¯ï¼Œå¯ä»¥ä¸å¡«ç§é’¥ã€‚ ç„¶åæ‰“å¼€æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ jenkins ä»»åŠ¡ï¼Œç‚¹å‡»é…ç½®æŒ‰é’®ï¼Œè¿›å…¥ä»»åŠ¡ç¼–è¾‘é¡µé¢ã€‚ åˆ° Post-build Actions é…ç½®éƒ¨åˆ†æ·»åŠ ä¸€ä¸ª æ„å»ºåçš„éƒ¨ç½²æµç¨‹ã€‚ ç„¶åè¾“å…¥ç›¸åº”çš„é…ç½® å¯¹å…³é”®é…ç½®é¡¹çš„è§£é‡Šï¼š name: ä¸Šæ–‡åœ¨ ç³»ç»Ÿç®¡ç† &gt; é…ç½®ä¸­å¿ƒ ä¸­é…ç½®çš„ ssh æœåŠ¡å™¨åå­—ã€‚ Source files: åˆ¶å®šä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶ï¼Œæ³¨æ„è¿™é‡Œçš„æ–‡ä»¶æ˜¯ä¸Šé¢æˆ‘ä»¬é…ç½®çš„æ„å»ºè„šæœ¬äº§ç”Ÿçš„æ–‡ä»¶ã€‚ Remote directory: è¿™ä¸ªæ˜¯ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨ä½ç½®ï¼Œä¸Šä¼ ä¸Šå»çš„æ–‡ä»¶è¿˜æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œåé¢è¿˜æœ‰åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰§è¡ŒèŠ‚çº¦å‘½ä»¤ Exec command: åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ shell å‘½ä»¤ 123cd /data/nginx/wwwrootsudo rm -rf distsudo tar -zxf dist.tar.gz ç„¶åç‚¹å‡»ä¿å­˜ï¼Œå†æ„å»ºä¸€æ¬¡ã€‚ çœ‹ä¸‹æ„å»ºæ—¥å¿—ã€‚æç¤ºå‘å¸ƒæˆåŠŸã€‚ ç„¶åæˆ‘ä»¬å¯ä»¥ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸‹ nginx æœåŠ¡å™¨åœ°å€ï¼Œ è¯•è¯•æœåŠ¡æ˜¯å¦æˆåŠŸã€‚ é…ç½®è‡ªåŠ¨æŒç»­é›†æˆå¦‚æœæƒ³å®ç°å®Œå…¨è‡ªåŠ¨çš„æŒç»­é›†æˆï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸ªåœ°æ–¹ æ‰“å¼€ä»»åŠ¡é…ç½®è®¾ç½®ä¸€ä¸ªè§¦å‘é€‰é¡¹ Poll SCMï¼Œè®¾ç½® Schedule è§„åˆ™ä¸º: H/15 * * * * è¿™é‡Œé…ç½®é¡¹çš„æ„æ€æ˜¯ï¼šæ¯ 15 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ git æºä»£ç ä»“åº“æ˜¯å¦æœ‰æ–°çš„å˜æ›´ï¼Œå¦‚æœæœ‰å°±æ‰§è¡Œæ„å»ºä»»åŠ¡ã€‚ å…³äº cronjob è¡¨è¾¾å¼çš„å­¦ä¹  jenkins + gh-pages å®ç°æŒç»­é›†æˆå¦‚æœæ²¡æœ‰ nginx æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ dist éƒ¨ç½²åˆ° gh-pages ä¸Šã€‚ è€ƒè™‘åˆ° github çš„ gh-pages ç½‘é€Ÿåœ¨å›½å†…æœ‰äº›æ…¢ï¼Œ æœ¬æ•™ç¨‹å°±ç”¨å›½å†…çš„ gitee åšä¸€ä¸ªç¤ºèŒƒã€‚ giteeç½‘ç«™: https://gitee.com/ é¦–å…ˆæˆ‘ä»¬åœ¨ gitee ä¸Šé¢æ³¨å†Œå¥½è´¦å·ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªä»£ç ä»“åº“ã€‚ æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªä»£ç ä»“åº“åœ°å€ï¼šhttps://gitee.com/hzero-cli/hzero-front-demo-dist.git éƒ¨ç½²åˆ° gh-pages ä¸Šé¢æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ª npm å·¥å…· gh-pages: gh-pages æ–‡æ¡£åœ°å€ æŠŠè¿™ä¸ªå·¥å…·é…ç½®åˆ° nodejs çš„å…¨å±€å·¥å…·ä¸Šé¢ï¼š é…ç½®å¥½å·¥å…·ä¹‹åï¼Œå¼€å§‹åˆ›å»º jenkins ä»»åŠ¡ã€‚ ä¸ºäº†ç®€ä¾¿ï¼Œæˆ‘ä»¬åŸºäºä¹‹å‰çš„æŒç»­é›†æˆä»»åŠ¡åˆ›å»ºä¸€ä¸ªæ–°çš„æŒç»­é›†æˆä»»åŠ¡ã€‚ ç‚¹å‡» æ–°å»ºä»»åŠ¡ æŒ‰é’® ä¸ºä»»åŠ¡èµ·ä¸€ä¸ªæ–°åå­—ï¼š hzero-front-ci-gitee æ³¨æ„è¿™é‡Œæˆ‘ä»¬è¦é€‰æ‹© Copy from, è¾“å…¥å‰é¢åˆ›å»ºçš„ä»»åŠ¡åå­—ï¼šhzero-front-ci ç‚¹å‡» ok ï¼Œè¿›å…¥æ„å»ºé…ç½®éƒ¨åˆ†ã€‚ ä¿®æ”¹æ„å»ºè„šæœ¬ï¼Œæ·»åŠ  gh-pages éƒ¨ç½²å‘½ä»¤ï¼š 123git config --global user.email &quot;you@example.com&quot;git config --global user.name &quot;Your Name&quot;gh-pages -r https://hzero-cli:abcd1234@gitee.com/hzero-cli/hzero-front-demo-dist.git -b gh-pages -d dist ç„¶ååˆ é™¤ä» hzero-front-ci ä»»åŠ¡å¤åˆ¶è¿‡æ¥çš„ sshéƒ¨ç½² é…ç½® ä¿å­˜ï¼Œç‚¹å‡»ç«‹å³æ„å»ºã€‚ è¿™æ ·æ„å»ºç”Ÿæˆçš„ dist å°±å¯ä»¥å‘å¸ƒåˆ° gitee ä»£ç ä»“åº“äº†ã€‚ è¿™é‡Œä¼šå¤šä¸€ä¸ªåˆ†æ”¯ï¼Œå°±æ˜¯æˆ‘ä»¬éƒ¨ç½²ä¸Šå»çš„æ–‡ä»¶ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç»™ gitee ä»£ç ä»“åº“è®¾ç½®ä¸€ä¸‹ gh-pages çš„ http æœåŠ¡ã€‚ ç‚¹å‡» æœåŠ¡ &gt; Gitee Pages è®¾ç½®éƒ¨ç½²åˆ†æ”¯ä¸º gh-pages ,ç„¶åç‚¹å‡»å¼€å§‹æŒ‰é’® è¿è¡ŒæˆåŠŸä¹‹åï¼Œ æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª http è®¿é—®åœ°å€ï¼šhttp://hzero-cli.gitee.io/hzero-front-demo-dist/ ä½†æ˜¯è®¿é—®æ—¶ï¼Œ console è¿˜æ˜¯ä¼šæŠ¥é”™: è¿™æ˜¯å› ä¸º gitee çš„ gh-pages æä¾›çš„ http åœ°å€æœ‰ä¸€ä¸ªæ ¹è·¯å¾„(public_path)ã€‚ æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æ„å»ºçš„ç¯å¢ƒå˜é‡ï¼Œæ‰“å¼€ä»»åŠ¡çš„æ„å»ºé…ç½®ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼š 12PUBLIC_URL: /hzero-front-demo-dist/BASE_PATH: /hzero-front-demo-dist/ æ³¨æ„ä¸€ä¸‹ BASE_PATH å’Œ PUBLIC_URL çš„åŒºåˆ«ã€‚ PUBLIC_URL : ä¼šå½±å“èµ„æºåŠ è½½è·¯å¾„ï¼Œåœ¨èµ„æºåŠ è½½è·¯å¾„å‰é¢åŠ ä¸€å±‚æ ¹è·¯å¾„ã€‚ BASE_PATH : ä¼šå½±å“æµè§ˆå™¨çš„åœ°å€æ æ ¹è·¯å¾„ã€‚åœ¨åœ°å€æ æ˜¾ç¤ºçš„åœ°å€ä¸ŠåŠ ä¸€å±‚æ ¹è·¯å¾„ã€‚ è™½ç„¶ BASE_PATH ä¸ä¼šå½±å“èµ„æºåŠ è½½è·¯å¾„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿›å…¥é¡µé¢ä¹‹ååˆ·æ–°ï¼Œå¿…é¡»æµè§ˆå™¨çš„åœ°å€æ æ˜¯ä»¥ http://hzero-cli.gitee.io/hzero-front-demo-dist/ ä¸ºå‰ç¼€ï¼Œæ‰€ä»¥è¦åŠ ä¸€ä¸‹ BASE_PATH çš„é…ç½®ã€‚ æ¸…é™¤æ„å»ºç¼“å­˜ï¼Œç„¶åç‚¹å‡»é‡æ–°æ„å»º æ³¨æ„: ç”±äº hzero-cli é»˜è®¤å¼€å¯äº†å¢é‡æ›´æ–°ï¼Œ æ‰€ä»¥ä¿®æ”¹äº†ç¯å¢ƒå˜é‡ä¹‹åï¼Œéœ€è¦æ¸…ç©ºå½“å‰æ„å»ºä»»åŠ¡çš„ç¼“å­˜ã€‚ å¦‚æœä½ è®¿é—®é¡µé¢ï¼Œç¬¬äºŒæ¬¡åˆ·æ–°è¿˜ä¼šæœ‰ 404 çš„é—®é¢˜ è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ gh-pages å’Œ nginx é…ç½® ä¸ä¸€æ ·ã€‚nginx ä¸Šé¢é…ç½®äº†ä¸€æ®µä»£ç ï¼š 123location / &#123; try_files $uri /index.html;&#125; æœ‰äº†è¿™æ®µä»£ç ï¼Œ æœåŠ¡å™¨å°±ä¼šè·¯å¾„æ‰¾ä¸åˆ°çš„httpè¯·æ±‚é‡æ–°å®šä½åˆ° &#x2F;index.html ä½†æ˜¯ gh-pages çš„åŸç†æ˜¯: å¦‚æœå½“å‰ http è¯·æ±‚è·¯å¾„å®šä½ä¸åˆ°ä»“åº“çš„æ–‡ä»¶ï¼Œå°±è¿”å› 404.html çš„å†…å®¹ã€‚ æ‰€ä»¥ä¸ºäº†èƒ½è®©é¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨è„šæœ¬æ„å»ºå®Œæˆä¹‹å åŠ ä¸€è¡Œä»£ç  cp dist/index.html dist/404.htmlè®©æµè§ˆå™¨èƒ½è·å–åˆ° index.html ã€‚ æœ€åè„šæœ¬ä¿®æ”¹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425yarn installcat &gt; src/config/.env.production.local.yml &lt;&lt; ENDPUBLIC_URL: /hzero-front-demo-dist/BASE_PATH: /hzero-front-demo-dist/PLATFORM_VERSION: SAASCLIENT_ID: localhostGENERATE_SOURCEMAP: falseAPI_HOST: http://backend.hft.jajabjbj.topWEBSOCKET_HOST: ws://ws.hft.jajabjbj.topSKIP_TS_CHECK_IN_START: falseENABLE_VUE_SUPPORT: falseSKIP_ESLINT_CHECK_IN_START: falseENDyarn run build:productioncp dist/index.html dist/404.htmlgit config --global user.email &quot;you@example.com&quot;git config --global user.name &quot;Your Name&quot;gh-pages-cleangh-pages -r https://hzero-cli:abcd1234@gitee.com/hzero-cli/hzero-front-demo-dist.git \\ -b gh-pages \\ -d dist æ¸…é™¤æ„å»ºç¼“å­˜ä¹‹åï¼Œç‚¹å‡»é‡æ–°æ„å»º, æ„å»ºæˆåŠŸä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œéƒ¨ç½²å®Œæˆä¹‹åå°±å¯ä»¥è®¿é—®ï¼š http://hzero-cli.gitee.io/hzero-front-demo-dist äº†","tags":[{"name":"jenkins","slug":"jenkins","permalink":"http://blog.jajabjbj.top/tags/jenkins/"}]},{"title":"ä½¿ç”¨é«˜é˜¶ç»„ä»¶å®ç°é¡µé¢çš„è¡¨å•æ•°æ®å’Œstateç¼“å­˜","date":"2018-08-29T00:00:00.000Z","path":"2018/08/29/cache/","text":"åŠŸèƒ½ä»‹ç»å½“é¡µé¢ä¸Šå­˜åœ¨ Antd çš„ Fromè¡¨å•,åˆ‡æ¢åˆ°å…¶ä»–é¡µé¢å†åˆ‡æ¢å›æ¥,å¸Œæœ›è¡¨å•çš„æ•°æ®å’Œé¡µé¢çŠ¶æ€æ•°æ®èƒ½å¤Ÿä¿ç•™, ä½¿ç”¨ä½¿ç”¨ @cachePage é«˜é˜¶ç»„ä»¶å®Œæˆç›¸åº”çš„åŠŸèƒ½ å®ç°åŸç†å®šä¹‰ä¸€ä¸ªMapç¼“å­˜å¯¹è±¡ä½¿ç”¨é«˜é˜¶ç»„ä»¶åŒ…è£…ä¸€å±‚ åŒ…å« From è¡¨å•çš„ç»„ä»¶ï¼Œ åœ¨é«˜é˜¶ç»„ä»¶è¢«åŠ è½½æ—¶ï¼Œåœ¨ componentDidMonent æ–¹æ³•ä¸­åˆ¤æ–­ç¼“å­˜å¯¹è±¡ä¸­æ˜¯å¦æœ‰è¯¥é¡µé¢çš„æ•°æ®ï¼Œ å¦‚æœæœ‰æ•°æ®ï¼Œå°±é€šè¿‡ From è¡¨å•çš„ Api ï¼ŒæŠŠæ•°æ®è®¾ç½®åˆ°ç»„ä»¶çš„ From æ•°æ®é‡Œé¢ï¼Œ åœ¨é«˜é˜¶ç»„ä»¶é”€æ¯æ—¶ï¼Œåœ¨ç»„ä»¶çš„ componentWillUnMonent æ–¹æ³•ä¸­ æŠŠè¢«åŒ…è£…ç»„ä»¶çš„Fromè¡¨å•çš„æ•°æ®å–å‡ºæ¥ æ”¾åˆ°ç¼“å­˜å¯¹è±¡ä¸­ã€‚ é«˜é˜¶ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138import React, &#123; Component &#125; from &#x27;react&#x27;;import moment from &#x27;moment&#x27;;// å†…å­˜ç¼“å†²å¯¹è±¡const cacheMap = &#123;&#125;;const cacheKeyList = [];/** * ç¼“å­˜è·¯ç”±é¡µé¢è¡¨å• keep-alive * * @param &#123;string&#125; cacheKey ç¼“å­˜çš„key,å¯¹åº”æ¯ä¸ªè·¯ç”±é¡µé¢çš„key, é»˜è®¤ è·¯ç”±é¡µé¢ç»„ä»¶åç§° * @propsMethod props.cachePage.clear() æ¸…é™¤ç¼“å­˜ï¼Œå¹¶æ ‡è®°è¿™æ¬¡è¡¨å•å°†ä¸è¢«ç¼“å­˜ * */export const cachePage = (&#123; cacheKey,&#125; = &#123;&#125;) =&gt; &#123; return (ComposedComponent) =&gt; &#123; let isError = false; if (!cacheKey) &#123; // console.warn(&#x27;ç¼ºå¤± CachePage å¿…å¡«å‚æ•° cacheKey&#x27;); isError = true; &#125; if (cacheKeyList.indexOf(cacheKey) &gt;= 0) &#123; // console.warn(&#x27;CachePage ,cacheKey å¿…é¡»ä¿è¯å…¨å±€å”¯ä¸€ï¼Œå¤šä¸€ä¸ªé¡µé¢ä¸èƒ½æœ‰ç›¸åŒ cacheKey &#x27;); // isError = true; &#125; if (isError) &#123; return ComposedComponent; &#125; cacheKeyList.push(cacheKey); // å½“å‰æ˜¯å¦åº”è¯¥ä¿å­˜cacheï¼ˆå¦‚æœè¢«è°ƒç”¨æ”¶åˆ°æ¸…ç†cacheï¼Œå°±åœ¨ç»„ä»¶é”€æ¯æ—¶ä¸ä¿å­˜cacheï¼‰ let shouldSave = true; const mCacheKey = cacheKey || ComposedComponent.id || ComposedComponent.key; // è·å–cache const getCache = () =&gt; &#123; let cache = cache = cacheMap[mCacheKey]; if (!cache) &#123; cache = &#123;&#125;; cacheMap[mCacheKey] = cache; &#125; return cache; &#125;; // ä¿å­˜cache const setCache = (cache) =&gt; &#123; cacheMap[mCacheKey] = cache; &#125;; // æ¸…é™¤cache const clearCache = (isClose) =&gt; &#123; delete cacheMap[mCacheKey] ; if (isClose) &#123; shouldSave = false; &#125; &#125;; return class WrapComponent extends Component &#123; componentDidMount() &#123; const &#123; form &#125; = this.props; const cacheData = getCache(); if (form &amp;&amp; cacheData.form) &#123; const &#123; setFieldsValue, getFieldProps &#125; = form; const cacheFormData = cacheData.form; Object.keys(cacheFormData).forEach((formKey) =&gt; &#123; getFieldProps(formKey); &#125;); // è®¾ç½®æ•°æ®åˆ°è¡¨å• setFieldsValue(cacheFormData); &#125; if (this.pageComponent &amp;&amp; cacheData.pageState) &#123; // è®¾ç½®æ•°æ®åˆ°é¡µé¢ç»„ä»¶state this.pageComponent.setState(cacheData.pageState); &#125; shouldSave = true; &#125; componentWillUnmount() &#123; if (shouldSave === false) &#123; return; &#125; const &#123; form &#125; = this.props; const cacheData = getCache(); // è·å–é¡µé¢ç»„ä»¶è¡¨å•æ•°æ® if (form) &#123; const &#123; getFieldsValue, getFieldProps &#125; = form; cacheData.form = getFieldsValue(); &#125; // è·å–é¡µé¢ç»„ä»¶stateæ•°æ® if (this.pageComponent &amp;&amp; this.pageComponent.state) &#123; cache.pageState = this.pageComponent.state; &#125; // ä¿å­˜æ•°æ®åˆ°ç¼“å­˜ setCache(cache); &#125; actionObj = &#123; clear() &#123; clearCache(); shouldSave = false; &#125;, &#125;; render() &#123; // eslint-disable-next-line react/no-string-refs return &lt;ComposedComponent ref=&#123;(c) =&gt; &#123; this.pageComponent = c; &#125;&#125; cachePage=&#123;this.actionObj&#125; &#123;...this.props&#125; /&gt;; &#125; &#125;; &#125;;&#125;;/** * è®© Form æ•°æ® JSON ååºåˆ—å·æ”¯æŒ Date * @param key * @param value * @returns &#123;*&#125; */function dateReviver(key, value) &#123; if (typeof value === &#x27;string&#x27;) &#123; const a = /^(\\d&#123;4&#125;)-(\\d&#123;2&#125;)-(\\d&#123;2&#125;)T(\\d&#123;2&#125;):(\\d&#123;2&#125;):(\\d&#123;2&#125;(?:\\.\\d*)?)Z$/.exec(value); if (a) &#123; return moment(new Date(value)); &#125; &#125; return value;&#125;export const onClosePage = (pathname) =&gt; &#123; if (pathnameToCacheKey[pathname]) &#123; pathnameToCacheKey[pathname](true); &#125;&#125;; å‚æ•°ä»‹ç» cacheKey ç¼“å­˜çš„key,å¯¹åº”æ¯ä¸ªè·¯ç”±é¡µé¢çš„key, å¿…å¡«å‚æ•° æ–¹æ³•åœ¨ä½¿ç”¨è¯¥é«˜é˜¶ç»„ä»¶ä¿®é¥°çš„é¡µé¢å, é¡µé¢çš„propså†…éƒ¨ä¼šè¢«æ³¨å…¥ä¸€ä¸ªcachePageå¯¹è±¡,æä¾›ä¸ä»¥ä¸‹æ“ä½œç¼“å­˜çš„æ–¹æ³•: props.cachePage.clear() : æ¸…é™¤ç¼“å­˜ï¼Œå¹¶æ ‡è®°è¿™æ¬¡è¡¨å•å°†ä¸è¢«ç¼“å­˜, åœ¨é¡µé¢ç»„ä»¶åˆ—é€šè¿‡this.props.cachePage.clear(), è·³è½¬åˆ°å…¶ä»–é¡µé¢æ—¶,æ•°æ®ä¸ä¼šè¢«ç¼“å­˜,å¹¶ä¸”æ¸…ç©ºä¸Šæ¬¡ç¼“å­˜çš„æ•°æ® ä½¿ç”¨æ¡ˆä¾‹åœ¨é¡µé¢ç»„ä»¶ä¸­åŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼Œåˆ‡æ¢é¡µé¢æ—¶ï¼Œå¯ä»¥ä¿ç•™å½“å‰é¡µé¢çŠ¶æ€ 12345678910111213141516171819202122232425262728import React, &#123; PureComponent &#125; from &#x27;react&#x27;;import &#123; Form, Input, &#125; from &#x27;antd&#x27;;import &#123; cachePage &#125; from &#x27;../../utils/Cache/cacheFromWrapper&#x27;;@Form.create()@cachePage(&#123; cacheKey: &#x27;BasicFormPage&#x27; &#125;)export default class BasicFormPage extends PureComponent &#123; const _style = &#123; marginTop: 8 &#125;; render()&#123; return (&lt;Form&#123; hideRequiredMark style=&#123;_style&#125; &gt; &lt;FormItem label=&quot;æ ‡é¢˜&quot; &gt; &#123;getFieldDecorator(&#x27;title&#x27;, &#123; rules: [&#123; required: true, message: &#x27;è¯·è¾“å…¥æ ‡é¢˜&#x27;, &#125;], &#125;)( &lt;Input placeholder=&quot;ç»™ç›®æ ‡èµ·ä¸ªåå­—&quot; /&gt; )&#125; &lt;/FormItem&gt; &lt;/From&gt;); &#125;&#125; åŠŸèƒ½æ‰©å±• é€šè¿‡å¯ä»¥åœ¨é«˜é˜¶ç»„ä»¶é‡Œé¢æŠŠæ•°æ®ç¼“å­˜åˆ° localStorage æ³¨æ„äº‹é¡¹è¯¥é«˜é˜¶ç»„ä»¶çš„è¡¨å•ç¼“å­˜æ•ˆæœå®ç°ä¾èµ– Antd çš„ From.create()æ‰€ä»¥ä½¿ç”¨æ—¶,è¡¨å•çš„åˆ›å»ºå¿…é¡»ç”¨ antd ä¸­çš„ From.create()ç”Ÿæˆè¡¨å•","tags":[{"name":"react","slug":"react","permalink":"http://blog.jajabjbj.top/tags/react/"}]},{"title":"ä½¿ç”¨ openssl ç”Ÿæˆè¯ä¹¦","date":"2018-05-30T00:00:00.000Z","path":"2018/05/30/2018-05-30/","text":"ä½¿ç”¨ openssl ç”Ÿæˆè¯ä¹¦ä»Šå¤©åœ¨é…ç½®kibanaæƒé™è®¾ç½®æ—¶ï¼Œkibanaè¦æ±‚ä½¿ç”¨httpsé“¾æ¥ã€‚ äºæ˜¯æ€»ç»“äº†ä¸€ä¸‹linuxä¸‹opensslç”Ÿæˆ ç­¾åçš„æ­¥éª¤ï¼š x509è¯ä¹¦ä¸€èˆ¬ä¼šç”¨åˆ°ä¸‰ç±»æ–‡ï¼Œkeyï¼Œcsrï¼Œcrtã€‚ Key æ˜¯ç§ç”¨å¯†é’¥opensslæ ¼ï¼Œé€šå¸¸æ˜¯rsaç®—æ³•ã€‚ Csr æ˜¯è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œç”¨äºç”³è¯·è¯ä¹¦ã€‚åœ¨åˆ¶ä½œcsræ–‡ä»¶çš„æ—¶ï¼Œå¿…é¡»ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥ç­¾ç½²ç”³ï¼Œè¿˜å¯ä»¥è®¾å®šä¸€ä¸ªå¯†é’¥ã€‚ crtæ˜¯CAè®¤è¯åçš„è¯ä¹¦æ–‡ï¼Œï¼ˆwindowsä¸‹é¢çš„ï¼Œå…¶å®æ˜¯crtï¼‰ï¼Œç­¾ç½²äººç”¨è‡ªå·±çš„keyç»™ä½ ç­¾ç½²çš„å‡­è¯ã€‚ keyçš„ç”Ÿæˆ openssl genrsa -des3 -out server.key 2048 è¿™æ ·æ˜¯ç”Ÿæˆrsaç§é’¥ï¼Œdes3ç®—æ³•ï¼Œopensslæ ¼å¼ï¼Œ2048ä½å¼ºåº¦ã€‚server.keyæ˜¯å¯†é’¥æ–‡ä»¶åã€‚ä¸ºäº†ç”Ÿæˆè¿™æ ·çš„å¯†é’¥ï¼Œéœ€è¦ä¸€ä¸ªè‡³å°‘å››ä½çš„å¯†ç ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ç”Ÿæˆæ²¡æœ‰å¯†ç çš„key: openssl rsa -in server.key -out server.key server.keyå°±æ˜¯æ²¡æœ‰å¯†ç çš„ç‰ˆæœ¬äº†ã€‚ ç”ŸæˆCAçš„crt openssl req -new -x509 -key server.key -out ca.crt -days 3650 ç”Ÿæˆçš„ca.crtæ–‡ä»¶æ˜¯ç”¨æ¥ç­¾ç½²ä¸‹é¢çš„server.csræ–‡ä»¶ã€‚ csrçš„ç”Ÿæˆæ–¹æ³• openssl req -new -key server.key -out server.csr éœ€è¦ä¾æ¬¡è¾“å…¥å›½å®¶ï¼Œåœ°åŒºï¼Œç»„ç»‡ï¼Œemailã€‚æœ€é‡è¦çš„æ˜¯î€ƒæœ‰ä¸€ä¸ªcommon nameï¼Œå¯ä»¥å†™ä½ çš„åå­—æˆ–è€…åŸŸåã€‚å¦‚æœä¸ºäº†httpsç”³è¯·ï¼Œè¿™ä¸ªå¿…é¡»å’ŒåŸŸåå»åˆï¼Œå¦åˆ™ä¼šå¼•å‘æµè§ˆå™¨è­¦æŠ¥ã€‚ç”Ÿæˆçš„csræ–‡ä»¶äº¤ç»™CAç­¾ååå½¢æˆæœåŠ¡ç«¯è‡ªå·±çš„è¯ä¹¦ã€‚ crtç”Ÿæˆæ–¹æ³• CSRæ–‡ä»¶å¿…é¡»æœ‰CAçš„ç­¾åæ‰å¯å½¢æˆè¯ä¹¦ï¼Œå¯å°†æ­¤æ–‡ä»¶å‘é€åˆ°verisignç­‰åœ°æ–¹ç”±å®ƒéªŒè¯ï¼Œè¦äº¤ä¸€å¤§ç¬”é’±ï¼Œä½•ä¸è‡ªå·±åšCAå‘¢ã€‚ openssl x509 -req -days 3650 -in server.csr -CA ca.crt -CAkey server.key -CAcreateserial -out server.crt è¾“å…¥keyçš„å¯†é’¥åï¼Œå®Œæˆè¯ä¹¦ç”Ÿæˆã€‚-CAé€‰é¡¹æŒ‡æ˜ç”¨äºè¢«ç­¾åçš„csrè¯ä¹¦ï¼Œ-CAkeyé€‰é¡¹æŒ‡æ˜ç”¨äºç­¾åçš„å¯†é’¥ï¼Œ-CAserialæŒ‡æ˜åºåˆ—å·æ–‡ä»¶ï¼Œè€Œ-CAcreateserialæŒ‡æ˜æ–‡ä»¶ä¸å­˜åœ¨æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚ æœ€åç”Ÿæˆäº†ç§ç”¨å¯†é’¥ï¼šserver.keyå’Œè‡ªå·±è®¤è¯çš„SSLè¯ä¹¦ï¼šserver.crt è¯ä¹¦åˆå¹¶ï¼š cat server.key server.crt &gt; server.pem é…ç½®docker ä¿¡ä»»è¯ä¹¦ 123456789&#123; &quot;registry-mirrors&quot; : [ &quot;http://b36c9ea6.m.daocloud.io&quot; ], &quot;tlscacert&quot; : &quot;/data/cert/server.pem&quot;, &quot;debug&quot; : true, &quot;experimental&quot; : true&#125;","tags":[]},{"title":"æ­å»º gitlab-ci æŒç»­é›†æˆç¯å¢ƒ","date":"2018-05-30T00:00:00.000Z","path":"2018/05/30/2018-05-31-1/","text":"æ­å»º gitlab-ci æŒç»­é›†æˆç¯å¢ƒå®‰è£…dockerhttps://www.docker.com/get-docker æ·»åŠ  hosts1234567# ã€Œ192.168.99.1 ã€ ä¸ºå®¿ä¸»æœºçš„ip192.168.99.1 gitlab.jajabjbj.top192.168.99.1 rancher.jajabjbj.top192.168.99.1 jenkins.jajabjbj.top192.168.99.1 docker.jajabjbj.top192.168.99.1 harbor.jajabjbj.top æ³¨æ„ï¼š è¿™é‡Œä¸èƒ½ä½¿ç”¨127.0.0.1ï¼Œåº”ä¸ºåœ¨dockerå®¹å™¨ä¸­çš„127.0.0.1 å’Œå®¿ä¸»æœºçš„127.0.0.1æ˜¯ä¸¤ä¸ªä¸åŒçš„ipï¼Œå¦‚æœdockerå®¹å™¨å†…è§£æè¿™ä¸ªåŸŸåå°±å¥½å¾—åˆ°é”™è¯¯çš„ipï¼Œè¿™é‡Œã€Œ192.168.99.1 ã€ ä¸ºä½ å®¿ä¸»æœºç”µè„‘ä¸Šé¢çš„è™šæ‹Ÿç½‘å¡çš„å›ºå®šipï¼Œå¯ä»¥å®‰è£… VirtrualBox ç­‰è½¯ä»¶åï¼Œå®¿ä¸»æœºä¸Šé¢ä¼šè‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç½‘å¡ã€‚ å®‰è£… nginx proxyå®‰è£… nginx-proxy çš„ç›®çš„æ˜¯ä¸ºäº†è®©å®¿ä¸»æœºå™¨é€šè¿‡ä¸€ä¸ªç«¯å£å·ï¼Œå‘å¤–ä»¥å¤šä¸ªä¸åŒå®¹å™¨çš„æ–¹å¼æä¾›å¤šä¸ªæœåŠ¡ã€‚ 12345sudo docker run -d -p 80:80 --name nginx-proxy \\ -v /var/run/docker.sock:/tmp/docker.sock:ro \\ jwilder/nginx-proxy å®‰è£…gitlab1234567891011121314mkdir -p /srv/gitlabsudo docker run -d --privileged \\ --env GITLAB_OMNIBUS_CONFIG=&quot;external_url &#x27;http://gitlab.jajabjbj.top/&#x27;&quot; \\ --env VIRTUAL_HOST=gitlab.jajabjbj.top \\ --name gitlab \\ --restart always \\ --volume /srv/gitlab/config:/etc/gitlab \\ --volume /srv/gitlab/logs:/var/log/gitlab \\ --volume /srv/gitlab/data:/var/opt/gitlab \\ gitlab/gitlab-ce:latest 12345678# pages æœåŠ¡gitlab_rails[&#x27;lfs_enabled&#x27;] = truepages_external_url &#x27;http://gitlab.jajabjbj.top&#x27;gitlab_rails[&#x27;pages_path&#x27;] = &quot;/tmp/pages&quot;gitlab_rails[&#x27;lfs_enabled&#x27;] = true å®‰è£…å¹¶æ·»åŠ  gitlab-runnerdocker é•œåƒè¿è¡Œæ–¹å¼123456&gt; mkdir -p /srv/gitlab/gitlab-runner&gt; docker run -d --name gitlab-runner --restart always \\ -v /var/run/docker.sock:/var/run/docker.sock \\ -v /srv/gitlab-runner/config:/etc/gitlab-runner \\ gitlab/gitlab-runner:latest åœ¨gitlab ä¸Šåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ‰“å¼€é¡¹ç›®CIè®¾ç½®ï¼Œåœ¨é¡¹ç›®é‡Œé¢æ·»åŠ ä¸€ä¸ª gitlab-runner æ·»åŠ ç•Œé¢ä¼šæä¾›ä¸€ä¸ªã€Œgitlab-ci tokenã€ï¼š UbK4qdLj1hvBsVxTSUJ5 123456789101112131415161718192021222324 &gt; docker exec -it gitlab-runner bash&gt; gitlab-ci-multi-runner register \\ --docker-volumes /var/run/docker.sock:/var/run/docker.sock \\ --docker-privilegedRunning in system-mode.Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):http://gitlab.jajabjbj.top/Please enter the gitlab-ci token for this runner:UbK4qdLj1hvBsVxTSUJ5Please enter the gitlab-ci description for this runner:[4857c90d8789]: mac-dockerPlease enter the gitlab-ci tags for this runner (comma separated):Whether to lock the Runner to current project [true/false]:[true]: falseRegistering runner... succeeded runner=UbK4qdLjPlease enter the executor: shell, ssh, docker+machine, docker, docker-ssh, parallels, virtualbox, docker-ssh+machine, kubernetes:dockerPlease enter the default Docker image (e.g. ruby:2.1):nodeRunner registered successfully. Feel free to start it, but if it&#x27;s running already the config should be automatically reloaded! æ³¨æ„gitlab-ci ä¸­è¦ä½¿ç”¨docker in docker æ—¶, å¿…é¡»åœ¨gitlab-ci.yml ä¸­æ·»åŠ  docker:dind ï¼š 123image: docker:latestservices: - docker:dind","tags":[{"name":"gitlab-ci","slug":"gitlab-ci","permalink":"http://blog.jajabjbj.top/tags/gitlab-ci/"}]},{"title":"ä½¿ç”¨ nginx-proxy å®ç°å¤šä¸ª dockerå®¹å™¨ä»¥ä¸åŒçš„åŸŸåå…±äº«å®¿ä¸»æœº80ç«¯å£å¯¹å¤–æä¾›æœåŠ¡","date":"2018-05-30T00:00:00.000Z","path":"2018/05/30/2018-05-31/","text":"ä½¿ç”¨ nginx-proxy å®ç°å¤šä¸ª docker å®¹å™¨ä»¥ä¸åŒçš„åŸŸåå…±äº«å®¿ä¸»æœº80ç«¯å£å¯¹å¤–æä¾›æœåŠ¡12docker run -d -p 80:80 -p 443:443 -v /var/run/docker.sock:/tmp/docker.sock:ro -v /data/cert:/etc/nginx/certs \\ --name my-nginx-proxy jwilder/nginx-proxy","tags":[{"name":"docker","slug":"docker","permalink":"http://blog.jajabjbj.top/tags/docker/"}]},{"title":"æœ¬åœ°å®‰è£… kubernetes ç¯å¢ƒ","date":"2018-05-30T00:00:00.000Z","path":"2018/05/30/2018-06-03/","text":"å®‰è£… k8s å‡†å¤‡å®‰è£… Kubernetes https://yq.aliyun.com/articles/221687 Mac OSX 1curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v0.25.2/minikube-darwin-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ Linux 1curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v0.25.2/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ Windows ä¸‹è½½ minikube-windows-amd64.exe æ–‡ä»¶ï¼Œå¹¶é‡å‘½åä¸º minikube.exe è‡ªå·±æ„å»º ä¹Ÿå¯ä»¥ä»Githubä¸Šè·å–ç›¸åº”çš„é¡¹ç›®è‡ªè¡Œæ„å»ºã€‚ æ³¨ï¼šéœ€è¦æœ¬åœ°å·²ç»å®‰è£…é…ç½®å¥½ Golang å¼€å‘ç¯å¢ƒå’ŒDockerå¼•æ“ 12345git clone https://github.com/AliyunContainerService/minikubecd minikubegit checkout aliyun-v0.25.0makesudo cp out/minikube /usr/local/bin/ å¯åŠ¨ k8s &amp; docker ç¼ºçœMinikubeä½¿ç”¨VirtualBoxé©±åŠ¨æ¥åˆ›å»ºKubernetesæœ¬åœ°ç¯å¢ƒ 1minikube start --registry-mirror=https://registry.docker-cn.com æ‰“å¼€Kubernetesæ§åˆ¶å° 1minikube dashboard","tags":[{"name":"k8s","slug":"k8s","permalink":"http://blog.jajabjbj.top/tags/k8s/"}]},{"title":"CSS å¸¸ç”¨ä»£ç é”¦å›Š","date":"2018-05-22T00:00:00.000Z","path":"2018/05/22/2018-05-22-1/","text":"CSS å¸¸ç”¨ä»£ç é”¦å›Š ä¸‰è¡Œæ–‡æœ¬æº¢å‡ºæ˜¾ç¤ºçœç•¥å· 1234567891011121314151617181920212223242526.textOverflow3 &#123; overflow: hidden; position: relative; line-height: 1.5em; max-height: 4.5em; text-align: justify; margin-right: -1em; padding-right: 1em; &amp;:before &#123; background: #000; content: &#x27;...&#x27;; padding: 0 1px; position: absolute; right: 14px; bottom: 0; &#125; &amp;:after &#123; background: white; content: &#x27;&#x27;; margin-top: 0.2em; position: absolute; right: 14px; width: 1em; height: 1em; &#125;&#125; æ–‡æœ¬æº¢å‡ºçœç•¥ 123456789101112.textoverflow a &#123; display:block; width:120px; margin: 0px 0px 0px 3px; white-space: nowrap; overflow: hidden; float: left; -o-text-overflow: ellipsis; /* for Opera */ text-overflow: ellipsis; /* for IE */&#125;.textoverflow:after&#123; content: &quot;...&quot;; &#125;/* for Firefox */@media all and (min-width: 0px)&#123; .textoverflow:after&#123; content:&quot;&quot;; &#125;/* for Opera */ &#125; å¤šæ CSS3 ä½¿ç”¨css3æ¥åˆ›å»ºå¤šæ ï¼Œå®ƒå¯ä»¥è‡ªé€‚åº”ç½‘é¡µï¼Œä¸å…¼å®¹IE 123456789#columns-3 &#123; text-align: justify; -moz-column-count: 3; -moz-column-gap: 12px; -moz-column-rule: 1px solid #c4c8cc; -webkit-column-count: 3; -webkit-column-gap: 12px; -webkit-column-rule: 1px solid #c4c8cc;&#125; See the Pen 2048 game by Cam Song (@camsong) on CodePen. ---","tags":[{"name":"css","slug":"css","permalink":"http://blog.jajabjbj.top/tags/css/"}]},{"title":"git å¸¸ç”¨å‘½ä»¤é”¦å›Š","date":"2018-05-22T00:00:00.000Z","path":"2018/05/22/2018-05-22/","text":"git å¸¸ç”¨å‘½ä»¤é”¦å›Š è·å–å½“å‰ é¡¹ç›® git url 12git remote show # origingit config remote.origin.url # &#123;git url&#125; è·å–å½“å‰åˆ†æ”¯ 1git symbolic-ref --short -q HEAD # master","tags":[{"name":"git","slug":"git","permalink":"http://blog.jajabjbj.top/tags/git/"}]},{"title":"æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº demo å›¾åºŠ","date":"2018-05-20T00:00:00.000Z","path":"2018/05/20/2018-05-23/","text":"æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº demo å›¾åºŠ Github: https://github.com/yunqiangwu/jj-image-bed.git åŸºäºWebpackå·¥ç¨‹åŒ–è§£å†³æ–¹æ¡ˆeasywebpackæ„å»ºé¡¹ç›®åŸºäº Egg + React + Webpack3 + ä¸ƒç‰›äº‘å­˜å‚¨ å•é¡µé¢æœåŠ¡ç«¯æ¸²æŸ“åŒæ„å·¥ç¨‹å›¾åºŠDemoé¡¹ç›® Egg ç‰ˆæœ¬ï¼š ^2.x.x Node ç‰ˆæœ¬: Node ^8.x.x+ Webpack ç‰ˆæœ¬: ^3.10.0, å¯¹åº” easywebpack-react ç‰ˆæœ¬ä¸º 3.6.0 React ç‰ˆæœ¬: ^15.0.0, ^16.0.0, qiniu ç‰ˆæœ¬: 7.1.7 ç‰¹æ€§ åŸºäº React å•é¡µé¢æœåŠ¡ç«¯å®¢æˆ·ç«¯åŒæ„å®ç° æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ render å’Œçº¯å‰ç«¯æ¸²æŸ“ renderClient æ”¯æŒ react-router, react-redux æœåŠ¡ç«¯&#x2F;å®¢æˆ·ç«¯å•é¡µé¢æ¸²æŸ“ Node 8 ç‰ˆæœ¬çš„ async å’Œ await ç‰¹æ€§, Controller é‡‡ç”¨ class æ–¹å¼ç¼–å†™ å›¾ç‰‡ä¿å­˜åˆ°ä¸ƒç‰›äº‘ æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡ ä¾èµ– easywebpack ^3.5.3 easywebpack-react ^3.5.0 egg-view-react-ssr ^2.1.0 egg-webpack ^2.4.6 egg-webpack-react ^2.0.0 ä½¿ç”¨Clone é¡¹ç›®1git clone https://github.com/yunqiangwu/jj-image-bed.git å®‰è£…ä¾èµ–12npm installnpm start å¯åŠ¨åº”ç”¨1npm start åº”ç”¨è®¿é—®: http://127.0.0.1:7001 é¡¹ç›®æ„å»º12345// ç›´æ¥è¿è¡Œ(ç¼–è¯‘æ–‡ä»¶å…¨éƒ¨åœ¨å†…å­˜é‡Œé¢,æœ¬åœ°å¼€å‘ä½¿ç”¨)npm start// ç¼–è¯‘æ–‡ä»¶åˆ°ç£ç›˜æ‰“åŒ…ä½¿ç”¨(å‘å¸ƒæ­£å¼ç¯å¢ƒ)npm run build æˆ–è€… easywebpack build prod é¡¹ç›®æˆªå›¾ TODO æ‹–æ‹½ä¸Šä¼  ç²˜è´´å›¾ç‰‡ ç›¸å†Œç®¡ç† LicenseMIT","tags":[{"name":"webpack","slug":"webpack","permalink":"http://blog.jajabjbj.top/tags/webpack/"}]},{"title":"ã€Šæ·±å…¥æµ…å‡ºNodeJSã€‹ è¯»ä¹¦å­¦ä¹ æ€»ç»“","date":"2018-05-20T00:00:00.000Z","path":"2018/05/20/abcd-a-d-asd/","text":"ã€Šæ·±å…¥æµ…å‡ºNodeJSã€‹ è¯»ä¹¦å­¦ä¹ æ€»ç»“ æˆæœ æ–‡æ¡£: JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§ é¡¹ç›® node çˆ¬è™« æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº demo å›¾åºŠ è¯»ä¹¦ç¬”è®° NodeJS 5ä¸ªç‰¹ç‚¹ï¼šå¼‚æ­¥I&#x2F;O,äº‹ä»¶é©±åŠ¨ä¸å›è°ƒï¼Œå•çº¿ç¨‹äº‹ä»¶è½®è¯¢ï¼Œè·¨å¹³å°ã€‚ NodeJS 5ä¸ªå¤§å‘ï¼šå¼‚å¸¸å¤„ç†ï¼ŒåµŒå¥—å¤ªæ·±ï¼Œæ²¡æœ‰Sleepï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå¼‚æ­¥è½¬åŒæ­¥ã€‚ NodeJS 4ç§æå‡æ€§èƒ½çš„æ–¹æ³•ï¼šåŠ¨é™åˆ†ç¦»ï¼Œç¼“å­˜ï¼ˆRedisï¼‰,å¤šè¿›ç¨‹ï¼Œæ•°æ®åº“è¯»å†™åˆ†ç¦»ã€‚ NodeJSç®€ä»‹ é«˜æ€§èƒ½ï¼Œç¬¦åˆæ—¶é—´é©±åŠ¨ï¼Œæ²¡æœ‰å†å²åŒ…è¢±è¿™ä¸‰ä¸ªä¸»è¦åŸå› ï¼ŒJavaScriptæˆä¸ºäº†Nodeçš„å®ç°è¯­è¨€ã€‚ NodeJSåŸºäºGoogle V8å¼•æ“ã€‚Nodeä¼˜ç§€çš„è¿ç®—èƒ½åŠ›ä¸»è¦æ¥è‡ªV8çš„æ·±åº¦ä¼˜åŒ–ã€‚ NodeJSç‰¹ç‚¹ï¼šå¼‚æ­¥I&#x2F;O,äº‹ä»¶é©±åŠ¨ä¸å›è°ƒå‡½æ•°ï¼Œå•çº¿ç¨‹äº‹ä»¶è½®è¯¢ï¼Œè·¨å¹³å° NodeJSå•çº¿ç¨‹çš„ç¼ºç‚¹ï¼š æ— æ³•åˆ©ç”¨å¤šæ ¸CPU. é”™è¯¯ä¼šå¼•èµ·æ•´ä¸ªåº”ç”¨è¿›ç¨‹é€€å‡ºã€‚ å¤§é‡è®¡ç®—å ç”¨CPUå¯¼è‡´æ— æ³•ç»§ç»­è°ƒç”¨å¼‚æ­¥I&#x2F;O. è§£å†³å•çº¿ç¨‹ç¼ºç‚¹çš„æ–¹æ³•æ˜¯å¼•å…¥å­è¿›ç¨‹æ–¹æ³•ï¼ˆCluster,è§åè¾¹ï¼‰å’ŒC&#x2F;C++æ¨¡å—æ‰©å±•ï¼ˆåˆ©ç”¨å®ƒä»¬çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼‰ã€‚ æ¨¡å—æœºåˆ¶ Nodeå‡ºç°ä¹‹å‰ï¼ŒæœåŠ¡å™¨ç«¯çš„JSåŸºæœ¬æ²¡æœ‰å¸‚åœºçš„ã€‚ CommonJSä¸»è¦æ˜¯ä¸ºäº†å¼¥è¡¥å½“å‰JSæ²¡æœ‰æ ‡å‡†çš„ç¼ºé™·ï¼Œå¸Œæœ›JSèƒ½å¤Ÿåœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚ æ¨¡å—å¼•ç”¨var xxx = require(â€˜æ¨¡å—æ ‡è¯†â€™); ä¾‹å¦‚ï¼švar math = require(â€˜mathâ€™); æ¨¡å—å®šä¹‰æ¨¡å—ä¸­moduleå¯¹è±¡ä»£è¡¨æ¨¡å—è‡ªèº«ï¼Œexportså¯¹è±¡æ˜¯moduleçš„å±æ€§ï¼Œç”¨äºå¯¼å‡ºå½“å‰æ¨¡å—çš„æ–¹æ³•æˆ–è€…å˜é‡ï¼Œå®ƒæ˜¯å”¯ä¸€å¯¼å‡ºçš„å‡ºå£ã€‚moduleå’Œexportsæ˜¯nodeåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç»™åŠ ä¸Šå»çš„ã€‚ NodeJSä¸­ï¼Œä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå°†æ–¹æ³•æˆ–è€…å˜é‡æŒ‚åœ¨åœ¨exportså¯¹è±¡ä¸Šä½œä¸ºå±æ€§å³å¯å®šä¹‰å¯¼å‡ºçš„æ–¹å¼: 12345678910111213exports.xxx = â€¦â€¦ä¾‹å¦‚ï¼š exports.add = function()&#123;var sum = 0;var i = 0;â€¦.return sum;&#125; ï¼ˆexportså’Œmodule.exportsåŒºåˆ«è§åï¼‰ æ¨¡å—æ ‡è¯†å°±æ˜¯ä¼ ç»™require()çš„å‚æ•°ã€‚å®ƒå¿…é¡»ç¬¦åˆå°é©¼å³°å‘½åçš„å­—ç¬¦ä¸²ï¼Œæˆ–è€…ä»¥ã€‚ï¼Œã€‚ã€‚å¼€å¤´çš„ç›¸å¯¹è·¯å¾„ï¼Œæˆ–è€…ç»å¯¹è·¯å¾„ã€‚å¯ä»¥æœ‰æˆ–è€…æ²¡æœ‰æ–‡ä»¶åç¼€åï¼ˆæœ€å¥½æœ‰åç¼€ï¼Œp&#x2F;17ï¼‰. æ¨¡å—æ ‡è¯†åˆ†ç±»: æ ¸å¿ƒæ¨¡å—ï¼Œå¦‚http, fs, pathç­‰ã€‚ .æˆ–è€…..å¼€å§‹çš„ç›¸å¯¹è·¯å¾„æ–‡ä»¶æ¨¡å—ã€‚ ä»¥&#x2F;å¼€å§‹çš„ç»å¯¹è·¯å¾„æ–‡ä»¶æ¨¡å—ã€‚ éè·¯å¾„å½¢å¼çš„æ–‡ä»¶æ¨¡å—ï¼Œå¦‚è‡ªå®šä¹‰çš„connectæ¨¡å—ã€‚ Nodeä¸­å¼•å…¥æ¨¡å—æ­¥éª¤ï¼ˆæ‰¾æ–‡ä»¶-&gt;æ‰¾æ–‡ä»¶æ‰©å±•å-&gt;ç¼–è¯‘æ‰§è¡Œï¼‰ è·¯å¾„åˆ†æï¼šå®šä½æ–‡ä»¶ä½ç½®ï¼Œæ ‡è¯†ç¬¦ä¸­æœ‰è·¯å¾„ï¼Œç”šè‡³æ²¡æœ‰ã€‚ æ–‡ä»¶å®šä½ï¼šæ ‡è¯†ç¬¦ä¸­æ²¡æœ‰æ–‡ä»¶æ‰©å±•åï¼Œæ‰€ä»¥éœ€è¦ç¡®å®šç±»å‹ã€‚ ç¼–è¯‘æ‰§è¡Œï¼šä¸åŒæ–‡ä»¶ç±»å‹ï¼Œè½½å…¥æ–¹å¼ä¸ä¸€æ ·ã€‚ Nodeä¸­æ¨¡å—åˆ†ç±» æ ¸å¿ƒæ¨¡å—ï¼ˆNodeæä¾›ï¼‰ï¼šæ ¸å¿ƒæ¨¡å—åœ¨Nodeæºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘è¿›äº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨Nodeè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œéƒ¨åˆ†æ ¸å¿ƒæ¨¡å—å°±è¢«åŠ è½½è¿›å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æ ¸å¿ƒæ¨¡å—å¼•å…¥æ—¶ï¼Œæ–‡ä»¶å®šä½å’Œç¼–è¯‘æ‰§è¡Œä¸¤æ­¥çœç•¥æ‰ï¼Œä¸”åœ¨è·¯å¾„åˆ†ææ—¶ä¼˜å…ˆåˆ¤æ–­ï¼Œæ‰€ä»¥æ ¸å¿ƒæ¨¡å—åŠ è½½é€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚ æ–‡ä»¶æ¨¡å—ï¼ˆç”¨æˆ·ç¼–å†™ï¼‰ï¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œä¸‰æ­¥éª¤éƒ½éœ€è¦ã€‚Nodeå¯¹å¼•ç”¨è¿‡çš„æ¨¡å—éƒ½ä¼šè¿›è¡Œç¼“å­˜ï¼Œä»¥å‡å°‘äºŒæ¬¡å¼•å…¥æ—¶çš„å¼€é”€ã€‚ æ¨¡å—è·¯å¾„åˆ†æç­–ç•¥å³nodeåœ¨å®šä½æ–‡ä»¶æ¨¡å—çš„å…·ä½“æ–‡ä»¶æ—¶æŒ‡å®šçš„æŸ¥æ‰¾ç­–ç•¥ã€‚å…¶ç­–ç•¥æ˜¯ä»å½“å‰node-moduleså¼€å§‹ä¸€çº§ä¸€çº§å‘æ ¹çš„node-modulesæŸ¥æ‰¾ï¼Œæ ¸å¿ƒæ¨¡å—æœ€å¿«ï¼Œç›¸å¯¹ã€ç»å¯¹è·¯å¾„æ¨¡å—æ¬¡ä¹‹ï¼Œè‡ªå®šä¹‰æ–‡ä»¶æ¨¡å—æœ€æ…¢ã€‚æ‰€ä»¥å¼•ç”¨æ¨¡å—æ—¶ï¼Œæœ€å¥½åŠ ä¸Šè·¯å¾„ä»¥åŠæ‰©å±•åï¼ æ–‡ä»¶å®šä½ç­–ç•¥ å› ä¸ºæ¨¡å—æ ‡è¯†ç¬¦ä¸­å¯ä»¥ä¸åŒ…å«æ–‡ä»¶æ‰©å±•åï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒNodeä¼šæŒ‰ç…§.js, .json, .nodeçš„æ¬¡åºè¡¥è¶³æ‰©å±•åï¼Œä¾æ¬¡å°è¯•ã€‚åœ¨å°è¯•çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è°ƒfsæ¨¡å—çš„åŒæ­¥é˜»å¡å¼çš„åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥æœ€å¥½ä¼ å…¥æ–‡ä»¶æ‰©å±•åã€‚ requireï¼ˆï¼‰é€šè¿‡åˆ†ææ–‡ä»¶æ‰©å±•ä¹‹åï¼Œå¯èƒ½æ²¡æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œä½†å´å¾—åˆ°äº†ä¸€ä¸ªç›®å½•ï¼Œæ­¤æ—¶nodeä¼šå°†ç›®å½•å½“åšä¸€ä¸ªåŒ…æ¥å‡ºæ¥ï¼ˆnodeå¯¹åŒ…å¤„ç†ä¼šéµå®ˆCommonJSåŒ…è§„èŒƒï¼‰ã€‚ Nodeä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶æ¨¡å—éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®šä½åˆ°å…·ä½“çš„æ–‡ä»¶åï¼ŒNodeä¼šæ–°å»ºä¸€ä¸ªæ¨¡å—å¯¹è±¡ï¼Œç„¶åæ ¹æ®è·¯å¾„è½½å…¥å¹¶ç¼–è¯‘ã€‚ä¸åŒçš„æ–‡ä»¶æ‰©å±•åï¼Œå…¶è½½å…¥å’Œç¼–è¯‘çš„æ–¹æ³•ä¹Ÿä¸ä¸€æ ·ï¼š .jsæ–‡ä»¶ï¼šé€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åç¼–è¯‘æ‰§è¡Œã€‚ .nodeæ–‡ä»¶ï¼šè¿™æ˜¯C&#x2F;C++ç¼–å†™çš„æ‰©å±•æ–‡ä»¶ï¼Œé€šè¿‡process.dlopenï¼ˆï¼‰æ–¹æ³•åŠ è½½å’Œæ‰§è¡Œã€‚å®ƒä¸éœ€è¦ç¼–è¯‘ï¼Œå› ä¸ºå®ƒæ˜¯ç¼–å†™C&#x2F;C++æ¨¡å—ä¹‹åç¼–è¯‘ç”Ÿæˆçš„. C&#x2F;C++å¸¦æ¥çš„ä¼˜åŠ¿ä¸»è¦æ˜¯æ‰§è¡Œæ•ˆç‡æ–¹é¢çš„ã€‚ .jsonæ–‡ä»¶ï¼šé€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åï¼Œç”¨JSON.parse()è§£æè¿”å›ç»“æœã€‚ .å…¶ä½™æ‰©å±•åæ–‡ä»¶ï¼šå½“åš.jsæ–‡ä»¶å¤„ç†ã€‚ JSæ¨¡å—ä¸­require, exports, moduleè¿™ä¸‰ä¸ªå˜é‡åœ¨æ¨¡å—ä¸­å¹¶æ²¡æœ‰å®šä¹‰ï¼Œæ˜¯nodeåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç»™åŠ ä¸Šçš„ï¼Œè¿™æ ·æ¯ä¸ªæ¨¡å—ä¸­è¿™ä¸‰ä¸ªå˜é‡çš„ä½œç”¨åŸŸæ˜¯éš”ç¦»çš„ã€‚ exportså’Œmodule.exportsåŒºåˆ«ï¼š exportsæŒ‡å‘module.exportsçš„å¼•ç”¨, requireï¼ˆï¼‰è¿”å›çš„æ˜¯module.exportsè€Œä¸æ˜¯exports.å¦‚æœmodule.exportsæŒ‡å‘äº†ä¸€ä¸ªæ–°å¯¹è±¡åˆ™exportsåˆ™æ–­å¼€äº†å¯¹module.exportsçš„å¼•ç”¨ã€‚åˆšå¼€å§‹module.exportsä¸ºç©ºå¯¹è±¡ï¼Œæ‰€ä»¥exportsæ”¶é›†çš„å±æ€§å’Œæ–¹æ³•éƒ½èµ‹ç»™module.exportsï¼Œè€Œä¸€æ—¦module.exportsæœ‰äº†å±æ€§ï¼Œæ–¹æ³•ï¼Œåˆ™exportsæ”¶é›†çš„ä¿¡æ¯å°†è¢«å¿½ç•¥ï¼Œæ‰€ä»¥åœ¨ä¸è°ƒç”¨module.exportsæ—¶ï¼Œé‡‡ç”¨exports. Nodeçš„æ ¸å¿ƒæ¨¡å—åœ¨ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ä¸­è¢«ç¼–è¯‘è¿›äº†äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ ¸å¿ƒæ¨¡å—åˆ†ä¸ºC&#x2F;C++ç¼–å†™çš„å’ŒJSç¼–å†™çš„ä¸¤éƒ¨åˆ†ã€‚è€Œåœ¨ç¼–è¯‘æ‰€æœ‰çš„C&#x2F;C++æ–‡ä»¶ä¹‹å‰ï¼Œç¼–è¯‘ç¨‹åºéœ€è¦å°†æ‰€æœ‰çš„JSæ¨¡å—æ–‡ä»¶ç¼–è¯‘ä¸ºC&#x2F;C++ä»£ç ã€‚ åŒ…åŒ…å’ŒNPMæ˜¯å°†æ¨¡å—è”ç³»èµ·æ¥çš„ä¸€ç§æœºåˆ¶ åŒ…ç»„ç»‡æ¨¡å—ç¤ºæ„å›¾ï¼šåŒ…å®é™…ä¸Šæ˜¯ä¸€ä¸ªå­˜æ¡£æ–‡ä»¶ï¼Œå³ä¸€ä¸ªç›®å½•ç›´æ¥æ‰“åŒ…ä¸º.zipï¼Œå®‰è£…è§£å‹è¿˜åŸä¸ºç›®å½•ã€‚ åŒ…ç»“æ„ï¼š package.json:åŒ…æè¿°æ–‡ä»¶ã€‚ï¼ˆè¯¦ç»†è¯´æ˜p&#x2F;35ï¼‰ bin:ç”¨äºå­˜æ”¾å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®å½•ã€‚ Lib:ç”¨äºå­˜æ”¾jsä»£ç çš„ç›®å½•ã€‚ Doc:å­˜æ”¾æ–‡æ¡£çš„ç›®å½•ã€‚ Test:å­˜æ”¾å•å…ƒæµ‹è¯•ç”¨ä¾‹çš„ä»£ç ã€‚ äº§å“åŒ–æ„å»ºå·¥å…·æ„å»ºå·¥å…·å®Œæˆçš„åŠŸèƒ½ä¸»è¦æ˜¯åˆå¹¶é™æ€æ–‡ä»¶ï¼Œå‹ç¼©æ–‡ä»¶å¤§å°ï¼Œæ‰“åŒ…åº”ç”¨ï¼Œç¼–è¯‘æ¨¡å—ç­‰ã€‚Gruntæ˜¯è·¨å¹³å°çš„æ„å»ºå·¥å…·ï¼Œå®ƒé€šè¿‡Nodeå†™æˆï¼Œå€ŸåŠ©Nodeçš„è·¨å¹³å°èƒ½åŠ›ï¼Œå®ç°äº†å¾ˆå¥½çš„å¹³å°å…¼å®¹æ€§ã€‚ä»£ç æ£€æµ‹å·¥å…·JSLintå¯ä»¥é€šè¿‡gitlabç­‰å¼€æºå·¥å…·æ­å»ºäº†å†…éƒ¨çš„ä»£ç æ‰˜ç®¡å¹³å°ã€‚ Nodeæå‡æ€§èƒ½çš„4ä¸ªæ–¹æ³•ï¼š åŠ¨é™åˆ†ç¦»ï¼šnodeå¤„ç†é™æ€æ–‡ä»¶çš„èƒ½åŠ›ä¸ç®—çªå‡ºã€‚å°†å›¾ç‰‡ï¼Œè„šæœ¬ï¼Œæ ·å¼è¡¨å’Œå¤šåª’ä½“ç­‰é™æ€æ–‡ä»¶éƒ½å¯¼å…¥åˆ°ä¸“ä¸šçš„é™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼ˆæ¯”å¦‚Nginxï¼‰ä¸Š,è®©nodeåªå¤„ç†åŠ¨æ€è¯·æ±‚å³å¯ã€‚ å¯ç”¨ç¼“å­˜Redisæˆ–Memcached. å¤šè¿›ç¨‹æ¶æ„â€“ clusteræ¨¡å—ã€‚ æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼šå°±ä»»æ„æ•°æ®åº“è€Œè¨€ï¼Œè¯»å–çš„é€Ÿåº¦è¿œè¿œé«˜äºå†™å…¥çš„é€Ÿåº¦ã€‚è€ŒæŸäº›æ•°æ®åº“åœ¨å†™å…¥æ—¶ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä¼šè¿›è¡Œé”è¡¨æ“ä½œï¼Œè¿™åŒæ—¶ä¼šå½±å“åˆ°è¯»å–çš„é€Ÿåº¦ã€‚ä¸ºäº†æå‡æ€§èƒ½ï¼Œé€šå¸¸ä¼šè¿›è¡Œæ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ï¼Œå°†æ•°æ®åº“è¿›è¡Œä¸»ä»è®¾è®¡ã€‚è¿™æ ·è¯»æ•°æ®æ“ä½œä¸å†å—å†™å…¥çš„å½±å“äº†ã€‚ æ—¥å¿—åœ¨nodeä¸­å¯ç”¨connectæä¾›çš„æ—¥å¿—ä¸­é—´ä»¶æ¥è®°å½•è®¿é—®æ—¥å¿—ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥åœ¨Nginxåå‘ä»£ç†é‡Œè®°å½•è®¿é—®æ—¥å¿—ã€‚å¼‚å¸¸æ—¥å¿—çš„å®ç°ï¼šp&#x2F;296-298Nodeé€šè¿‡nodemaileræ¨¡å—å®ç°é‚®ä»¶æŠ¥è­¦ã€‚ è°ƒè¯•NodeJSNodeè°ƒè¯•å¯ç”¨ä¸‰ç§æ–¹æ³•ï¼šDebugger, console.log()å’ŒNode-InspectorDebugger:éœ€è¦é€šè¿‡debugger;è¯­å¥åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹ã€‚ä½¿ç”¨æ–¹æ³•p&#x2F;310 - 311Node-Insepector:å¯åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œè°ƒè¯• æˆ–è€…å…¬å…±idea å·¥å…·è°ƒè¯•ã€‚ ç¼–ç¨‹è§„èŒƒ ç¼©è¿›ï¼šé‡‡ç”¨ä¸¤ä¸ªç©ºæ ¼è€Œä¸æ˜¯Tab å˜é‡å£°æ˜ï¼šæ°¸è¿œç”¨varå£°æ˜å˜é‡ ç©ºæ ¼ï¼šæ“ä½œç¬¦å‰åéœ€è¦åŠ ç©ºæ ¼ å•åŒå¼•å·çš„ä½¿ç”¨ï¼šå°½é‡ä½¿ç”¨å•å¼•å·ï¼Œè¿™æ ·æ— éœ€è½¬è¯‘ å¤§æ‹¬å·çš„ä½ç½®ï¼šå¤§æ‹¬å·{æ— éœ€å¦èµ·ä¸€è¡Œ é€—å·ï¼šå¦‚æœé€—å·ä¸åœ¨è¡Œç»“å°¾ï¼Œåé¢éœ€è¦ä¸€ä¸ªç©ºæ ¼ åˆ†å·ï¼šç»™è¡¨è¾¾å¼ç»“å°¾æ·»åŠ åˆ†å· å˜é‡å‘½åï¼šå°é©¼å³°å¼ æ–¹æ³•å‘½åï¼šå°é©¼å³°å¼ ç±»å‘½åï¼šå¤§é©¼å³°å¼ å¸¸é‡å‘½åï¼šæ‰€æœ‰å­—æ¯å¤§å†™ï¼Œä»¥ä¸‹åˆ’çº¿åˆ†å‰² æ–‡ä»¶å‘½åï¼šé‡‡ç”¨ä¸‹åˆ’çº¿åˆ†å‰²å•è¯","tags":[{"name":"nodejs","slug":"nodejs","permalink":"http://blog.jajabjbj.top/tags/nodejs/"}]},{"title":"JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§","date":"2018-05-10T00:00:00.000Z","path":"2018/05/10/2018-05-19/","text":"JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§JavaScriptå¼‚æ­¥ç¼–ç¨‹æœºåˆ¶JavaScriptå¼‚æ­¥ç¼–ç¨‹æœºåˆ¶ç®€å•æ¥è¯´å°±æ˜¯ callback æœºåˆ¶å®ç°çš„æ•ˆæœã€‚callbackå½¢å¼çš„ä»£ç å†™å¤æ‚çš„å¼‚æ­¥ç¼–ç¨‹ï¼Œå¾ˆå®¹æ˜“å‡ºç°callbackåœ°ç‹±çš„é—®é¢˜ï¼Œä¸åˆ©äºä»£ç çš„ç»´æŠ¤å’Œç®¡ç†ï¼Œè€ŒPromiseå’Œes6çš„asyncå¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿å¾—å†™å¼‚æ­¥ç¼–ç¨‹ç¼–çš„éå¸¸ç®€å•ã€‚ Promiseæ˜¯ä»€ä¹ˆç®€å•æ¥è¯´ï¼ŒPromise ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³å¼‚æ­¥å›è°ƒçš„é—®é¢˜ã€‚ç”¨ Promise æ¥å¤„ç†å¼‚æ­¥å›è°ƒä½¿å¾—ä»£ç å±‚æ¬¡æ¸…æ™°ï¼Œä¾¿äºç†è§£ï¼Œä¸”æ›´åŠ å®¹æ˜“ç»´æŠ¤ã€‚å…¶ä¸»æµè§„èŒƒç›®å‰ä¸»è¦æ˜¯ Promises&#x2F;A+ ã€‚Promise åŸç†å¤§æ¦‚å°±ç±»ä¼¼è¿™ä¸ªæ ·å­ 123456789101112131415161718// demo.1.jsfunction Promise(fn) &#123; let callback; let rejectCallback; //ä¸€ä¸ªå®ä¾‹çš„æ–¹æ³•ï¼Œç”¨æ¥æ³¨å†Œå¼‚æ­¥äº‹ä»¶ this.then = function (done, errCallback) &#123; callback = done; rejectCallback = errCallback; &#125; function resolve() &#123; callback(); &#125; try &#123; fn(resolve); &#125; catch (e) &#123; rejectCallback(e); &#125;&#125; ä½¿ç”¨Promise 12345678910111213function timeout3(callback) &#123; setTimeout(() =&gt; &#123; callback(&#x27;abcd&#x27;) &#125;, 3000)&#125;new Promise(timeout3).then((data) =&gt; &#123; console.log(3)&#125;);// # console: // 3 (ä¸‰ç§’åå±å¹•å‡ºç° ) è¿™é‡Œåªæ˜¯ç®€å•çš„æ¨¡æ‹Ÿä¸€ä¸‹Promiseçš„ä»£ç ï¼Œè¿˜æœ‰ä¸€ä¸‹Promiseçš„apiæ²¡æœ‰å…¨éƒ¨å®ç°ï¼Œå¯ä»¥å»æ·±å…¥ç ”ç©¶Promiseçš„æºç ï¼Œææ‡‚ Promiseçš„ å®ç°åŸç†ï¼Œèƒ½æ”¹ä½¿ç”¨Promiseç¼–ç¨‹æ›´åŠ å¾—å¿ƒåº”æ‰‹çš„. ä½¿ç”¨Promiseå°è£… node çš„ http.requestæ–¹æ³•ï¼Œå®ç°ç®€å•çš„ fetch api æ•ˆæœå°è£…fetch API123456789101112131415161718192021222324252627282930313233343536373839404142// demo.2.jsconst http=require(&#x27;http&#x27;);const fetch = (url,fetchOptions = &#123;&#125;) =&gt;&#123; return new Promise((resolve, reject)=&gt;&#123; var match = /((http|ftp|https):\\/\\/)((([a-zA-Z0-9\\._-]+\\.[a-zA-Z]&#123;2,6&#125;)|([0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;\\.[0-9]&#123;1,3&#125;))(:[0-9]&#123;1,4&#125;)*(\\/[a-zA-Z0-9\\&amp;\\%_\\.\\/-~-]*)?)/; const matchObj = match.exec(url); if(!matchObj)&#123; reject(&#123; message: url+&#x27;åŸŸåæ ¼å¼ä¸æ­£ç¡®&#x27;, &#125;); &#125; const [,,,,,hostname,,,,path] = matchObj; var options = &#123; &quot;method&quot;: &quot;GET&quot;, hostname, path, &#125;; var req = http.request(options, function (res) &#123; var chunks = []; res.on(&quot;data&quot;, function (chunk) &#123; chunks.push(chunk); &#125;); res.on(&#x27;error&#x27;, (e) =&gt; &#123; reject(e); &#125;) res.on(&quot;end&quot;, function () &#123; var body = Buffer.concat(chunks); resolve(&#123; json:()=&gt;Promise.resolve(JSON.parse(body.toString())), blob: ()=&gt;Promise.resolve(body), text: ()=&gt;Promise.resolve(body.toString()), &#125;); &#125;); &#125;); req.end(); &#125;);&#125; ç®€å•çš„è°ƒç”¨fetch123456fetch(&#x27;http://www.mmjpg.com/&#x27;) .then(data=&gt;data.text()) .then(str=&gt;&#123; // è¾“å‡ºç½‘é¡µæºç  console.log(str); &#125;) fetché“¾å¼è°ƒç”¨12345678910111213141516171819202122232425262728// demo.3.jsconst fetch = require(&#x27;./demo.2&#x27;);fetch(&#x27;http://www.mmjpg.com/&#x27;) .then(data =&gt; data.text()) .then(content =&gt; &#123; const url = /(http:\\/\\/www.mmjpg.com\\/mm\\/\\d+)/.exec(content)[1]; return fetch(url).then(data=&gt;data.text()) .then(data =&gt; &#123; const n = /var\\s*picinfo\\s*=\\s*\\[(\\d+),(\\d+),(\\d+),(\\d+)\\]/.exec(data)[3]; console.log(n); return Array.from(&#123;length: n&#125;).map((item,index)=&gt;&#123; return url+&#x27;/&#x27;+(index+1); &#125;); &#125;); &#125;) .then(imageUrls =&gt; &#123; console.log(imageUrls); &#125;)// # console:// 60// [ &#x27;http://www.mmjpg.com/mm/1355/1&#x27;,// ...// ...// &#x27;http://www.mmjpg.com/mm/1355/59&#x27;,// &#x27;http://www.mmjpg.com/mm/1355/60&#x27; ] fetchæŒ‰é¡ºåºæ‰¹é‡è·å–urlå†…å®¹1234567891011121314151617181920212223242526272829303132333435// demo.4.jsconst fetch = require(&#x27;./demo.2&#x27;);const imgUrls = [&#x27;http://www.mmjpg.com/mm/1355/1&#x27;, &#x27;http://www.mmjpg.com/mm/1355/2&#x27;, &#x27;http://www.mmjpg.com/mm/1355/3&#x27;, &#x27;http://www.mmjpg.com/mm/1355/4&#x27;, &#x27;http://www.mmjpg.com/mm/1355/7&#x27;, &#x27;http://www.mmjpg.com/mm/1355/8&#x27;, &#x27;http://www.mmjpg.com/mm/1355/57&#x27;, &#x27;http://www.mmjpg.com/mm/1355/58&#x27;, &#x27;http://www.mmjpg.com/mm/1355/59&#x27;, &#x27;http://www.mmjpg.com/mm/1355/60&#x27;];const fetchImg = (urls, index=0, currentResult = []) =&gt; &#123; const url = urls[index]; if (url) &#123; return fetch(url) .then(data =&gt; data.blob()) .then(buffer =&gt; &#123; console.log(&#x27;Progress: &#x27; + index + &#x27;/&#x27; + urls.length) return fetchImg(urls, index + 1, [...currentResult, buffer]) &#125;) &#125; else &#123; return Promise.resolve(currentResult); &#125;&#125;fetchImg(imgUrls) .then(bufferList =&gt; &#123; // save imgBuffer to file... console.log(bufferList.length); &#125;) // console: /*Progress: 0/60Progress: 1/60......Progress: 58/60Progress: 59/60*/ ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹Promise.allä¼˜åŒ–åçš„æ•ˆæœ12345678910111213// demo.5.jsconst fetch = require(&#x27;./demo.2&#x27;);const imgUrls = [&#x27;http://www.mmjpg.com/mm/1355/1&#x27;, &#x27;http://www.mmjpg.com/mm/1355/2&#x27;, &#x27;http://www.mmjpg.com/mm/1355/3&#x27;, &#x27;http://www.mmjpg.com/mm/1355/4&#x27;, &#x27;http://www.mmjpg.com/mm/1355/5&#x27;, &#x27;http://www.mmjpg.com/mm/1355/6&#x27;, &#x27;http://www.mmjpg.com/mm/1355/57&#x27;, &#x27;http://www.mmjpg.com/mm/1355/58&#x27;, &#x27;http://www.mmjpg.com/mm/1355/59&#x27;, &#x27;http://www.mmjpg.com/mm/1355/60&#x27;];Promise.all(imgUrls.map(url=&gt;fetch(url).then(data=&gt;data.blob()))) .then(bufferList=&gt; &#123; // save imgBuffer to file... console.log(bufferList.length); &#125;); es6ä¸­asyncä½¿ç”¨ Promise.all123456789101112131415// demo.6.jsconst fetch = require(&#x27;./demo.2&#x27;);const imgUrls = [&#x27;http://www.mmjpg.com/mm/1355/1&#x27;, &#x27;http://www.mmjpg.com/mm/1355/2&#x27;, &#x27;http://www.mmjpg.com/mm/1355/3&#x27;, &#x27;http://www.mmjpg.com/mm/1355/4&#x27;, &#x27;http://www.mmjpg.com/mm/1355/5&#x27;, &#x27;http://www.mmjpg.com/mm/1355/6&#x27;, &#x27;http://www.mmjpg.com/mm/1355/7&#x27;, &#x27;http://www.mmjpg.com/mm/1355/8&#x27;, &#x27;http://www.mmjpg.com/mm/1355/9&#x27;, &#x27;http://www.mmjpg.com/mm/1355/10&#x27;, &#x27;http://www.mmjpg.com/mm/1355/11&#x27;, &#x27;http://www.mmjpg.com/mm/1355/12&#x27;, &#x27;http://www.mmjpg.com/mm/1355/13&#x27;, &#x27;http://www.mmjpg.com/mm/1355/14&#x27;, &#x27;http://www.mmjpg.com/mm/1355/15&#x27;, &#x27;http://www.mmjpg.com/mm/1355/16&#x27;, &#x27;http://www.mmjpg.com/mm/1355/17&#x27;, &#x27;http://www.mmjpg.com/mm/1355/18&#x27;, &#x27;http://www.mmjpg.com/mm/1355/19&#x27;, &#x27;http://www.mmjpg.com/mm/1355/20&#x27;, &#x27;http://www.mmjpg.com/mm/1355/21&#x27;, &#x27;http://www.mmjpg.com/mm/1355/22&#x27;, &#x27;http://www.mmjpg.com/mm/1355/23&#x27;, &#x27;http://www.mmjpg.com/mm/1355/24&#x27;, &#x27;http://www.mmjpg.com/mm/1355/25&#x27;, &#x27;http://www.mmjpg.com/mm/1355/26&#x27;, &#x27;http://www.mmjpg.com/mm/1355/27&#x27;, &#x27;http://www.mmjpg.com/mm/1355/28&#x27;, &#x27;http://www.mmjpg.com/mm/1355/29&#x27;, &#x27;http://www.mmjpg.com/mm/1355/30&#x27;, &#x27;http://www.mmjpg.com/mm/1355/31&#x27;, &#x27;http://www.mmjpg.com/mm/1355/32&#x27;, &#x27;http://www.mmjpg.com/mm/1355/33&#x27;, &#x27;http://www.mmjpg.com/mm/1355/34&#x27;, &#x27;http://www.mmjpg.com/mm/1355/35&#x27;, &#x27;http://www.mmjpg.com/mm/1355/36&#x27;, &#x27;http://www.mmjpg.com/mm/1355/37&#x27;, &#x27;http://www.mmjpg.com/mm/1355/38&#x27;, &#x27;http://www.mmjpg.com/mm/1355/39&#x27;, &#x27;http://www.mmjpg.com/mm/1355/40&#x27;, &#x27;http://www.mmjpg.com/mm/1355/41&#x27;, &#x27;http://www.mmjpg.com/mm/1355/42&#x27;, &#x27;http://www.mmjpg.com/mm/1355/43&#x27;, &#x27;http://www.mmjpg.com/mm/1355/44&#x27;, &#x27;http://www.mmjpg.com/mm/1355/45&#x27;, &#x27;http://www.mmjpg.com/mm/1355/46&#x27;, &#x27;http://www.mmjpg.com/mm/1355/47&#x27;, &#x27;http://www.mmjpg.com/mm/1355/48&#x27;, &#x27;http://www.mmjpg.com/mm/1355/49&#x27;, &#x27;http://www.mmjpg.com/mm/1355/50&#x27;, &#x27;http://www.mmjpg.com/mm/1355/51&#x27;, &#x27;http://www.mmjpg.com/mm/1355/52&#x27;, &#x27;http://www.mmjpg.com/mm/1355/53&#x27;, &#x27;http://www.mmjpg.com/mm/1355/54&#x27;, &#x27;http://www.mmjpg.com/mm/1355/55&#x27;, &#x27;http://www.mmjpg.com/mm/1355/56&#x27;, &#x27;http://www.mmjpg.com/mm/1355/57&#x27;, &#x27;http://www.mmjpg.com/mm/1355/58&#x27;, &#x27;http://www.mmjpg.com/mm/1355/59&#x27;, &#x27;http://www.mmjpg.com/mm/1355/60&#x27;];const fetAllData = async () =&gt; &#123; const bufferList = await Promise.all(imgUrls.map(url=&gt;fetch(url).then(data=&gt;data.blob()))); // save imgBuffer to file... console.log(bufferList.lenght);&#125;fetAllData();","tags":[{"name":"javascript","slug":"javascript","permalink":"http://blog.jajabjbj.top/tags/javascript/"}]},{"title":"ç”¨ jest + gitlab-ci æ­å»ºå‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒ","date":"2018-05-09T00:00:00.000Z","path":"2018/05/09/2018-05-21/","text":"ç”¨ jest + gitlab-ci æ­å»ºå‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒå‰è¨€ä¸‹é¢ä»¥ githubåˆ›å»ºä»“åº“ä¸ºä¾‹ æµ‹è¯•é¢†åŸŸä¸­æ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯å‰ç«¯UIæµ‹è¯•gitlabåœ°å€ï¼š https://gitlab.com/yunqiangwu/devops-test.git å‰ç½®è¦æ±‚ æ‹¥æœ‰gitlabè´¦å·(å…¬å¸å†…éƒ¨çš„ä¹Ÿå¯ä»¥) gitlab å·²ç»é…ç½®äº† CI Runner(å…·ä½“æ–¹æ³•ç™¾åº¦) åŠŸèƒ½å®ç°æ•ˆæœ ä¿®æ”¹è¿‡æµ‹è¯•ç”¨ä¾‹åpushè§¦å‘è‡ªåŠ¨æµ‹è¯• æµ‹è¯•å®Œæˆåç”Ÿæˆæµ‹è¯•æŠ¥å‘Š æµ‹è¯•æŠ¥å‘Šéƒ¨ç½²åˆ° git pages ä¸Š å‘é€é‚®ä»¶é€šçŸ¥æµ‹è¯•ç»“æœï¼Œä»¥åŠæŠ¥å‘ŠæŸ¥çœ‹é“¾æ¥ å…ˆçœ‹ä¸‹æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­çš„æ•ˆæœï¼Œä¸‹é¢æ˜¯æˆ‘æ”¶åˆ°çš„è‡ªåŠ¨åŒ–æµ‹è¯•å®Œæˆåçš„é‚®ä»¶ï¼š é¢„è§ˆåœ°å€è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Šæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š åˆ›å»ºé¡¹ç›®123456789mkdir devops-testcd devops-testnpm init # åˆå§‹åŒ– `node` é¡¹ç›® # è¿™é‡Œä¼šè¦ä½ è¾“å…¥ä¿¡æ¯ï¼ŒèŠ‚çº¦æ—¶é—´ï¼Œä¸€è·¯å›è½¦# ä¸‹é¢çš„æ“ä½œæˆ‘ç”¨çš„æ˜¯cnpm cnpm i jest jest-report nightmare --savecnpm i babel-jest babel-plugin-import babel-plugin-transform-class-properties babel-plugin-transform-decorators-legacy babel-plugin-transform-runtime babel-preset-env --save-dev# é‡ç‚¹ä¾èµ–åº“ä»‹ç»ï¼š jest æµ‹è¯•æ¡†æ¶ nightmare æµè§ˆå™¨è¿è¡Œåº“ jest-report æµ‹è¯•æŠ¥å‘Šç”Ÿäº§åº“ é…ç½®jestç¯å¢ƒ åœ¨ package.json çš„ scripts ä¸­å«å¦‚ test å‘½ä»¤ 12345678910111213&#123; &quot;name&quot;: &quot;devops-test&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;description&quot;: &quot;&quot;, &quot;main&quot;: &quot;index.js&quot;, &quot;scripts&quot;: &#123; &quot;test&quot;: &quot;jest e2e.js&quot; &#125;, &quot;author&quot;: &quot;&quot;, // ... &#125; åˆ›å»ºjasmineé…ç½®æ–‡ä»¶ é¡¹ç›®æ ¹ç›®å½•/tests/jasmine.js é…ç½®æµ‹è¯•è¶…æ—¶æ—¶é—´ 1jasmine.DEFAULT_TIMEOUT_INTERVAL = 12000; // åªæœ‰è¿™ä¸€è¡Œå†…å®¹ åœ¨package.json ä¸­æ·»åŠ ä¸¤ä¸ªå­—æ®µ babel å’Œ jest ,è¿™æ ·å°±èƒ½è·‘ es6 çš„ä»£ç  12345678910111213141516171819202122232425262728&#123; &quot;name&quot;: &quot;devops-test&quot;, &quot;version&quot;: &quot;1.0.0&quot;, // ... &quot;babel&quot;: &#123; &quot;presets&quot;: [ &quot;env&quot; ], &quot;plugins&quot;: [ &quot;transform-decorators-legacy&quot;, &quot;transform-class-properties&quot;, &quot;transform-es2015-destructuring&quot; ] &#125;, &quot;jest&quot;: &#123; &quot;testResultsProcessor&quot;: &quot;jest-report&quot;, &quot;setupTestFrameworkScriptFile&quot;: &quot;&lt;rootDir&gt;/tests/jasmine.js&quot;, &quot;testMatch&quot;: [ &quot;**/?(*.)(spec|test|e2e).js?(x)&quot; ] &#125;, // ... &#125; ç¼–å†™æµ‹è¯•ç”¨ä¾‹æµ‹è¯•githubç™»å½•åŠŸèƒ½&lt;rootDir&gt;/src/e2e/test-github-login.e2e.js 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import Nightmare from &#x27;nightmare&#x27;;import &#123; helperBuilder &#125; from &#x27;jest-report&#x27;;describe(&#x27;Login&#x27;, () =&gt; &#123; let page; beforeEach(() =&gt; &#123; page = Nightmare(&#123; show: true &#125;).viewport(1024, 768); page.goto(&#x27;https://github.com/login&#x27;); &#125;); // afterEach(() =&gt; &#123; // if(page)&#123; // page.halt(); // page = null; // &#125; // &#125;); it(&#x27;should login with failure&#x27;, async() =&gt; &#123; const reportHelper = helperBuilder(&#x27;Login&#x27;, &#x27;should login with failure&#x27;); reportHelper.monitorPage(page); await page .type(&#x27;#login_field&#x27;, &#x27;mockuser&#x27;) .type(&#x27;#password&#x27;, &#x27;wrong_password&#x27;) .click(&#x27;input[type=&quot;submit&quot;]&#x27;) .wait(&#x27;#js-flash-container &gt; div &gt; div&#x27;); // should display error await page.screenshot(reportHelper.genPicturePath()); const text = await page.wait(&#x27;#js-flash-container &gt; div &gt; div&#x27;) .evaluate(() =&gt; document.body.innerText) .end(); await page.end(); expect(text).toContain(&#x27;Incorrect username or password&#x27;); &#125;); it(&#x27;should login successfully&#x27;, async() =&gt; &#123; const reportHelper = helperBuilder(&#x27;Login&#x27;, &#x27;should login successfully&#x27;); reportHelper.monitorPage(page); await page .type(&#x27;#login_field&#x27;, &#x27;æ­£ç¡®ç”¨æˆ·å&#x27;) .type(&#x27;#password&#x27;, &#x27;æ­£ç¡®å¯†ç &#x27;) .click(&#x27;input[type=&quot;submit&quot;]&#x27;) .wait(&#x27;#your_repos &gt; div &gt; div.boxed-group-action &gt; a&#x27;); // should display error await page.screenshot(reportHelper.genPicturePath()); const title = await page .evaluate(() =&gt; document.title) .end(); await page.end(); expect(title).toBe(&#x27;GitHub&#x27;); &#125;);&#125;); è¿è¡Œæµ‹è¯•ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š1. æ‰§è¡Œå‘½ä»¤npm testï¼Œè¿è¡Œæµ‹è¯•è„šæ­¥ 2. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„é»˜è®¤æ˜¯ `&lt;rootDir&gt;/dist/test-report` 3. æµ‹è¯•æŠ¥å‘Šæ•ˆæœ æ·»åŠ é¡¹ç›®åˆ°gitlab123456git initgit remote add origin https://gitlab.com/yunqiangwu/devops-test.gitgit add .git commit -m &quot;Initial commit&quot;git push -u origin master æ·»åŠ åˆ°æŒç»­é›†æˆè‡ªåŠ¨éƒ¨ç½²æµ‹è¯•æŠ¥å‘Š åˆ°gitlab pages ç½‘é¡µ 1cnpm i --save-dev gh-pages åœ¨ package.json æ·»åŠ  scripts 1234&quot;scripts&quot;: &#123; &quot;test&quot;: &quot;jest e2e.js&quot;, &quot;site&quot;: &quot;gh-pages -d dist&quot;&#125;, é…ç½®é‚®ä»¶é€šçŸ¥å·¥å…· &lt;rootDir&gt;/tool/emailnotice.sh 12345678910111213141516171819202122232425262728293031323334353637383940414243#!/bin/bashMAIL_FROM=&#x27;supportman@yeah.net&#x27;# [[ $MAIL_TO == &quot;&quot; ]] &amp;&amp; export MAIL_TO=$1MAIL_TO_ARR_ARG=$1MAIL_SUBJECT=$2shift 2MAIL_CONTENT=$*MAIL_CONTENT_FILE=&quot;/tmp/`/bin/date +%s`.txt&quot;MAIL_SMTP=&#x27;smtp://smtp.yeah.net&#x27;MAIL_USER=&#x27;supportman@yeah.net&#x27;MAIL_PASSWORD=&#x27;wu950429&#x27;OLD_IFS=&quot;$IFS&quot;#è®¾ç½®åˆ†éš”ç¬¦IFS=&quot;,&quot;MAIL_TO_ARR=($MAIL_TO_ARR_ARG)IFS=&quot;$OLD_IFS&quot;split_1()&#123; MAIL_TO=$1 echo &quot;å‘é€é‚®ä»¶åˆ°ï¼š&quot;$1 # return 0; # create mail content file echo &quot;From:$&#123;MAIL_FROM&#125;To:$MAIL_TOSubject: $MAIL_SUBJECT$MAIL_CONTENT&quot;&gt; $&#123;MAIL_CONTENT_FILE&#125; # send mail curl -s --url &quot;$&#123;MAIL_SMTP&#125;&quot; --mail-from &quot;$&#123;MAIL_FROM&#125;&quot; --mail-rcpt $&#123;MAIL_TO&#125; --upload-file $&#123;MAIL_CONTENT_FILE&#125; --user &quot;$&#123;MAIL_USER&#125;:$&#123;MAIL_PASSWORD&#125;&quot;&#125;for s in $&#123;MAIL_TO_ARR[@]&#125;dosplit_1 &quot;$s&quot;donerm -rf $&#123;MAIL_CONTENT_FILE&#125; gitlab-ci.yml é…ç½®æ–‡ä»¶ .gitlab-ci.yml 1234567891011121314151617181920212223242526272829303132333435363738394041424344image: jonneywu/node-xvfb-cnpmcache: key: &quot;$CI_REPOSITORY_URL&quot; paths: - node_modules - diststages: - test - emailtest: script: - if [ ! -d node_modules ]; then cnpm i; fi - if [ ! -d node_modules/nightmare ]; then cnpm i nightmare; fi - export DISPLAY=&#x27;:99.0&#x27; - Xvfb :99 -screen 0 1024x768x24 &gt; /dev/null 2&gt;&amp;1 &amp; - npm run test &amp;&amp; echo test FAIL - kill -9 `ps -ef | grep Xvfb| grep -v grep|awk &#x27;&#123;print $2&#125;&#x27;` - npm run site stage: test only: - master artifacts: paths: - distemail: script: - echo email - if [[ ! -n $MAIL_TO ]]; then export MAIL_TO=842269153@qq.com,yunqiang.wu@hand-china.com ; fi - export root_url=http://`cat CNAME` - export test_passed_rate=$(printf &quot;%.2f&quot; `cat dist/test-report/testResultData.json | jq &#x27;100*.numPassedTests/.numTotalTests&#x27;`)% - bash ./tool/emailnotice.sh $MAIL_TO &#x27;å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•&#x27; `echo -e &quot; æµ‹è¯•åˆ†æ”¯ï¼š $&#123;CI_COMMIT_REF_NAME&#125; \\r\\n æäº¤äººï¼š$&#123;GITLAB_USER_NAME&#125; \\r\\n æµ‹è¯•é€šè¿‡ç‡ï¼š$&#123;test_passed_rate&#125; \\r\\n è§¦å‘æ¥æºï¼š$&#123;CI_PIPELINE_SOURCE&#125; \\r\\n æµ‹è¯•ç¯å¢ƒï¼šmockApiç¯å¢ƒ \\r\\n\\r\\né¢„è§ˆåœ°å€ï¼š $&#123;root_url&#125;/index.html \\r\\n è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Šï¼š$&#123;root_url&#125;/test-report/reporter.html \\r\\n æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼š $&#123;root_url&#125;/coverage/lcov-report/index.html \\r\\n&quot;` stage: email only: - master artifacts: paths: - dist æ³¨æ„äº‹é¡¹ react å¼€å‘æ˜¯å¦‚æœç”¨äº†css modulesçš„æŠ€æœ¯å¼€å‘æ—¶ï¼Œä¼šæŠŠ class åæ¢æ‰ ï¼Œæµ‹è¯•æ¡†æ¶å°±æ— æ³•é€šè¿‡ css selector æ‰¾åˆ°å¹¶æ“ä½œ Domå…ƒç´ ï¼Œåœ¨å¼€å‘æ—¶ï¼Œå¯ä»¥ä¸ºä¸»è¦æ§åˆ¶çš„domèŠ‚ç‚¹ç»™idï¼Œdata-custom è‡ªå®šä¹‰å±æ€§ï¼Œæ¯”å¦‚ç”¨æˆ·åè¾“å…¥æ¡†ã€ç™»å½•æŒ‰é’®ï¼Œ æˆ‘è¿™é‡Œçš„ä»‹ç»çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œåªæ˜¯æµ‹è¯•ç³»ç»Ÿçš„åŠŸèƒ½äº¤äº’æ˜¯å¦èƒ½æ­£å¸¸ï¼Œå¦‚æœéœ€è¦é è‡ªåŠ¨åŒ–æµ‹è¯•æ¥åˆ¤æ–­UIç•Œé¢çš„æ ·å¼å¯¹æ¯”æ˜¯ç¬¦åˆè¦æ±‚ï¼Œå¯èƒ½è¿˜æ˜¯è¦é äººåŠ›æµ‹è¯•ï¼Œä¸è¿‡æµ‹è¯•çš„ç›®çš„ä¿è¯ç³»ç»ŸåŠŸèƒ½æˆæ­£å¸¸ä½¿ç”¨ä¸å‡ºBUGã€‚ å‚è€ƒ å¦‚ä½•è¿›è¡Œå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ - çŸ¥ä¹ ANT DESIGN PRO ä¸­çš„ UI æµ‹è¯•","tags":[{"name":"gitab-ci","slug":"gitab-ci","permalink":"http://blog.jajabjbj.top/tags/gitab-ci/"}]},{"title":"webpackå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–¹æ¡ˆæ€»ç»“","date":"2018-05-08T00:00:00.000Z","path":"2018/05/08/2018-05-21-1/","text":"webpackå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–¹æ¡ˆæ€»ç»“ åœ¨ä½¿ç”¨webpackæ‰“åŒ…é¡¹ç›®æ—¶ï¼Œæœ€å¥½å°½é‡ä½¿ç”¨importçš„æ–¹å¼å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œä½†æœ‰äº›æƒ…å†µåˆå¿…é¡»ä½¿ç”¨å…¶ä»–æ–¹å¼å¼•å…¥ç¬¬ä¸‰æ–¹åº“â€¦ è¦é¡¹ç›®ä¸Šå¿…é¡»è¦ç”¨ä¸€ä¸ª jQuery æ’ä»¶å½¢å¼çš„åº“è€Œå¼•å…¥è¿™ä¸ªåº“ä¹‹å‰å¿…é¡»è¦å¼•å…¥jQueryï¼Œå› ä¸ºæ’ä»¶é‡Œé¢å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„ä»£ç  123456789(function() &#123;var jQuery = window.jQuery,\\\\ ...\\\\ ...if (!jQuery) throw &#x27;MathQuill requires jQuery 1.4.3+ to be loaded first&#x27;;\\\\ ...\\\\ ...\\\\ ...&#125;)(); æ‰€ä»¥éœ€è¦åœ¨webpackæ„å»ºçš„é¡¹ç›®ä¸­å¼•å…¥ ç¬¬ä¸‰æ–¹ jsåº“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¼•å…¥ç¬¬ä¸‰æ–¹åº“æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ ç›´æ¥å¼•å…¥ç›´æ¥å¼•å…¥çš„å…³é”®åœ¨äºè¾“å‡ºçš„é…ç½®ï¼Œè¿™é‡Œä»¥varä¸ºä¾‹ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718 output : &#123; filename : &#x27;[name].js&#x27;, // devServerä¸å¯é…ç½®ä¸ºç»å¯¹è·¯å¾„ //publicPath: &quot;http://localhost:8080/dist/&quot;, publicPath: &quot;/dist/&quot;, path : build, // umdåŒ…å«äº†å¯¹amdã€commonjsã€varç­‰å¤šç§è§„èŒƒçš„æ”¯æŒ // å…³é”®åœ¨äºè¿™é‡Œ libraryTarget : &#x27;var&#x27; &#125;, // å…¶ä»–é…ç½®ç•¥ resolve: &#123; //extensions: [&#x27;&#x27;, &#x27;.js&#x27;, &#x27;.es6&#x27;, &#x27;.vue&#x27;], alias: &#123; // ä¹Ÿå¯ä»¥ä¸å†™ jquery: &#x27;jquery/dist/jquery.min.js&#x27;, &#125;&#125; è¿™æ ·ï¼Œåœ¨ç¼–è¯‘ä»£ç æ—¶ï¼Œwebpackä¼šè‡ªåŠ¨å°†jQueryæ‰“è¿›ä»£ç ï¼Œç°åœ¨å°±å¯ä»¥å¼•å…¥ä»£ç äº† 12345// å¯ä»¥ç›´æ¥å¼•å…¥jqueryimport $ from &#x27;jquery&#x27;// å› ä¸ºæ˜¯commonjsè§„èŒƒï¼Œæ‰€ä»¥ä¼šæŒ‰é¡ºåºåŠ è½½ï¼Œå¼•ç”¨æˆåŠŸï¼Œå¦‚æœæ˜¯outputä¸ºamdï¼Œåˆ™å¿…é¡»åœ¨requirejsä¸­é…ç½®shimï¼Œå¦åˆ™å¤±è´¥import &#x27;jquery-ui&#x27; 2. ProvidePlugin[éš¾ä»¥å¼•å…¥æ’ä»¶]åœ¨webpackä¸­æ·»åŠ æ’ä»¶ProvidePlugin 1234567plugins: [ new webpack.ProvidePlugin(&#123; $: &quot;jquery&quot;, jQuery: &quot;jquery&quot; &#125;), ]// $å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ åˆ°å½“å‰æ¨¡å—çš„ä¸Šä¸‹æ–‡ï¼Œæ— éœ€æ˜¾ç¤ºå£°æ˜ é—®é¢˜æ˜¯ä¾æ—§æ²¡æœ‰å…¨å±€çš„$å‡½æ•°ï¼Œæ‰€ä»¥å¯¼å…¥æ’ä»¶ä¾æ—§ä¼šå¤±è´¥ï¼Œå¹¶ä¸”å¦‚æœæœ‰eslintè¿™æ ·çš„preLoadsï¼Œè°ƒç”¨è¯­å¥ä¹Ÿéš¾ä»¥é€šè¿‡è¯­æ³•æ ¡éªŒ(å› ä¸ºæ²¡æœ‰å£°æ˜$å°±ç›´æ¥ä½¿ç”¨)ï¼Œä»…è¿™ä¸€ç‚¹ï¼Œå¯¹äºæˆ‘è¿™æ ·çš„ä»£ç å¤„å¥³åº§å°±éš¾ä»¥æ¥å—ã€‚ 3. expose-loader[æ¨èä½¿ç”¨]ä¸éœ€è¦ä»»ä½•å…¶ä»–çš„æ’ä»¶é…åˆï¼Œåªè¦å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°æ‰€æœ‰çš„loaderä¹‹å‰ 1234&#123; test: require.resolve(&#x27;jquery&#x27;), loader: &#x27;expose?jQuery!expose?$&#x27;&#125; å¼•ç”¨æ—¶æ”¹ä¸ºå¦‚ä¸‹æ–¹å¼ 12import $ from &#x27;expose?$!jquery&#x27;import &#x27;jquery-ui&#x27; //æ’ä»¶å¯ç”¨ imports-loaderã€script-loaderåŒæ ·å¯è¾¾åˆ°æ­¤æ•ˆæœï¼Œé…ç½®ä¸åŠŸèƒ½éƒ½éå¸¸ç›¸ä¼¼ï¼Œåœ¨æ­¤ä¸ä¸€ä¸€è¯´æ˜ã€‚ 4. åŒ…è£…jquery[æ¨èä½¿ç”¨]æ­¤æ–¹æ³•åªä¾èµ–äºè‡ªå·±ï¼Œå®Œå…¨ä¸éœ€è¦ä»»ä½•å…¶ä»–æ’ä»¶ä¸åŠ è½½å™¨ï¼Œåˆ›å»ºjqueryçš„åŒ…è£…å¯¹è±¡jquery-vendor.js 1234import $ from &#x27;jquery&#x27;window.$ = $window.jQuery = $export default $ ä»¥åå¼•ç”¨jqueryæ—¶æŒ‡å‘jquery-vendor.js 123import $ from &#x27;../assets/jquery-vendor.js&#x27;import &#x27;jquery-ui&#x27;// æ­¤æ—¶UIçš„æ–¹æ³•å…¨éƒ¨å¯ç”¨ï¼Œå¦‚æœéœ€è¦å¼•ç”¨bootstrapï¼Œå¯å‚ç…§æ­¤æ–¹æ³• ä¸ºäº†è°ƒç”¨æ–¹ä¾¿ï¼Œå¯åœ¨webpacké…ç½®æ–‡ä»¶ä¸­åˆ›å»ºjquery-vendor.jsçš„åˆ«å 123alias: &#123; jquery : &#x27;src/assets/jquery-vendor.js&#x27; // å°†å…¶æŒ‡å‘jquery-vendor.jsæ‰€åœ¨ä½ç½®&#125; 2. ç¬¬ä¸‰æ–¹åº“éœ€è¦é€šè¿‡ ç±»ä¼¼requirejsæœºåˆ¶ å¼‚æ­¥åŠ è½½å…¶ä»–ä¾èµ–åº“1234567891011121314151617181920212223242526272829// è¿™æ˜¯ MathJax æ•°å­¦è¡¨è¾¾å¼è§£æåº“ åŠ è½½æ‰©å±•çš„ä¸€æ®µä»£ç // è¯¥åº“éœ€è¦åŠ è½½ extensions è€Œä¸”æ˜¯é€šè¿‡åœ¨é¡µé¢æ’å…¥scriptçš„æ–¹å¼åŠ è½½çš„loader: &#123; JS: function (k, m) &#123; var j = this.fileName(k); var i = document.createElement(&quot;script&quot;); var l = a.Callback([&quot;loadTimeout&quot;, this, k]); this.loading[k] = &#123; callback: m, timeout: setTimeout(l, this.timeout), status: this.STATUS.OK, script: i &#125;; this.loading[k].message = a.Message.File(j); i.onerror = l; i.type = &quot;text/javascript&quot;; i.src = k + this.fileRev(j); this.head.appendChild(i) &#125;, CSS: function (j, l) &#123; var i = this.fileName(j); var k = document.createElement(&quot;link&quot;); k.rel = &quot;stylesheet&quot;; k.type = &quot;text/css&quot;; k.href = j + this.fileRev(i); this.loading[j] = &#123;callback: l, message: a.Message.File(i), status: this.STATUS.OK&#125;; this.head.appendChild(k); this.timer.create.call(this, [this.timer.file, j], k) &#125;&#125;, é‡åˆ°è¿™ç§æƒ…å†µï¼Œå°±ä¸èƒ½ç”¨å¸¸è§„çš„æ–¹æ³•å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä»¥ä¸Šçš„æ–¹æ³•éƒ½ä¸é€‚ç”¨ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æœŸé—´ä¸ä¼šå†æŠ¥é”™ ä½†æ˜¯åœ¨è¿è¡ŒæœŸé—´ä¼šæŠ¥ä¸€ä¸ªjsæ–‡ä»¶åŠ è½½404çš„é”™è¯¯ã€‚å› ä¸ºè¿™æ˜¯åœ¨è¿è¡Œä¹‹åé€šè¿‡æ³¨å…¥scriptæ ‡ç­¾ åŠ è½½æ’ä»¶ ã€‚è€Œåœ¨ç¼–è¯‘æ—¶webpackä¸ä¼šæ£€æµ‹åˆ°è¿™ç§å¼‚æ­¥åŠ è½½é€»è¾‘ å¹¶å¯¼å…¥ã€‚ æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼š è¦ä½¿èƒ½å¤Ÿé€šè¿‡å¼‚æ­¥åŠ è½½ ï¼Œå¿…é¡»ä¿è¯ æ˜ å…¥çš„åº“ å’Œä»–çš„ä¾èµ–æ–‡ä»¶ ç›¸å¯¹æ–‡ç« ä¸å˜ ï¼Œæ•´ä½“æ”¾åˆ° ç¼–è¯‘åçš„ç›®å½•ã€‚ä»¥å¼•å…¥ MathJax æ•°å­¦è¡¨è¾¾å¼è§£æåº“ä¸ºä¾‹ ç”±äºMathJax çš„åŠ è½½æ‰©å±•ï¼ˆMathMenuï¼‰æ˜¯ç”¨åˆ° ç±»ä¼¼ requirejsçš„å¼‚æ­¥åŠ è½½æœºåˆ¶ ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥mathquill åªèƒ½é€šè¿‡ script æ ‡ç­¾å¼•å…¥ï¼Œä¸èƒ½é€šè¿‡ import å¼•å…¥ mathquill ä¿®æ”¹æ–‡ä»¶å¦‚ä¸‹ï¼š 1. webpack.config.js:12// åœ¨ç¼–è¯‘æ‰“åŒ…æ—¶ æŠŠ /src/lib/ä¸‹çš„ jsæ–‡ä»¶å¤åˆ¶åˆ° www(ç¼–è¯‘è¾“å‡ºç›®å½•)/lib ç›®å½•new CopyWebpackPlugin([ &#123;from: &#x27;./src/lib&#x27;, to: &#x27;lib&#x27;&#125;]), 2. index.html:123456&lt;script src=&quot;./lib/polyvplayer/polyvplayer.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;./lib/jquery/dist/jquery.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;./lib/cat_mathjax/dist/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;&gt;&lt;/script&gt;&lt;script src=&quot;./lib/cat_mathquill_build/mathquill.js&quot;&gt;&lt;/script&gt;&lt;link rel=&quot;stylesheet&quot; href=&quot;./lib/cat_mathquill_build/mathquill.css&quot;&gt; 3. æ·»åŠ æ–‡ä»¶å¤¹ï¼š&#x2F;src&#x2F;lib12/src/lib/jquery/ /src/lib/mathjax/","tags":[{"name":"webpack","slug":"webpack","permalink":"http://blog.jajabjbj.top/tags/webpack/"}]}]