<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Wayne</title>
  
  <subtitle>æœ‰ç†æƒ³çš„ç å†œ</subtitle>
  <link href="http://blog.jajabjbj.top/atom.xml" rel="self"/>
  
  <link href="http://blog.jajabjbj.top/"/>
  <updated>2022-07-15T16:13:40.425Z</updated>
  <id>http://blog.jajabjbj.top/</id>
  
  <author>
    <name>Wayne</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä»€ä¹ˆæ˜¯ wasm(webassembly) æŠ€æœ¯</title>
    <link href="http://blog.jajabjbj.top/2022/07/10/wasm/"/>
    <id>http://blog.jajabjbj.top/2022/07/10/wasm/</id>
    <published>2022-07-10T12:08:58.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»€ä¹ˆæ˜¯-wasm-wasi-wapm-æŠ€æœ¯"><a href="#ä»€ä¹ˆæ˜¯-wasm-wasi-wapm-æŠ€æœ¯" class="headerlink" title="ä»€ä¹ˆæ˜¯ wasm wasi wapm æŠ€æœ¯"></a>ä»€ä¹ˆæ˜¯ wasm wasi wapm æŠ€æœ¯</h1><h2 id="ä»€ä¹ˆæ˜¯-wasm"><a href="#ä»€ä¹ˆæ˜¯-wasm" class="headerlink" title="ä»€ä¹ˆæ˜¯ wasm"></a>ä»€ä¹ˆæ˜¯ wasm</h2><blockquote><p>wasmå®˜ç½‘: <a href="https://webassembly.org/">https://webassembly.org/</a></p></blockquote><p>wasm å…¨ç§° WebAssemblyï¼Œæ˜¯ä¸€ç§é€šç”¨å­—èŠ‚ç çš„æŠ€æœ¯ï¼Œé€šè¿‡è¯¥æŠ€æœ¯å°†å…¶ä»–è¯­è¨€ï¼ˆæ¯”å¦‚ go, rust, c&#x2F;c++, ç­‰ï¼‰çš„ç¨‹åºä»£ç ç¼–è¯‘æˆå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œçš„å­—èŠ‚ç ç¨‹åºã€‚<br>å› ä¸ºè¯¥ WebAssembly æ˜¯ä¸€ç§å­—é€šç”¨çš„èŠ‚ç æŠ€æœ¯è§„èŒƒï¼Œæ‰€ä»¥ WebAssembly ä¸ä»…ä»…å¯ä»¥åœ¨æµè§ˆå™¨æ‰§è¡Œï¼Œè¿˜å¯ä»¥åœ¨å…¶ä»–å˜æˆè¯­è¨€ç¯å¢ƒä¸­æ‰§è¡Œï¼Œæ¯”å¦‚ ï¼Œpythonï¼Œ cï¼Œgoï¼Œ rustï¼Œç­‰.</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦æä¸€ä¸ª-wasm-å­—èŠ‚ç ï¼Œä¸èƒ½æ‰€ä»¥å¹³å°éƒ½ç”¨-js-åšä¸º-é€šç”¨ç¼–ç æŠ€æœ¯å—ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦æä¸€ä¸ª-wasm-å­—èŠ‚ç ï¼Œä¸èƒ½æ‰€ä»¥å¹³å°éƒ½ç”¨-js-åšä¸º-é€šç”¨ç¼–ç æŠ€æœ¯å—ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦æä¸€ä¸ª  wasm å­—èŠ‚ç ï¼Œä¸èƒ½æ‰€ä»¥å¹³å°éƒ½ç”¨ js åšä¸º é€šç”¨ç¼–ç æŠ€æœ¯å—ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦æä¸€ä¸ª  wasm å­—èŠ‚ç ï¼Œä¸èƒ½æ‰€ä»¥å¹³å°éƒ½ç”¨ js åšä¸º é€šç”¨ç¼–ç æŠ€æœ¯å—ï¼Ÿ</h3><p>ç†è®ºä¸Š åœ¨å…¶ä»–è¯­è¨€ç¯å¢ƒä¸­å®ç° js æ‰§è¡Œå¼•æ“ï¼Œ æ˜¯å¯ä»¥æŠŠ js åšä¸ºä¸€ä¸ª é€šç”¨ç¼–ç æŠ€æœ¯çš„ã€‚<br>é‚£ä¸ºä»€ä¹ˆè¿˜éœ€åšä¸€ä¸ª wasm å‡ºæ¥å‘¢ã€‚ æˆ‘è®¤ä¸ºæœ‰ä»¥ä¸‹å‡ ç‚¹åŸå› ï¼š</p><ul><li>js ä»£ç æ˜¯æ–‡æœ¬æ–‡ä»¶æ ¼å¼ã€‚åœ¨ web ç¯å¢ƒä¸‹ï¼Œç½‘ç»œä¼ è¾“æ•ˆç‡è¿œè¿œä¸å¦‚ wasm äºŒè¿›åˆ¶æ•°æ®ä¼ è¾“ã€‚</li><li>js ç›¸å¯¹äº c  å’Œ rust ï¼Œè€Œå·²ï¼Œæ˜¯ä¸€ç§å¼±ç±»å‹è¯­è¨€ï¼Œå†™ä»£ç æ²¡æœ‰ä¸¥æ ¼ç±»å‹æ ¡éªŒï¼Œå®¹æ˜“å†™æˆä¸ç¨³å®šçš„ä»£ç ã€‚</li><li>js æ˜¯æœ‰ GC(è‡ªåŠ¨åƒåœ¾æ¸…ç†åŠŸèƒ½)ï¼Œç”¨æˆ·ä¸ç”¨å…³æ³¨å†…å­˜çš„å¤„ç†ï¼Œå¯¼è‡´çš„ç»“æœå°±æ˜¯ GC å¤„ç†è¿‡ç¨‹ä¸¥é‡æ‹–æ…¢æ€§èƒ½ï¼Œ è€Œä¸”ç”±äºæ˜¯ç³»ç»Ÿ GCï¼Œ ç”¨æˆ·å¾ˆéš¾ç²¾ç¡®æ§åˆ¶å†…å­˜ã€‚å®¹æ˜“å¯¼è‡´å†…å­˜å ç”¨è¿‡é«˜ã€‚</li><li>js æ˜¯æ–‡æœ¬è§£æå‹ç¼–ç¨‹è¯­è¨€ï¼Œæ–‡æœ¬è§£ææ•ˆç‡ä½ï¼Œwasm äºŒè¿›åˆ¶ä»£ç è§£ææ‰§è¡Œæ•ˆç‡ä¼šé«˜äº jsã€‚</li><li>js ç”±äºå†å²åŸå› ï¼Œjs æœ¬èº«å°±å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼ˆjs ä¹‹çˆ¶è¯´çš„ï¼‰ï¼Œè€Œä¸” js å¼•æ“éœ€è¦å®ç°çš„æˆæœ¬è¿‡é«˜ï¼Œ wasm çš„æ‰§è¡Œå¼•æ“å¯ä»¥è¯´æ˜¯ æ¯” js æ–°çš„äº§ç‰©ï¼Œ åœ¨è®¾è®¡ wasm å­—èŠ‚ç çš„æ—¶å€™ï¼Œè€ƒè™‘å„ä¸ªæ–¹ä¾¿æ¯”è¾ƒå®Œå–„ï¼Œæ¼æ´ä¹Ÿæ¯”è¾ƒå°‘ã€‚</li></ul><h2 id="ä»€ä¹ˆæ˜¯-wasi"><a href="#ä»€ä¹ˆæ˜¯-wasi" class="headerlink" title="ä»€ä¹ˆæ˜¯ wasi"></a>ä»€ä¹ˆæ˜¯ wasi</h2><blockquote><p>wasiå®˜ç½‘: <a href="https://wasi.dev/">https://wasi.dev/</a></p></blockquote><p>wasi å…¨ç§° The WebAssembly System Interface  é€šä¿—æ¥è®²å°±æ˜¯ä¸€ä¸ªå¯¹æ¥è§„èŒƒã€‚  </p><p>å°±åƒå‰åç«¯åˆ†ç¦»çš„ RestFul ç±»ä¼¼ï¼Œåªè¦å‰åç«¯çº¦å®šä¸€å¥— RESTful æ¥å£å¯¹æ¥è§„èŒƒ ï¼Œæ— è®ºå‰ç«¯ä½¿ç”¨çš„æ¡†æ¶æ˜¯ jQuery æˆ– vue æˆ– react ï¼Œ æ— è®ºåç«¯ä½¿ç”¨ java node.js æˆ–è€… java è¿˜æ˜¯ goã€‚ éƒ½å¯ä»¥è¿›è¡Œå‰åç«¯é€šä¿¡ã€‚</p><p>wasi ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œ wasi çº¦å®šäº†ä¹Ÿè¡Œå‡½æ•°æ¥å£ï¼Œä¸åŒçš„è¯­è¨€ä»£ç çš„ç”Ÿæˆçš„å­—èŠ‚ç è§„åˆ™æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å…¶ä»–å¹³å°æ‰§è¡Œè¿™ä¸ªå­—èŠ‚ç ã€‚</p><p>ä¸¾ä¸ªæ —å­ï¼š  </p><p>æ¯”å¦‚æˆ‘ç”¨ cè¯­è¨€ å†™äº†ä¸€ä¸ªç¨‹åºï¼Œè¯»å–æŸä¸ªæ–‡ä»¶ï¼Œ æŠŠæ–‡ä»¶å†…å®¹è¾“å‡ºåˆ°å±å¹•ã€‚</p><p>ç„¶åæˆ‘æŠŠè¿™ä¸ªç¨‹åºç¼–è¯‘æˆ wasm å­—èŠ‚ç ã€‚ ç„¶åè®© web æµè§ˆå™¨å»æ‰§è¡Œã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ æµè§ˆå™¨æ˜¯ä¸å¯ä»¥ç›´æ¥è¯»å–ç³»ç»Ÿæ–‡ä»¶çš„ã€‚é‚£ä¹ˆ web æµè§ˆå™¨åº”è¯¥å¦‚ä½•å»æ‰§è¡Œè¿™ä¸ªå­—èŠ‚ç ç¨‹åºå‘¢ï¼Ÿ</p><p>é€šè¿‡ wasi (åæ–‡ä¼šä»‹ç») åè®®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ æµè§ˆå™¨ç¯å¢ƒä¸­ç”¨ JavaScript å†™ è¯»å–æ–‡ä»¶çš„ API å›è°ƒå‡½æ•°ï¼Œç„¶ååœ¨æ‰§è¡Œå­—èŠ‚ç ç¨‹åºä¹‹å‰ï¼ŒæŠŠè¿™ä¸ª options ä¼ ç»™ wasm æ‰§è¡Œå¼•æ“ã€‚ js ä¸­å¯ä»¥å®ç° æ–‡ä»¶è¯»å–é€»è¾‘ï¼ˆå¯èƒ½æ˜¯ä»ç½‘ç»œä¸­è¯»å–ï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€æ®µå­—ç¬¦ä¸²ï¼‰ã€‚   </p><p>ç„¶å web æµè§ˆå™¨ å°±å¯ä»¥æ— éšœç¢çš„æ‰§è¡Œè¿™æ®µ å­—èŠ‚ç ç¨‹åºäº†ã€‚</p><p><img src="/images/wasm/2022-07-16-00-03-17.png"></p><p>wasmçš„å¥½å¤„:</p><ul><li>å¯ä»¥ç§»æ¤å…¶ä»–å¹³å°çš„ä»£ç ç»™ä¸åŒå¹³å°æ‰§è¡Œï¼ˆè·¨å¹³å°è·¨è¯­è¨€æ‰§è¡Œèƒ½åŠ›ï¼‰</li><li>å¯ä»¥ç”¨åˆ°å…¶ä»–è¯­è¨€çš„ç‰¹æ€§ï¼Œç»™æµè§ˆå™¨æ‰§è¡Œç¯å¢ƒèµ‹èƒ½ï¼Œæ¯”å¦‚é€šè¿‡ rust ç”Ÿæˆçš„ wasmï¼Œæœ‰æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡å’Œå†…å­˜å®‰å…¨ç‰¹æ€§ã€‚</li><li>é€šè¿‡ wasi å¯ä»¥åœ¨æµè§ˆå™¨ç«¯å®ç°æ¨¡æ‹Ÿ æ–‡ä»¶ç³»ç»Ÿï¼Œ sock ç½‘ç»œæœåŠ¡ç­‰ï¼Œ å®ç°ç±»ä¼¼ webide</li></ul><h2 id="å¦‚ä½•ç”Ÿæˆ-wasm-å­—èŠ‚ç ç¨‹åº"><a href="#å¦‚ä½•ç”Ÿæˆ-wasm-å­—èŠ‚ç ç¨‹åº" class="headerlink" title="å¦‚ä½•ç”Ÿæˆ wasm å­—èŠ‚ç ç¨‹åº"></a>å¦‚ä½•ç”Ÿæˆ wasm å­—èŠ‚ç ç¨‹åº</h2><p>å› ä¸º wasm æ˜¯ä¸€ç§é€šç”¨çš„å­—èŠ‚ç äº¤äº’æŠ€æœ¯ï¼Œå¤§éƒ¨åˆ†æµè¡Œçš„è¯­è¨€çš„ç¯å¢ƒçš„ sdk å·¥å…·åŒ…ä¸­å°±å†…ç½®äº† wasm ç›¸å…³çš„å·¥å…·ã€‚ æ¯”å¦‚ go è¯­è¨€ä¸­å¯ä»¥é€š <code>GOOS=js GOARCH=wasm go build -o static/main.wasm</code>  ç”Ÿæˆ wasm å­—èŠ‚ç ç¨‹åºã€‚</p><p>å¦å¤–è¿˜æœ‰å…¶ä»–ç¬¬ä¸‰æ–¹æˆ–è€… wasmå®˜æ–¹çš„å·¥å…·ã€‚ç›®å‰æ¯”è¾ƒé€šç”¨çš„ä¸€ä¸ªå·¥å…·æ˜¯ï¼šwasmtime</p><blockquote><p>wasmtimeå®˜ç½‘æ–‡æ¡£: <a href="https://docs.wasmtime.dev/">https://docs.wasmtime.dev/</a></p></blockquote><p>è¿™é‡Œç®€å•ä¸¾ä¸ªæ —å­ ç”¨ Rust ç”Ÿæˆå­—èŠ‚ç ã€‚</p><p>ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦å®‰è£… Rust è¯­è¨€ç¯å¢ƒï¼š</p><p><a href="https://www.rust-lang.org/zh-CN/tools/install">å®‰è£… rust æ–‡æ¡£</a></p><p>ç¬¬äºŒæ­¥ å®‰è£… rust çš„ wasm å·¥å…·</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cargo install cargo-wasi</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ åˆ›å»º rust hello é¡¹ç›®</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cargo new hello-world</span><br><span class="line">$ <span class="built_in">cd</span> hello-world</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ src&#x2F;main.rs æ·»åŠ å¯¼å‡ºå‡½æ•°</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;Hello, world! wasm!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒè¯•è¿è¡Œ rust wasi å­—èŠ‚ç ç¨‹åº</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cargo wasi run</span><br><span class="line">info: downloading component <span class="string">&#x27;rust-std&#x27;</span> <span class="keyword">for</span> <span class="string">&#x27;wasm32-wasi&#x27;</span></span><br><span class="line">info: installing component <span class="string">&#x27;rust-std&#x27;</span> <span class="keyword">for</span> <span class="string">&#x27;wasm32-wasi&#x27;</span></span><br><span class="line">   Compiling hello-world v0.1.0 (/hello-world)</span><br><span class="line">    Finished dev [unoptimized + debuginfo] target(s) <span class="keyword">in</span> 0.16s</span><br><span class="line">     Running `/.cargo/bin/cargo-wasi target/wasm32-wasi/debug/hello-world.wasm`</span><br><span class="line">     Running `target/wasm32-wasi/debug/hello-world.wasm`</span><br><span class="line">Hello, world!</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é€šè¿‡ wasmtime å·¥å…· è¿è¡Œ wasi å­—èŠ‚ç ç¨‹åºã€‚</p><blockquote><p>éœ€è¦å®‰è£… wasmtime å·¥å…·ï¼Œ å®‰è£…æ–‡æ¡£ï¼š<a href="https://docs.wasmtime.dev/cli-install.html">https://docs.wasmtime.dev/cli-install.html</a></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wasmtime target/wasm32-wasi/debug/hello-world.wasm</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure><p>åˆ°æ­¤ä¸ºæ­¢æˆ‘ä»¬å°±å®ç°ç”Ÿæˆäº† wasm å­—èŠ‚ç ç¨‹åºäº†</p><h3 id="ä¸ºä»€ä¹ˆæˆ‘æ›´æ¨èä½¿ç”¨-rust-å­—èŠ‚ç ç¨‹åºã€‚"><a href="#ä¸ºä»€ä¹ˆæˆ‘æ›´æ¨èä½¿ç”¨-rust-å­—èŠ‚ç ç¨‹åºã€‚" class="headerlink" title="ä¸ºä»€ä¹ˆæˆ‘æ›´æ¨èä½¿ç”¨ rust å­—èŠ‚ç ç¨‹åºã€‚"></a>ä¸ºä»€ä¹ˆæˆ‘æ›´æ¨èä½¿ç”¨ rust å­—èŠ‚ç ç¨‹åºã€‚</h3><p>å› ä¸º rust æ˜¯ä¸€ç§å¼ºç±»å‹ï¼Œæ€§èƒ½æ¯”è¾ƒä¼˜ç§€çš„çš„ ç¼–ç¨‹è¯­è¨€ã€‚ å’Œ c è¯­è¨€ä¸€æ ·æ²¡æœ‰ gcï¼Œä½†æ˜¯ rust åœ¨å†…å­˜æ“ä½œæ–¹é¢ï¼Œrust ç¼–è¯‘å™¨æœ‰ä¼˜ç§€çš„ è¯­æ³•æ£€æŸ¥æœºåˆ¶ï¼Œæ‰€ä»¥å¯ä»¥è®©ç”¨æˆ·å†™å‡ºä¼˜ç§€çš„å†…å­˜å®‰å…¨ä»£ç ã€‚</p><p>è€Œä¸” rust å’Œ c è¯­è¨€ç›¸æ¯”ï¼Œ ç”±äº rust æ˜¯åè¾ˆï¼Œ æ‰€ä»¥ rust æœ‰å¾ˆå¤šæ–°çš„ç°ä»£è¯­è¨€ç‰¹æ€§ï¼Œ å¯ä»¥é€šè¿‡ç®€å•çš„ä»£ç è¯­æ³•ç³–ï¼Œå®ç° cè¯­è¨€çš„éœ€è¦å¾ˆå¤šä»£ç å®ç°çš„åŠŸèƒ½ã€‚</p><h2 id="å¦‚ä½•åœ¨-nodejs-ç¯å¢ƒæ‰§è¡Œ-wasm-ä»£ç "><a href="#å¦‚ä½•åœ¨-nodejs-ç¯å¢ƒæ‰§è¡Œ-wasm-ä»£ç " class="headerlink" title="å¦‚ä½•åœ¨ nodejs ç¯å¢ƒæ‰§è¡Œ wasm ä»£ç "></a>å¦‚ä½•åœ¨ nodejs ç¯å¢ƒæ‰§è¡Œ wasm ä»£ç </h2><p>nodejs 16 å†…ç½®äº† WebAssembly API</p><p>åœ¨ åˆšåˆšçš„ rust é¡¹ç›®ä¸‹ï¼Œ åˆ›å»º ä¸€ä¸ª test.js è„šæœ¬ï¼Œ å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰ wasm ç¯å¢ƒå˜é‡</span></span><br><span class="line">        <span class="keyword">const</span> env = &#123;</span><br><span class="line">            <span class="attr">PWD</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// wasm å†…å­˜æ“ä½œå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">let</span> thisView = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// wasm ç¨‹åºæ¥å£å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">let</span> wasmRes = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// wasm å†…å­˜å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">let</span> thisMemory = <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">// æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ç¼“å­˜å˜é‡</span></span><br><span class="line">        <span class="keyword">let</span> consoleLogData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">refreshMemory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!thisView || thisView.<span class="property">buffer</span>.<span class="property">byteLength</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                thisView = <span class="keyword">new</span> <span class="title class_">DataView</span>(thisMemory.<span class="property">buffer</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">getiovs</span> = (<span class="params">iovs, iovsLen</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="title function_">refreshMemory</span>();</span><br><span class="line">      </span><br><span class="line">            <span class="keyword">const</span> buffers = <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: iovsLen &#125;, <span class="function">(<span class="params">_, i</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">const</span> ptr = iovs + i * <span class="number">8</span>;</span><br><span class="line">              <span class="keyword">const</span> buf = thisView.<span class="title function_">getUint32</span>(ptr, <span class="literal">true</span>);</span><br><span class="line">              <span class="keyword">const</span> bufLen = thisView.<span class="title function_">getUint32</span>(ptr + <span class="number">4</span>, <span class="literal">true</span>);</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(thisMemory.<span class="property">buffer</span>, buf, bufLen);</span><br><span class="line">            &#125;);</span><br><span class="line">      </span><br><span class="line">            <span class="keyword">return</span> buffers;</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Uint8ArrayToString</span>(<span class="params">fileData</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> dataString = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; fileData.<span class="property">length</span>; i++) &#123;</span><br><span class="line">              dataString += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(fileData[i]);</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">            <span class="keyword">return</span> dataString</span><br><span class="line">          </span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> importObject = &#123;</span><br><span class="line">            <span class="attr">wasi_snapshot_preview1</span>: &#123;</span><br><span class="line">                <span class="attr">fd_write</span>: <span class="function">(<span class="params">fd, iovs, iovsLen, nwritten</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> written = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">const</span> buffers = <span class="title function_">getiovs</span>(iovs, iovsLen);</span><br><span class="line"></span><br><span class="line">                    buffers.<span class="title function_">forEach</span>(<span class="function"><span class="params">buffer</span> =&gt;</span> &#123;</span><br><span class="line">                        consoleLogData+= <span class="title class_">Uint8ArrayToString</span>(buffer);</span><br><span class="line">                        written+=buffer.<span class="property">length</span>;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    thisView.<span class="title function_">setUint32</span>(nwritten, written, <span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">environ_get</span>: <span class="function">(<span class="params">environ, environBuf</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">refreshMemory</span>();</span><br><span class="line">                    <span class="keyword">let</span> coffset = environ;</span><br><span class="line">                    <span class="keyword">let</span> offset = environBuf;</span><br><span class="line">                    <span class="title class_">Object</span>.<span class="title function_">entries</span>(env).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[key, value]</span>) =&gt;</span> &#123;</span><br><span class="line">                      thisView.<span class="title function_">setUint32</span>(coffset, offset, <span class="literal">true</span>);</span><br><span class="line">                      coffset += <span class="number">4</span>;</span><br><span class="line">                      offset += <span class="title class_">Buffer</span>.<span class="title function_">from</span>(thisMemory.<span class="property">buffer</span>).<span class="title function_">write</span>(</span><br><span class="line">                        <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>\0`</span>,</span><br><span class="line">                        offset</span><br><span class="line">                      );</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">environ_sizes_get</span>: <span class="function">(<span class="params">environCount, environBufSize</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">refreshMemory</span>();</span><br><span class="line">                    <span class="keyword">const</span> envProcessed = <span class="title class_">Object</span>.<span class="title function_">entries</span>(env).<span class="title function_">map</span>(</span><br><span class="line">                        <span class="function">(<span class="params">[key, value]</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>\0`</span></span><br><span class="line">                    );</span><br><span class="line">                    <span class="keyword">const</span> size = envProcessed.<span class="title function_">reduce</span>(</span><br><span class="line">                        <span class="function">(<span class="params">acc, e</span>) =&gt;</span> acc + <span class="title class_">Buffer</span>.<span class="title function_">byteLength</span>(e),</span><br><span class="line">                        <span class="number">0</span></span><br><span class="line">                    );</span><br><span class="line">                    thisView.<span class="title function_">setUint32</span>(environCount, envProcessed.<span class="property">length</span>, <span class="literal">true</span>);</span><br><span class="line">                    thisView.<span class="title function_">setUint32</span>(environBufSize, size, <span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">proc_exit</span>: <span class="function">(<span class="params">rval</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> wasmFileBuffer = fs.<span class="title function_">readFileSync</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;target/wasm32-wasi/debug/code-stock.wasm&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        wasmRes = <span class="keyword">await</span> <span class="title class_">WebAssembly</span>.<span class="title function_">instantiate</span>(wasmFileBuffer, importObject);</span><br><span class="line">        thisMemory = wasmRes.<span class="property">instance</span>.<span class="property">exports</span>.<span class="property">memory</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// wasmRes.instance.exports._start &amp;&amp; wasmRes.instance.exports._start();</span></span><br><span class="line">        </span><br><span class="line">        wasmRes.<span class="property">instance</span>.<span class="property">exports</span>.<span class="title function_">main</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;</span><br><span class="line">            consoleLogData,</span><br><span class="line">        &#125;);</span><br><span class="line">    </span><br><span class="line">     &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>ç„¶åç›´æ¥é€šè¿‡ <code>node test.js </code> æ—¢å¯æ‰§è¡Œ wasm ä»£ç </p><h2 id="å¦‚ä½•åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ-wasm-ç¨‹åº"><a href="#å¦‚ä½•åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ-wasm-ç¨‹åº" class="headerlink" title="å¦‚ä½•åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ wasm ç¨‹åº"></a>å¦‚ä½•åœ¨æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ wasm ç¨‹åº</h2><p>ç›®å‰æ–°ç‰ˆæœ¬çš„ç°ä»£æµè§ˆå™¨åŸºæœ¬ä¸Šéƒ½æœ‰ WebAssembly API </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> env = &#123;</span><br><span class="line">            <span class="attr">PWD</span>: <span class="string">&#x27;/&#x27;</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">let</span> thisView = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> wasmRes = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> thisMemory = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> consoleLogData = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">refreshMemory</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!thisView || thisView.<span class="property">buffer</span>.<span class="property">byteLength</span> === <span class="number">0</span>) &#123;</span><br><span class="line">                thisView = <span class="keyword">new</span> <span class="title class_">DataView</span>(thisMemory.<span class="property">buffer</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> <span class="title function_">getiovs</span> = (<span class="params">iovs, iovsLen</span>) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="title function_">refreshMemory</span>();</span><br><span class="line">      </span><br><span class="line">            <span class="keyword">const</span> buffers = <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: iovsLen &#125;, <span class="function">(<span class="params">_, i</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">const</span> ptr = iovs + i * <span class="number">8</span>;</span><br><span class="line">              <span class="keyword">const</span> buf = thisView.<span class="title function_">getUint32</span>(ptr, <span class="literal">true</span>);</span><br><span class="line">              <span class="keyword">const</span> bufLen = thisView.<span class="title function_">getUint32</span>(ptr + <span class="number">4</span>, <span class="literal">true</span>);</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(thisMemory.<span class="property">buffer</span>, buf, bufLen);</span><br><span class="line">            &#125;);</span><br><span class="line">      </span><br><span class="line">            <span class="keyword">return</span> buffers;</span><br><span class="line">          &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">Uint8ArrayToString</span>(<span class="params">fileData</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> dataString = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; fileData.<span class="property">length</span>; i++) &#123;</span><br><span class="line">              dataString += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(fileData[i]);</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">            <span class="keyword">return</span> dataString</span><br><span class="line">          </span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> importObject = &#123;</span><br><span class="line">            <span class="attr">wasi_snapshot_preview1</span>: &#123;</span><br><span class="line">                <span class="attr">fd_write</span>: <span class="function">(<span class="params">fd, iovs, iovsLen, nwritten</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> written = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">const</span> buffers = <span class="title function_">getiovs</span>(iovs, iovsLen);</span><br><span class="line"></span><br><span class="line">                    buffers.<span class="title function_">forEach</span>(<span class="function"><span class="params">buffer</span> =&gt;</span> &#123;</span><br><span class="line">                        consoleLogData+= <span class="title class_">Uint8ArrayToString</span>(buffer);</span><br><span class="line">                        written+=buffer.<span class="property">length</span>;</span><br><span class="line">                    &#125;);</span><br><span class="line"></span><br><span class="line">                    thisView.<span class="title function_">setUint32</span>(nwritten, written, <span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">environ_get</span>: <span class="function">(<span class="params">environ, environBuf</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">refreshMemory</span>();</span><br><span class="line">                    <span class="keyword">let</span> coffset = environ;</span><br><span class="line">                    <span class="keyword">let</span> offset = environBuf;</span><br><span class="line">                    <span class="title class_">Object</span>.<span class="title function_">entries</span>(env).<span class="title function_">forEach</span>(<span class="function">(<span class="params">[key, value]</span>) =&gt;</span> &#123;</span><br><span class="line">                      thisView.<span class="title function_">setUint32</span>(coffset, offset, <span class="literal">true</span>);</span><br><span class="line">                      coffset += <span class="number">4</span>;</span><br><span class="line">                      offset += <span class="title class_">Buffer</span>.<span class="title function_">from</span>(thisMemory.<span class="property">buffer</span>).<span class="title function_">write</span>(</span><br><span class="line">                        <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>\0`</span>,</span><br><span class="line">                        offset</span><br><span class="line">                      );</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">environ_sizes_get</span>: <span class="function">(<span class="params">environCount, environBufSize</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">refreshMemory</span>();</span><br><span class="line">                    <span class="keyword">const</span> envProcessed = <span class="title class_">Object</span>.<span class="title function_">entries</span>(env).<span class="title function_">map</span>(</span><br><span class="line">                        <span class="function">(<span class="params">[key, value]</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;value&#125;</span>\0`</span></span><br><span class="line">                    );</span><br><span class="line">                    <span class="keyword">const</span> size = envProcessed.<span class="title function_">reduce</span>(</span><br><span class="line">                        <span class="function">(<span class="params">acc, e</span>) =&gt;</span> acc + <span class="title class_">Buffer</span>.<span class="title function_">byteLength</span>(e),</span><br><span class="line">                        <span class="number">0</span></span><br><span class="line">                    );</span><br><span class="line">                    thisView.<span class="title function_">setUint32</span>(environCount, envProcessed.<span class="property">length</span>, <span class="literal">true</span>);</span><br><span class="line">                    thisView.<span class="title function_">setUint32</span>(environBufSize, size, <span class="literal">true</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">proc_exit</span>: <span class="function">(<span class="params">rval</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> wasmFileBuffer = <span class="title function_">fetch</span>(<span class="string">&#x27;target/wasm32-wasi/debug/code-stock.wasm&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        wasmRes = <span class="keyword">await</span> <span class="title class_">WebAssembly</span>.<span class="title function_">instantiate</span>(wasmFileBuffer, importObject);</span><br><span class="line">        thisMemory = wasmRes.<span class="property">instance</span>.<span class="property">exports</span>.<span class="property">memory</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// wasmRes.instance.exports._start &amp;&amp; wasmRes.instance.exports._start();</span></span><br><span class="line">        </span><br><span class="line">        wasmRes.<span class="property">instance</span>.<span class="property">exports</span>.<span class="title function_">main</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(&#123;</span><br><span class="line">            consoleLogData,</span><br><span class="line">        &#125;);</span><br><span class="line">    </span><br><span class="line">     &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ä»€ä¹ˆæ˜¯-wapm"><a href="#ä»€ä¹ˆæ˜¯-wapm" class="headerlink" title="ä»€ä¹ˆæ˜¯ wapm"></a>ä»€ä¹ˆæ˜¯ wapm</h2><blockquote><p>wampå®˜ç½‘: <a href="https://wapm.io/">https://wapm.io/</a></p></blockquote><p>wapm å…¨ç§°æ˜¯ webassembly Package management , æ˜¯ä¸€ä¸ªçº¿ä¸Šçš„ wasm äºŒè¿›åˆ¶åŒ…ç®¡ç†ä»“åº“ã€‚ä½œç”¨ç±»ä¼¼äº node.js çš„ npm æˆ– java çš„ maven</p><p>æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªä»“åº“ä¸Š å‘å¸ƒè‡ªå·±çš„ wasm ç¨‹åºï¼Œæˆ–è€…ä¸‹è½½è¿è¡Œåˆ«äººå‘å¸ƒçš„ wasm ç¨‹åºã€‚</p><h2 id="git-repo"><a href="#git-repo" class="headerlink" title="git repo"></a>git repo</h2><ul><li>rust ç”Ÿæˆ wams: <a href="https://github.com/yunqiangwu/wasmide/tree/main/rust/code-stock">https://github.com/yunqiangwu/wasmide/tree/main/rust/code-stock</a></li><li>node.js è°ƒç”¨ wamsï¼š <a href="https://github.com/yunqiangwu/wasmide/blob/main/rust/code-stock/test.js">https://github.com/yunqiangwu/wasmide/blob/main/rust/code-stock/test.js</a></li><li>æµè§ˆå™¨ç¯å¢ƒæ‰§è¡Œ wams: <a href="https://github.com/yunqiangwu/wasmide/tree/main/ui">https://github.com/yunqiangwu/wasmide/tree/main/ui</a></li></ul>]]></content>
    
    
    <summary type="html">ä»€ä¹ˆæ˜¯ wasm(webassembly) æŠ€æœ¯</summary>
    
    
    
    
    <category term="wasm webassembly nodejs" scheme="http://blog.jajabjbj.top/tags/wasm-webassembly-nodejs/"/>
    
  </entry>
  
  <entry>
    <title>å‰ç«¯æŒç»­é›†æˆç¯å¢ƒæ­å»º</title>
    <link href="http://blog.jajabjbj.top/2020/02/19/2020-02-19/"/>
    <id>http://blog.jajabjbj.top/2020/02/19/2020-02-19/</id>
    <published>2020-02-19T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="jenkins-nginx-å®ç°æŒç»­é›†æˆ"><a href="#jenkins-nginx-å®ç°æŒç»­é›†æˆ" class="headerlink" title="jenkins + nginx å®ç°æŒç»­é›†æˆ"></a>jenkins + nginx å®ç°æŒç»­é›†æˆ</h2><h3 id="æ­å»ºjenkins"><a href="#æ­å»ºjenkins" class="headerlink" title="æ­å»ºjenkins"></a>æ­å»ºjenkins</h3><p>jenkins æ˜¯ä¸€ä¸ªå¼€æºæŒç»­é›†æˆå·¥å…·ï¼Œå®‰è£…éå¸¸ç®€å•ï¼Œä¸ºäº†ç®¡ç†æ–¹ä¾¿ï¼Œè¿™é‡Œä½¿ç”¨ docker è¿›è¡Œå®‰è£…ã€‚</p><h4 id="å®‰è£…-docker"><a href="#å®‰è£…-docker" class="headerlink" title="å®‰è£… docker"></a>å®‰è£… docker</h4><p>centos å®‰è£… docker </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ docker æœåŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…-jenkins"><a href="#å®‰è£…-jenkins" class="headerlink" title="å®‰è£… jenkins"></a>å®‰è£… jenkins</h4><p>åˆ›å»º jenkins æ•°æ®æŒä¹…åŒ–ç›®å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /data</span><br><span class="line">sudo <span class="built_in">chmod</span> 777 /data</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/jenkins_home</span><br></pre></td></tr></table></figure><p>é€šè¿‡dockerå®¹å™¨å®‰è£…jenkins</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  -u root \</span><br><span class="line">  --<span class="built_in">rm</span> \</span><br><span class="line">  --name jenkins-server \</span><br><span class="line">  -d \</span><br><span class="line">  -p 8080:8080 \</span><br><span class="line">  -p 50000:50000 \</span><br><span class="line">  -v /data/jenkins_home:/var/jenkins_home \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  registry.cn-hangzhou.aliyuncs.com/hzero-cli/jenkins</span><br></pre></td></tr></table></figure><blockquote><p>å…³äº docker å‘½ä»¤çš„å­¦ä¹ å¯ä»¥çœ‹è¿™é‡Œ ğŸ‘‰ <a href="https://www.runoob.com/docker/docker-command-manual.html">Docker å‘½ä»¤å¤§å…¨</a></p></blockquote><p><img src="/images/15820942246314/15820967152707.jpg" alt="-w470"></p><p>ä¸Šé¢å‘½ä»¤è¿è¡Œå®Œæˆä¹‹åæˆ‘ä»¬å°±å·²ç»æˆåŠŸè¿è¡Œäº† jenkins æœåŠ¡</p><p>æˆ‘ä»¬å¯ä»¥æ‰“å¼€åœ°å€ https:&#x2F;&#x2F;<code>centosæœåŠ¡å™¨ip</code>:8080ï¼Œå¯ä»¥çœ‹åˆ° jenkins çš„ç•Œé¢ã€‚</p><blockquote><p>è¿™é‡Œçš„ <code>centosæœåŠ¡å™¨ip</code> å°±æ˜¯ä½ è‡ªå·±çš„æœåŠ¡å™¨ ipï¼Œåœ¨è¿™ä¸ªæ•™ç¨‹é‡Œé¢ï¼Œæˆ‘ä»¬æ¼”ç¤ºçš„æœåŠ¡å™¨ipæ˜¯ <code>172.22.0.4</code>ã€‚</p></blockquote><p><img src="/images/15820942246314/15820961636958.jpg" alt="-w1091"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦è·å–jenkinsåˆå§‹åŒ–å¯†ç ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it jenkins-server \</span><br><span class="line">    <span class="built_in">cat</span> /var/jenkins_home/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure><p><img src="/images/15820942246314/15820967619904.jpg" alt="-w455"></p><p>è¿™é‡Œè¿”å›çš„ä¸€æ®µå­—ç¬¦ä¸²<code>6c46ccc61c804279a1017b743ab22aa4</code>å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å¯†ç </p><p>è¾“å…¥å¯†ç ä¹‹åï¼Œé€‰æ‹©å®‰è£…åˆå§‹åŒ–çš„æ’ä»¶</p><p><img src="/images/15820942246314/15820971428778.jpg" alt="-w1013"><br><img src="/images/15820942246314/15820972130894.jpg" alt="-w997"><br>æ’ä»¶å®‰è£…å¥½ä¹‹åï¼Œç³»ç»Ÿä¼šæç¤ºä½ è®¾ç½®ç”¨æˆ·åå¯†ç ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸è®¾ç½®ï¼Œç›´æ¥ç”¨ admin è´¦å·ã€‚é‡æ–°è¿›å…¥ jenkins ç•Œé¢ã€‚<br><img src="/images/15820942246314/15820988660511.jpg" alt="-w689"><br>ç‚¹å‡»è¾“å…¥è´¦å·é‡Œé¢ï¼Œè¿™é‡Œçš„å¯†ç å°±æ˜¯ä¸Šæ–‡è·å–åˆ°çš„ jenkins åˆå§‹åŒ–å¯†ç  <code>6c46ccc61c804279a1017b743ab22aa4</code>ï¼Œç‚¹å‡»ç™»å½•ï¼Œè¿›å…¥ç³»ç»Ÿ:<br><img src="/images/15820942246314/15820989609929.jpg" alt="-w696"></p><p>åˆ°æ­¤ä¸ºæ­¢ã€‚jenkins å°±ç®—æ˜¯å®‰è£…å¥½äº†</p><blockquote><p>æˆ‘ä»¬å¦‚æœæƒ³è¦å¸è½½ jenkins çš„è¯ï¼Œåªéœ€è¦è¿è¡Œ <code>docker rm -f jenkins-server</code> å°±å¯ä»¥äº†ã€‚</p><p>å› ä¸ºæˆ‘ä»¬é…ç½®äº† jenkins æ•°æ®æŒä¹…åŒ–çš„ç›®å½• <code>/data/jenkins_home</code>ï¼Œ åªè¦è¿™ä¸ªæ–‡ä»¶å¤¹è¿˜åœ¨ï¼Œjenkins é…ç½®å°±å¯ä»¥ä¸€ç›´ä¿ç•™ï¼Œä¸‹æ¬¡æƒ³è¿è¡Œ jenkins æ˜¯ï¼Œè¿è¡Œä¸Šæ–‡å®‰è£… jenkins çš„ docker run å‘½ä»¤å°±å¯ä»¥æ¢å¤ docker è¿è¡Œäº†ã€‚</p></blockquote><h3 id="é…ç½®-jenkins-çš„-nodejs-æ’ä»¶"><a href="#é…ç½®-jenkins-çš„-nodejs-æ’ä»¶" class="headerlink" title="é…ç½® jenkins çš„ nodejs æ’ä»¶"></a>é…ç½® jenkins çš„ nodejs æ’ä»¶</h3><p>å®‰è£…å®Œ jenkins ä¹‹åï¼Œ éœ€è¦é…ç½®ä¸€ä¸‹ nodejs æ’ä»¶ï¼Œåé¢æ‰èƒ½è®© jenkins è·‘å‰ç«¯æŒç»­é›†æˆä»»åŠ¡ã€‚</p><p>ç‚¹å‡» <strong>ç³»ç»Ÿç®¡ç†</strong>  è¿›å…¥ jenkins ç³»ç»Ÿç®¡ç†é¡µé¢<br><img src="/images/15820942246314/15820991787999.jpg" alt="-w315"></p><p>ç‚¹å‡» <strong>æ’ä»¶ç®¡ç†</strong> è¿›å…¥æ’ä»¶ç®¡ç†<br><img src="/images/15820942246314/15821002348355.jpg" alt="-w1021"></p><p>è¿›å…¥ <strong>å¯é€‰æ’ä»¶</strong> é€‰é¡¹å¡ï¼Œæœç´¢å¹¶å®‰è£… <code>nodejs</code> æ’ä»¶<br><img src="/images/15820942246314/15821180399210.jpg" alt="-w1120"></p><p>å‹¾é€‰ <code>å®‰è£…å®Œæˆåé‡å¯é€‰é¡¹</code>ï¼Œå®‰è£…å®Œæ’ä»¶ä¹‹å jenkins ä¼š <strong>è‡ªåŠ¨é‡å¯</strong></p><p><img src="/images/15820942246314/15821181345609.jpg" alt="-w554"></p><p>è¿›å…¥ <strong>å…¨å±€å·¥å…·é…ç½®</strong> é…ç½® nodejs å…¨å±€å·¥å…·</p><p><img src="/images/15820942246314/15821182607013.jpg" alt="-w931"></p><p>ç‚¹å‡» <strong>æ–°å¢ NodeJS</strong> æŒ‰é”®æ–°å¢ä¸€ä¸ª nodejs å…¨å±€å·¥å…·ï¼Œå‹¾é€‰ <strong>è‡ªåŠ¨å®‰è£…</strong></p><p><img src="/images/15820942246314/15821185123655.jpg" alt="15821185123655"></p><p>æ³¨æ„:</p><ul><li>å®‰è£… nodejs æ—¶éœ€è¦å®‰è£…ä¸¤ä¸ª node å…¨å±€å‘½ä»¤ <code>yarn</code> å’Œ <code>lerna</code>, ç„¶åç‚¹å‡»ä¿å­˜ã€‚</li></ul><h3 id="æµ‹è¯•-nodejs-æ’ä»¶"><a href="#æµ‹è¯•-nodejs-æ’ä»¶" class="headerlink" title="æµ‹è¯• nodejs æ’ä»¶"></a>æµ‹è¯• nodejs æ’ä»¶</h3><p>æˆ‘ä»¬å®‰è£…å®Œäº† nodejs æ’ä»¶ä¹‹åï¼Œå…ˆå›åˆ°é¦–é¡µ æ–°å»ºä¸€ä¸ª jenkins ä»»åŠ¡æµ‹è¯•ä¸€ä¸‹ nodejsã€‚</p><p>ç‚¹å‡» <strong>åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡</strong> æ‰“å¼€ä»»åŠ¡ç¼–è¾‘ç•Œé¢<br><img src="/images/15820942246314/15821185754719.jpg" alt="-w630"><br>é€‰æ‹© <strong>æ„å»ºè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®</strong>ï¼Œ è¾“å…¥ä¸€ä¸ªä»»åŠ¡åå­—<code>test-node-demo</code>:<br><img src="/images/15820942246314/15821187127960.jpg" alt="-w718"></p><p>åœ¨æ„å»ºç¯å¢ƒè¿™é‡Œé€‰æ‹©æˆ‘ä»¬åˆšåˆšé…ç½®çš„ nodejs å…¨å±€å·¥å…·</p><p><img src="/images/15820942246314/15821187744475.jpg" alt="-w734"></p><p>åœ¨æ„å»ºè¿™é‡Œ ç‚¹å‡» <strong>å¢åŠ æ„å»ºæ­¥éª¤</strong> ï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­é€‰æ‹© <strong>æ‰§è¡Œshell</strong> ï¼š</p><p><img src="/images/15820942246314/15821188924270.jpg" alt="-w359"></p><p>åœ¨å‘½ä»¤è¾“å…¥æ¡†ä¸­è¾“å…¥,ç„¶åç‚¹å‡»ä¿å­˜æŒ‰é’®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -e &#x27;console.log(&quot;Hello Hzero!&quot;);&#x27;</span><br><span class="line">node --version</span><br></pre></td></tr></table></figure><p><img src="/images/15820942246314/15821190991233.jpg" alt="-w758"></p><p>ç„¶åç‚¹å‡»è¿™ä¸ªä»»åŠ¡çš„ <strong>ç«‹å³æ„å»º</strong> æŒ‰é’®</p><p>æ„å»ºæ—¶ï¼Œåœ¨ä¸‹é¢ä¼šå‡ºç°ä¸€ä¸ªè¿›åº¦æ¡ï¼Œç‚¹å‡»è¿›åº¦æ¡ å¯ä»¥çœ‹æ‰§è¡Œçš„æ—¥å¿—</p><p><img src="/images/15820942246314/15821191550792.jpg" alt="-w624"></p><p>è¿›å…¥æ—¥å¿—ä¹‹åï¼Œå°†çœ‹åˆ°çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯</p><p><img src="/images/15820942246314/15821240438051.jpg" alt="-w1061"></p><p>åˆ°æ­¤ï¼Œnodejs æ’ä»¶æµ‹è¯•æˆåŠŸï¼</p><h3 id="å®‰è£…-nginx"><a href="#å®‰è£…-nginx" class="headerlink" title="å®‰è£… nginx"></a>å®‰è£… nginx</h3><p>centos å®‰è£… nginx ä¹Ÿéå¸¸ç®€å• ï¼Œä¸€å¥å‘½ä»¤ <code>sudo yum install nginx</code> å°±èƒ½æå®šï¼Œ ä½†æ˜¯è¿™æ ·å®‰è£… nginx ä¹‹åï¼Œé…ç½®ç®¡ç†å’Œnginxå‡çº§éƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨ docker æ¥å®‰è£… nginx ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸¤ä¸ªæ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥ä¿å­˜ nginx çš„éƒ¨ç½²æ–‡ä»¶å’Œ nginx çš„é…ç½®</p><ul><li><code>/data/nginx/wwwroot</code> nginx çš„éƒ¨ç½²æ–‡ä»¶å¤¹</li><li><code>/data/nginx/nginx_hzero.conf</code> hzero çš„ nginx é…ç½®</li></ul><p>é¦–å…ˆåˆ›å»º nginx æ•°æ®æŒä¹…åŒ–æ–‡ä»¶å¤¹å’Œ é…ç½®ä¿å­˜æ–‡ä»¶å¤¹,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /data/nginx/wwwroot</span><br><span class="line">sudo <span class="built_in">mkdir</span> -p /data/nginx/cfg</span><br></pre></td></tr></table></figure><p><img src="/images/15820942246314/15821112605783.jpg" alt="-w380"></p><p>åˆ›å»º nginx é…ç½®æ–‡ä»¶, ä¿å­˜åœ¨ <code>/data/nginx/cfg/nginx_hzero.conf</code></p><p>åœ¨å‘½ä»¤è¡Œè¿è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /data/nginx/cfg/nginx_hzero.conf</span></span><br><span class="line"></span><br><span class="line">sudo -s <span class="comment"># è¿›å…¥rootç”¨æˆ·æ¨¡å¼</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /data/nginx/cfg/nginx_hzero.conf &lt;&lt; <span class="string">END</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">server &#123;</span></span><br><span class="line"><span class="string">    listen       80;</span></span><br><span class="line"><span class="string">    server_name  localhost;</span></span><br><span class="line"><span class="string">    root   /usr/share/nginx/html/dist;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    location / &#123;</span></span><br><span class="line"><span class="string">      try_files \$uri /index.html;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    error_page   500 502 503 504  /50x.html;</span></span><br><span class="line"><span class="string">    location = /50x.html &#123;</span></span><br><span class="line"><span class="string">        root   /usr/share/nginx/html/dist;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # Media: images, icons, video, audio, HTC</span></span><br><span class="line"><span class="string">    location ~* \.(jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ &#123;</span></span><br><span class="line"><span class="string">    expires 1M;</span></span><br><span class="line"><span class="string">    access_log off;</span></span><br><span class="line"><span class="string">    add_header Cache-Control &quot;public&quot;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    # CSS and Javascript</span></span><br><span class="line"><span class="string">    location ~* \.(css|js)$ &#123;</span></span><br><span class="line"><span class="string">    expires 1y;</span></span><br><span class="line"><span class="string">    access_log off;</span></span><br><span class="line"><span class="string">    add_header Cache-Control &quot;public&quot;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">END</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/images/15820942246314/15821112926505.jpg" alt="-w590"></p><p>è¿è¡Œnginxé•œåƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  -u root \</span><br><span class="line">  --<span class="built_in">rm</span> \</span><br><span class="line">  --name nginx \</span><br><span class="line">  -d \</span><br><span class="line">  -p 40080:80 \</span><br><span class="line">  -v /data/nginx/cfg/:/etc/nginx/conf.d/ \</span><br><span class="line">  -v /data/nginx/wwwroot/:/usr/share/nginx/html/ \</span><br><span class="line">  nginx</span><br></pre></td></tr></table></figure><p><img src="/images/15820942246314/15821113566156.jpg" alt="-w458"></p><p>æ·»åŠ æµ‹è¯•æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">mkdir</span> -p /data/nginx/wwwroot/dist</span><br><span class="line">sudo <span class="built_in">echo</span> Hello Nginx &gt; /data/nginx/wwwroot/dist/test.txt</span><br></pre></td></tr></table></figure><p>æµ‹è¯• nginx è¿è¡Œæ•ˆæœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://172.22.0.4:40080/test.txt</span><br></pre></td></tr></table></figure><p><img src="/images/15820942246314/15821113849756.jpg" alt="-w472"></p><p>å¦‚æœèƒ½æ˜¾ç¤º Hello Nginx è¯´æ˜ nginx å®‰è£…æˆåŠŸ</p><h3 id="é…ç½®-jenkins-æŒç»­é›†æˆä»»åŠ¡"><a href="#é…ç½®-jenkins-æŒç»­é›†æˆä»»åŠ¡" class="headerlink" title="é…ç½® jenkins æŒç»­é›†æˆä»»åŠ¡"></a>é…ç½® jenkins æŒç»­é›†æˆä»»åŠ¡</h3><h4 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h4><p>é…ç½® jenkins ä»»åŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸ª hzero-front å·¥ç¨‹çš„ä»£ç ä»“åº“åœ°å€ï¼š<br><code>https://code.choerodon.com.cn/hft/hzero-front-demo.git</code></p><p>å›åˆ° jenkins é¦–é¡µ æ–°å»ºä¸€ä¸ª jenkins ä»»åŠ¡ã€‚</p><p>ç‚¹å‡» <strong>åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡</strong> æ‰“å¼€ä»»åŠ¡ç¼–è¾‘ç•Œé¢<br><img src="/images/15820942246314/15821185754719.jpg" alt="-w630"><br>é€‰æ‹© <strong>æ„å»ºè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®</strong>ï¼Œ è¾“å…¥ä¸€ä¸ªä»»åŠ¡åå­—<code>hzero-front-ci</code>:</p><p>ç‚¹å‡»ä¿å­˜åä¼šè¿›å…¥ä»»åŠ¡ç¼–è¾‘é¡µé¢ï¼š</p><p><img src="/images/15820942246314/15821309390419.jpg" alt="-w1054"></p><p>åœ¨ä»»åŠ¡ç¼–è¾‘ç•Œé¢çš„æºä»£ç ç®¡ç† é€‰æ‹© git é€‰é¡¹<br>å®‰è£…å›¾ç‰‡å¡«å†™ä¸‹é¢ä¿¡æ¯ï¼š</p><ul><li>Repository URLï¼š è¾“å…¥ä»£ç åº“åœ°å€ï¼ˆ<code>https://code.choerodon.com.cn/hft/hzero-front-demo.git</code>ï¼‰</li><li>Credentialsï¼šæ·»åŠ  code.choerodon.com.cn çš„è´¦å·å¯†ç </li></ul><p>åœ¨ç¼–è¯‘ç¯å¢ƒè®¾ç½®é‡Œé¢å‹¾é€‰ä¸Š nodejs å·¥å…·ã€‚</p><p><img src="/images/15820942246314/15821311690599.jpg" alt="-w980"></p><p>æ·»åŠ ä¸€ä¸ªæ„å»ºæ­¥éª¤ <code>æ‰§è¡Œ shell</code><br><img src="/images/15820942246314/15821312331832.jpg" alt="-w515"></p><p>è¾“å…¥ä¸‹é¢çš„ shell è„šæœ¬:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; src/config/.env.production.yml.local  &lt;&lt; <span class="string">END</span></span><br><span class="line"><span class="string">BASE_PATH: /</span></span><br><span class="line"><span class="string">PLATFORM_VERSION: SAAS</span></span><br><span class="line"><span class="string">CLIENT_ID: localhost</span></span><br><span class="line"><span class="string">GENERATE_SOURCEMAP: false</span></span><br><span class="line"><span class="string">API_HOST: http://backend.hft.jajabjbj.top</span></span><br><span class="line"><span class="string">WEBSOCKET_HOST: ws://ws.hft.jajabjbj.top</span></span><br><span class="line"><span class="string">SKIP_TS_CHECK_IN_START: false</span></span><br><span class="line"><span class="string">ENABLE_VUE_SUPPORT: false</span></span><br><span class="line"><span class="string">SKIP_ESLINT_CHECK_IN_START: false</span></span><br><span class="line"><span class="string">END</span></span><br><span class="line">yarn run build:production</span><br><span class="line">tar -zcf dist.tar.gz ./dist</span><br></pre></td></tr></table></figure><p><img src="/images/15820942246314/15821804456276.jpg" alt="-w961"></p><p>ç‚¹å‡»ä¿å­˜ã€‚</p><p>ä¸‹ä¸€æ­¥ç„¶åç‚¹å‡» ç«‹å³æ„å»ºï¼Œè¿™é‡Œä¼šæ„å»ºå¹¶ç”Ÿæˆ dist æ–‡ä»¶</p><p><img src="/images/15820942246314/15821313783678.jpg" alt="-w711"></p><h4 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h4><p>æ„å»ºå®Œæˆç”Ÿæˆäº† dist æ–‡ä»¶ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬è¦æŠŠ æ„å»ºç”Ÿæˆçš„æ–‡ä»¶éƒ¨ç½²åˆ° nginx çš„ www ç›®å½• <code>/data/nginx/wwwroot</code></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬é…ç½®ä¸€ä¸‹ dist éƒ¨ç½²æµç¨‹</p><p>éƒ¨ç½²é€šå¸¸éƒ½æ˜¯æŒ‡æŠŠæ„å»ºå¥½çš„ dist æ–‡ä»¶éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œéƒ¨ç½²çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ ftpã€ æ„å»º dockerç­‰ã€ssh ï¼Œ è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•é€šè¿‡ ssh è¿œç¨‹éƒ¨ç½² dist æ–‡ä»¶åˆ° nginx æœåŠ¡å™¨ä¸Šã€‚</p><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸ª jenkins æ’ä»¶ <code>Publish Over SSH</code>ã€‚</p><p><img src="/images/15820942246314/15821775655990.jpg" alt="-w814"></p><p>æ’ä»¶çš„å®‰è£…æ–¹æ³•ä¸Šæ–‡ä¸­æœ‰æåˆ°ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°ã€‚</p><p>å®‰è£…å¥½ä¹‹åï¼Œæ‰“å¼€ <strong>ç³»ç»Ÿç®¡ç†</strong> &gt; <strong>é…ç½®ä¸­å¿ƒ</strong><br><img src="/images/15820942246314/15821779486366.jpg" alt="-w793"></p><p>æŠŠ nginx æœåŠ¡å™¨çš„ä¿¡æ¯ æ·»åŠ åˆ° <code>Publish Over SSH</code> çš„ ssh é…ç½®ã€‚</p><p><img src="/images/15820942246314/15821778504635.jpg" alt="-w1413"></p><p>å¯¹å…³é”®é…ç½®é¡¹çš„è§£é‡Šï¼š</p><ul><li><strong>name</strong>: ç»™æœåŠ¡å™¨èµ·ä¸€ä¸ªåå­—ï¼Œåœ¨åé¢è®¾ç½®ä»»åŠ¡æ—¶ä¼šç”¨åˆ°è¿™ä¸ªåå­—ã€‚</li><li><strong>Hostname</strong>: sshd æœåŠ¡å™¨çš„ipåœ°å€, ä¹Ÿå°±æ˜¯ nginx æœåŠ¡å™¨ipåœ°å€ã€‚</li><li><strong>Remote Directory</strong>: è¿™é‡Œæ˜¯è®¾ç½®æœåŠ¡å™¨ä¸Šä¼ ç›®å½•ï¼Œç”±äºåœ¨ jenkins ä»»åŠ¡é‡Œé¢å¯ä»¥é…ç½®ï¼Œ ä¸ºäº†ä¸å¼•èµ·è¯¯è§£ï¼Œè¿™é‡Œè®¾ç½®æˆ <code>/</code> å°±å¯ä»¥äº†ã€‚</li><li><strong>Passphrase&#x2F;Password</strong>: è¿™é‡Œæ˜¯æœåŠ¡å™¨ ssh ç™»å½•å¯†ç ï¼Œå¦‚æœæ˜¯é€šè¿‡ç§é’¥è¿æ¥æœåŠ¡å™¨ï¼Œå¯ä»¥ä¸è¾“å…¥å¯†ç ã€‚</li><li><strong>Key</strong>: è¿™é‡Œæ˜¯æœåŠ¡å™¨çš„ç§é’¥æ–‡ä»¶å†…å®¹ã€‚å¦‚æœä½ æ˜¯é€šè¿‡ å¯†ç  è¿æ¥ ssh æœåŠ¡å™¨çš„è¯ï¼Œå¯ä»¥ä¸å¡«ç§é’¥ã€‚</li></ul><p>ç„¶åæ‰“å¼€æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ jenkins ä»»åŠ¡ï¼Œç‚¹å‡»é…ç½®æŒ‰é’®ï¼Œè¿›å…¥ä»»åŠ¡ç¼–è¾‘é¡µé¢ã€‚</p><p><img src="/images/15820942246314/15821318511535.jpg" alt="-w500"></p><p>åˆ° <code>Post-build Actions</code> é…ç½®éƒ¨åˆ†æ·»åŠ ä¸€ä¸ª æ„å»ºåçš„éƒ¨ç½²æµç¨‹ã€‚<br><img src="/images/15820942246314/15821781519316.jpg" alt="-w651"></p><p>ç„¶åè¾“å…¥ç›¸åº”çš„é…ç½®</p><p><img src="/images/15820942246314/15821781898781.jpg" alt="-w968"></p><p>å¯¹å…³é”®é…ç½®é¡¹çš„è§£é‡Šï¼š</p><ul><li><strong>name</strong>: ä¸Šæ–‡åœ¨ <strong>ç³»ç»Ÿç®¡ç†</strong> &gt; <strong>é…ç½®ä¸­å¿ƒ</strong> ä¸­é…ç½®çš„ ssh æœåŠ¡å™¨åå­—ã€‚</li><li><strong>Source files</strong>: åˆ¶å®šä¸Šä¼ åˆ°æœåŠ¡å™¨çš„æ–‡ä»¶ï¼Œæ³¨æ„è¿™é‡Œçš„æ–‡ä»¶æ˜¯ä¸Šé¢æˆ‘ä»¬é…ç½®çš„æ„å»ºè„šæœ¬äº§ç”Ÿçš„æ–‡ä»¶ã€‚</li><li><strong>Remote directory</strong>: è¿™ä¸ªæ˜¯ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨ä½ç½®ï¼Œä¸Šä¼ ä¸Šå»çš„æ–‡ä»¶è¿˜æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œåé¢è¿˜æœ‰åœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰§è¡ŒèŠ‚çº¦å‘½ä»¤</li><li><strong>Exec command</strong>: åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œçš„ shell å‘½ä»¤</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/nginx/wwwroot</span><br><span class="line">sudo <span class="built_in">rm</span> -rf dist</span><br><span class="line">sudo tar -zxf dist.tar.gz</span><br></pre></td></tr></table></figure><p>ç„¶åç‚¹å‡»ä¿å­˜ï¼Œå†æ„å»ºä¸€æ¬¡ã€‚<br><img src="/images/15820942246314/15821793949244.jpg" alt="-w1156"></p><p>çœ‹ä¸‹æ„å»ºæ—¥å¿—ã€‚æç¤ºå‘å¸ƒæˆåŠŸã€‚</p><p><img src="/images/15820942246314/15821794072373.jpg" alt="-w525"></p><p>ç„¶åæˆ‘ä»¬å¯ä»¥ åœ¨æµè§ˆå™¨è¾“å…¥ä¸€ä¸‹ nginx æœåŠ¡å™¨åœ°å€ï¼Œ è¯•è¯•æœåŠ¡æ˜¯å¦æˆåŠŸã€‚</p><h4 id="é…ç½®è‡ªåŠ¨æŒç»­é›†æˆ"><a href="#é…ç½®è‡ªåŠ¨æŒç»­é›†æˆ" class="headerlink" title="é…ç½®è‡ªåŠ¨æŒç»­é›†æˆ"></a>é…ç½®è‡ªåŠ¨æŒç»­é›†æˆ</h4><p>å¦‚æœæƒ³å®ç°å®Œå…¨è‡ªåŠ¨çš„æŒç»­é›†æˆï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸ªåœ°æ–¹</p><p>æ‰“å¼€ä»»åŠ¡é…ç½®è®¾ç½®ä¸€ä¸ªè§¦å‘é€‰é¡¹ <code>Poll SCM</code>ï¼Œè®¾ç½® <code>Schedule</code> è§„åˆ™ä¸º: <code>H/15 * * * *</code></p><p><img src="/images/15820942246314/15821800915046.jpg" alt="-w1229"></p><p>è¿™é‡Œé…ç½®é¡¹çš„æ„æ€æ˜¯ï¼šæ¯ 15 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ git æºä»£ç ä»“åº“æ˜¯å¦æœ‰æ–°çš„å˜æ›´ï¼Œå¦‚æœæœ‰å°±æ‰§è¡Œæ„å»ºä»»åŠ¡ã€‚</p><blockquote><p><a href="https://tool.lu/crontab/">å…³äº cronjob è¡¨è¾¾å¼çš„å­¦ä¹ </a></p></blockquote><h2 id="jenkins-gh-pages-å®ç°æŒç»­é›†æˆ"><a href="#jenkins-gh-pages-å®ç°æŒç»­é›†æˆ" class="headerlink" title="jenkins + gh-pages å®ç°æŒç»­é›†æˆ"></a>jenkins + gh-pages å®ç°æŒç»­é›†æˆ</h2><p>å¦‚æœæ²¡æœ‰ nginx æœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠ dist éƒ¨ç½²åˆ° gh-pages ä¸Šã€‚</p><p>è€ƒè™‘åˆ° github çš„ gh-pages ç½‘é€Ÿåœ¨å›½å†…æœ‰äº›æ…¢ï¼Œ æœ¬æ•™ç¨‹å°±ç”¨å›½å†…çš„ gitee åšä¸€ä¸ªç¤ºèŒƒã€‚</p><blockquote><p>giteeç½‘ç«™: <a href="https://gitee.com/">https://gitee.com/</a></p></blockquote><p>é¦–å…ˆæˆ‘ä»¬åœ¨ gitee ä¸Šé¢æ³¨å†Œå¥½è´¦å·ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ªä»£ç ä»“åº“ã€‚</p><p><img src="/images/15820942246314/15821819693074.jpg" alt="-w786"></p><p>æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªä»£ç ä»“åº“åœ°å€ï¼š<code>https://gitee.com/hzero-cli/hzero-front-demo-dist.git</code></p><p>éƒ¨ç½²åˆ° gh-pages ä¸Šé¢æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ª npm å·¥å…·</p><ul><li>gh-pages: <a href="https://www.npmjs.com/package/gh-pages">gh-pages æ–‡æ¡£åœ°å€</a></li></ul><p>æŠŠè¿™ä¸ªå·¥å…·é…ç½®åˆ° nodejs çš„å…¨å±€å·¥å…·ä¸Šé¢ï¼š</p><p><img src="/images/15820942246314/15821830690021.jpg" alt="-w910"></p><p>é…ç½®å¥½å·¥å…·ä¹‹åï¼Œå¼€å§‹åˆ›å»º jenkins ä»»åŠ¡ã€‚</p><p>ä¸ºäº†ç®€ä¾¿ï¼Œæˆ‘ä»¬åŸºäºä¹‹å‰çš„æŒç»­é›†æˆä»»åŠ¡åˆ›å»ºä¸€ä¸ªæ–°çš„æŒç»­é›†æˆä»»åŠ¡ã€‚</p><p>ç‚¹å‡» <strong>æ–°å»ºä»»åŠ¡</strong> æŒ‰é’®<br><img src="/images/15820942246314/15821821404080.jpg" alt="-w670"></p><p>ä¸ºä»»åŠ¡èµ·ä¸€ä¸ªæ–°åå­—ï¼š <code>hzero-front-ci-gitee</code></p><p><img src="/images/15820942246314/15821822551782.jpg" alt="-w1074"></p><p>æ³¨æ„è¿™é‡Œæˆ‘ä»¬è¦é€‰æ‹© <strong>Copy from</strong>, è¾“å…¥å‰é¢åˆ›å»ºçš„ä»»åŠ¡åå­—ï¼š<code>hzero-front-ci</code></p><p>ç‚¹å‡» ok ï¼Œè¿›å…¥æ„å»ºé…ç½®éƒ¨åˆ†ã€‚<br><img src="/images/15820942246314/15821827533997.jpg" alt="-w1201"></p><p>ä¿®æ”¹æ„å»ºè„šæœ¬ï¼Œæ·»åŠ  gh-pages éƒ¨ç½²å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.email <span class="string">&quot;you@example.com&quot;</span></span><br><span class="line">git config --global user.name <span class="string">&quot;Your Name&quot;</span></span><br><span class="line">gh-pages -r https://hzero-cli:abcd1234@gitee.com/hzero-cli/hzero-front-demo-dist.git   -b gh-pages   -d dist</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ é™¤ä» <code>hzero-front-ci</code> ä»»åŠ¡å¤åˆ¶è¿‡æ¥çš„ sshéƒ¨ç½² é…ç½®</p><p>ä¿å­˜ï¼Œç‚¹å‡»ç«‹å³æ„å»ºã€‚</p><p>è¿™æ ·æ„å»ºç”Ÿæˆçš„ dist å°±å¯ä»¥å‘å¸ƒåˆ° gitee ä»£ç ä»“åº“äº†ã€‚</p><p><img src="/images/15820942246314/15821861555894.jpg" alt="-w820"></p><p>è¿™é‡Œä¼šå¤šä¸€ä¸ªåˆ†æ”¯ï¼Œå°±æ˜¯æˆ‘ä»¬éƒ¨ç½²ä¸Šå»çš„æ–‡ä»¶ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç»™ gitee ä»£ç ä»“åº“è®¾ç½®ä¸€ä¸‹ gh-pages çš„ http æœåŠ¡ã€‚</p><p>ç‚¹å‡» <strong>æœåŠ¡</strong> &gt; <strong>Gitee Pages</strong></p><p><img src="/images/15820942246314/15821862428010.jpg" alt="-w973"></p><p>è®¾ç½®éƒ¨ç½²åˆ†æ”¯ä¸º gh-pages ,ç„¶åç‚¹å‡»å¼€å§‹æŒ‰é’®</p><p>è¿è¡ŒæˆåŠŸä¹‹åï¼Œ æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª http è®¿é—®åœ°å€ï¼š<code>http://hzero-cli.gitee.io/hzero-front-demo-dist/</code></p><p>ä½†æ˜¯è®¿é—®æ—¶ï¼Œ console è¿˜æ˜¯ä¼šæŠ¥é”™: </p><p><img src="/images/15820942246314/15821864231685.jpg" alt="-w1147"></p><p>è¿™æ˜¯å› ä¸º gitee çš„ gh-pages æä¾›çš„ http åœ°å€æœ‰ä¸€ä¸ªæ ¹è·¯å¾„(public_path)ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹æ„å»ºçš„ç¯å¢ƒå˜é‡ï¼Œæ‰“å¼€ä»»åŠ¡çš„æ„å»ºé…ç½®ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">PUBLIC_URL:</span> <span class="string">/hzero-front-demo-dist/</span></span><br><span class="line"><span class="attr">BASE_PATH:</span> <span class="string">/hzero-front-demo-dist/</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸€ä¸‹ BASE_PATH å’Œ PUBLIC_URL çš„åŒºåˆ«ã€‚</p><ul><li><strong>PUBLIC_URL</strong> : ä¼šå½±å“èµ„æºåŠ è½½è·¯å¾„ï¼Œåœ¨èµ„æºåŠ è½½è·¯å¾„å‰é¢åŠ ä¸€å±‚æ ¹è·¯å¾„ã€‚</li><li><strong>BASE_PATH</strong> : ä¼šå½±å“æµè§ˆå™¨çš„åœ°å€æ æ ¹è·¯å¾„ã€‚åœ¨åœ°å€æ æ˜¾ç¤ºçš„åœ°å€ä¸ŠåŠ ä¸€å±‚æ ¹è·¯å¾„ã€‚</li></ul><p>è™½ç„¶ BASE_PATH ä¸ä¼šå½±å“èµ„æºåŠ è½½è·¯å¾„ï¼Œä½†æ˜¯æˆ‘ä»¬è¿›å…¥é¡µé¢ä¹‹ååˆ·æ–°ï¼Œå¿…é¡»æµè§ˆå™¨çš„åœ°å€æ æ˜¯ä»¥ <code>http://hzero-cli.gitee.io/hzero-front-demo-dist/</code> ä¸ºå‰ç¼€ï¼Œæ‰€ä»¥è¦åŠ ä¸€ä¸‹ BASE_PATH çš„é…ç½®ã€‚</p><p>æ¸…é™¤æ„å»ºç¼“å­˜ï¼Œç„¶åç‚¹å‡»é‡æ–°æ„å»º<br><img src="/images/15820942246314/15821843422297.jpg" alt="-w369"></p><blockquote><p>æ³¨æ„: ç”±äº hzero-cli é»˜è®¤å¼€å¯äº†å¢é‡æ›´æ–°ï¼Œ æ‰€ä»¥ä¿®æ”¹äº†ç¯å¢ƒå˜é‡ä¹‹åï¼Œéœ€è¦æ¸…ç©ºå½“å‰æ„å»ºä»»åŠ¡çš„ç¼“å­˜ã€‚</p></blockquote><p>å¦‚æœä½ è®¿é—®é¡µé¢ï¼Œç¬¬äºŒæ¬¡åˆ·æ–°è¿˜ä¼šæœ‰ 404 çš„é—®é¢˜</p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ gh-pages å’Œ nginx é…ç½® ä¸ä¸€æ ·ã€‚<br>nginx ä¸Šé¢é…ç½®äº†ä¸€æ®µä»£ç ï¼š </p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">  <span class="attribute">try_files</span> <span class="variable">$uri</span> /index.html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº†è¿™æ®µä»£ç ï¼Œ æœåŠ¡å™¨å°±ä¼šè·¯å¾„æ‰¾ä¸åˆ°çš„httpè¯·æ±‚é‡æ–°å®šä½åˆ° &#x2F;index.html</p><p>ä½†æ˜¯ gh-pages çš„åŸç†æ˜¯: å¦‚æœå½“å‰ http è¯·æ±‚è·¯å¾„å®šä½ä¸åˆ°ä»“åº“çš„æ–‡ä»¶ï¼Œå°±è¿”å› 404.html çš„å†…å®¹ã€‚</p><p>æ‰€ä»¥ä¸ºäº†èƒ½è®©é¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨è„šæœ¬æ„å»ºå®Œæˆä¹‹å åŠ ä¸€è¡Œä»£ç  <code>cp dist/index.html dist/404.html</code><br>è®©æµè§ˆå™¨èƒ½è·å–åˆ° index.html ã€‚</p><p>æœ€åè„šæœ¬ä¿®æ”¹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">yarn install</span><br><span class="line"><span class="built_in">cat</span> &gt; src/config/.env.production.local.yml  &lt;&lt; <span class="string">END</span></span><br><span class="line"><span class="string">PUBLIC_URL: /hzero-front-demo-dist/</span></span><br><span class="line"><span class="string">BASE_PATH: /hzero-front-demo-dist/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">PLATFORM_VERSION: SAAS</span></span><br><span class="line"><span class="string">CLIENT_ID: localhost</span></span><br><span class="line"><span class="string">GENERATE_SOURCEMAP: false</span></span><br><span class="line"><span class="string">API_HOST: http://backend.hft.jajabjbj.top</span></span><br><span class="line"><span class="string">WEBSOCKET_HOST: ws://ws.hft.jajabjbj.top</span></span><br><span class="line"><span class="string">SKIP_TS_CHECK_IN_START: false</span></span><br><span class="line"><span class="string">ENABLE_VUE_SUPPORT: false</span></span><br><span class="line"><span class="string">SKIP_ESLINT_CHECK_IN_START: false</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">END</span></span><br><span class="line"></span><br><span class="line">yarn run build:production</span><br><span class="line"><span class="built_in">cp</span> dist/index.html dist/404.html</span><br><span class="line"></span><br><span class="line">git config --global user.email <span class="string">&quot;you@example.com&quot;</span></span><br><span class="line">git config --global user.name <span class="string">&quot;Your Name&quot;</span></span><br><span class="line">gh-pages-clean</span><br><span class="line">gh-pages -r https://hzero-cli:abcd1234@gitee.com/hzero-cli/hzero-front-demo-dist.git \</span><br><span class="line">  -b gh-pages \</span><br><span class="line">  -d dist</span><br></pre></td></tr></table></figure><p>æ¸…é™¤æ„å»ºç¼“å­˜ä¹‹åï¼Œç‚¹å‡»é‡æ–°æ„å»º, æ„å»ºæˆåŠŸä¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œéƒ¨ç½²å®Œæˆä¹‹åå°±å¯ä»¥è®¿é—®ï¼š <a href="http://hzero-cli.gitee.io/hzero-front-demo-dist">http://hzero-cli.gitee.io/hzero-front-demo-dist</a> äº†</p>]]></content>
    
    
    <summary type="html">å‰ç«¯æŒç»­é›†æˆç¯å¢ƒæ­å»º</summary>
    
    
    
    
    <category term="jenkins" scheme="http://blog.jajabjbj.top/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨é«˜é˜¶ç»„ä»¶å®ç°é¡µé¢çš„è¡¨å•æ•°æ®å’Œstateç¼“å­˜</title>
    <link href="http://blog.jajabjbj.top/2018/08/29/cache/"/>
    <id>http://blog.jajabjbj.top/2018/08/29/cache/</id>
    <published>2018-08-29T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŠŸèƒ½ä»‹ç»"><a href="#åŠŸèƒ½ä»‹ç»" class="headerlink" title="åŠŸèƒ½ä»‹ç»"></a>åŠŸèƒ½ä»‹ç»</h2><p>å½“é¡µé¢ä¸Šå­˜åœ¨ Antd çš„ Fromè¡¨å•,åˆ‡æ¢åˆ°å…¶ä»–é¡µé¢å†åˆ‡æ¢å›æ¥,å¸Œæœ›è¡¨å•çš„æ•°æ®å’Œé¡µé¢çŠ¶æ€æ•°æ®èƒ½å¤Ÿä¿ç•™, ä½¿ç”¨ä½¿ç”¨ <code>@cachePage</code> é«˜é˜¶ç»„ä»¶å®Œæˆç›¸åº”çš„åŠŸèƒ½</p><h2 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h2><p>å®šä¹‰ä¸€ä¸ªMapç¼“å­˜å¯¹è±¡<br>ä½¿ç”¨é«˜é˜¶ç»„ä»¶åŒ…è£…ä¸€å±‚ åŒ…å« From è¡¨å•çš„ç»„ä»¶ï¼Œ</p><p>åœ¨é«˜é˜¶ç»„ä»¶è¢«åŠ è½½æ—¶ï¼Œåœ¨ componentDidMonent æ–¹æ³•ä¸­åˆ¤æ–­ç¼“å­˜å¯¹è±¡ä¸­æ˜¯å¦æœ‰è¯¥é¡µé¢çš„æ•°æ®ï¼Œ å¦‚æœæœ‰æ•°æ®ï¼Œå°±é€šè¿‡ From è¡¨å•çš„ Api ï¼ŒæŠŠæ•°æ®è®¾ç½®åˆ°ç»„ä»¶çš„ From æ•°æ®é‡Œé¢ï¼Œ</p><p>åœ¨é«˜é˜¶ç»„ä»¶é”€æ¯æ—¶ï¼Œåœ¨ç»„ä»¶çš„ componentWillUnMonent æ–¹æ³•ä¸­ æŠŠè¢«åŒ…è£…ç»„ä»¶çš„Fromè¡¨å•çš„æ•°æ®å–å‡ºæ¥ æ”¾åˆ°ç¼“å­˜å¯¹è±¡ä¸­ã€‚</p><p><img src="/images/cache/1290619244.png" alt="-w369"></p><p>é«˜é˜¶ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Component</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å†…å­˜ç¼“å†²å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> cacheMap = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> cacheKeyList = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç¼“å­˜è·¯ç”±é¡µé¢è¡¨å• keep-alive</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; cacheKey               ç¼“å­˜çš„key,å¯¹åº”æ¯ä¸ªè·¯ç”±é¡µé¢çš„key, é»˜è®¤ è·¯ç”±é¡µé¢ç»„ä»¶åç§°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@propsMethod</span> props.cachePage.clear()  æ¸…é™¤ç¼“å­˜ï¼Œå¹¶æ ‡è®°è¿™æ¬¡è¡¨å•å°†ä¸è¢«ç¼“å­˜</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">cachePage</span> = (<span class="params">&#123;</span></span><br><span class="line"><span class="params">  cacheKey,</span></span><br><span class="line"><span class="params">&#125; = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">ComposedComponent</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> isError = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (!cacheKey) &#123;</span><br><span class="line">      <span class="comment">// console.warn(&#x27;ç¼ºå¤± CachePage å¿…å¡«å‚æ•° cacheKey&#x27;);</span></span><br><span class="line">      isError = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cacheKeyList.<span class="title function_">indexOf</span>(cacheKey) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// console.warn(&#x27;CachePage ,cacheKey å¿…é¡»ä¿è¯å…¨å±€å”¯ä¸€ï¼Œå¤šä¸€ä¸ªé¡µé¢ä¸èƒ½æœ‰ç›¸åŒ cacheKey &#x27;);</span></span><br><span class="line">      <span class="comment">// isError = true;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isError) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">ComposedComponent</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cacheKeyList.<span class="title function_">push</span>(cacheKey);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰æ˜¯å¦åº”è¯¥ä¿å­˜cacheï¼ˆå¦‚æœè¢«è°ƒç”¨æ”¶åˆ°æ¸…ç†cacheï¼Œå°±åœ¨ç»„ä»¶é”€æ¯æ—¶ä¸ä¿å­˜cacheï¼‰</span></span><br><span class="line">    <span class="keyword">let</span> shouldSave = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">const</span> mCacheKey = cacheKey</span><br><span class="line">      || <span class="title class_">ComposedComponent</span>.<span class="property">id</span></span><br><span class="line">      || <span class="title class_">ComposedComponent</span>.<span class="property">key</span>;</span><br><span class="line">      </span><br><span class="line">    <span class="comment">// è·å–cache</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getCache</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">let</span> cache = cache = cacheMap[mCacheKey];</span><br><span class="line">      <span class="keyword">if</span> (!cache) &#123;</span><br><span class="line">        cache = &#123;&#125;;</span><br><span class="line">        cacheMap[mCacheKey] = cache;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> cache;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜cache</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">setCache</span> = (<span class="params">cache</span>) =&gt; &#123;</span><br><span class="line">      cacheMap[mCacheKey] = cache;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¸…é™¤cache</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">clearCache</span> = (<span class="params">isClose</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">delete</span> cacheMap[mCacheKey] ;</span><br><span class="line">      <span class="keyword">if</span> (isClose) &#123;</span><br><span class="line">        shouldSave = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">WrapComponent</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">      <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; form &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> cacheData = <span class="title function_">getCache</span>();</span><br><span class="line">        <span class="keyword">if</span> (form &amp;&amp; cacheData.<span class="property">form</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; setFieldsValue, getFieldProps &#125; = form;</span><br><span class="line">          <span class="keyword">const</span> cacheFormData = cacheData.<span class="property">form</span>;</span><br><span class="line">          <span class="title class_">Object</span>.<span class="title function_">keys</span>(cacheFormData).<span class="title function_">forEach</span>(<span class="function">(<span class="params">formKey</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">getFieldProps</span>(formKey);</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="comment">// è®¾ç½®æ•°æ®åˆ°è¡¨å•</span></span><br><span class="line">          <span class="title function_">setFieldsValue</span>(cacheFormData);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">pageComponent</span> &amp;&amp; cacheData.<span class="property">pageState</span>) &#123;</span><br><span class="line">          <span class="comment">// è®¾ç½®æ•°æ®åˆ°é¡µé¢ç»„ä»¶state</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">pageComponent</span>.<span class="title function_">setState</span>(cacheData.<span class="property">pageState</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        shouldSave = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (shouldSave === <span class="literal">false</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> &#123; form &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">        <span class="keyword">const</span> cacheData = <span class="title function_">getCache</span>();</span><br><span class="line">        <span class="comment">// è·å–é¡µé¢ç»„ä»¶è¡¨å•æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (form) &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; getFieldsValue, getFieldProps &#125; = form;</span><br><span class="line">          cacheData.<span class="property">form</span> = <span class="title function_">getFieldsValue</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è·å–é¡µé¢ç»„ä»¶stateæ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">pageComponent</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">pageComponent</span>.<span class="property">state</span>) &#123;</span><br><span class="line">          cache.<span class="property">pageState</span> = <span class="variable language_">this</span>.<span class="property">pageComponent</span>.<span class="property">state</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¿å­˜æ•°æ®åˆ°ç¼“å­˜</span></span><br><span class="line">        <span class="title function_">setCache</span>(cache);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      actionObj = &#123;</span><br><span class="line">        <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">          <span class="title function_">clearCache</span>();</span><br><span class="line">          shouldSave = <span class="literal">false</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// eslint-disable-next-line react/no-string-refs</span></span><br><span class="line">        <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ComposedComponent</span> <span class="attr">ref</span>=<span class="string">&#123;(c)</span> =&gt;</span> &#123; this.pageComponent = c; &#125;&#125; cachePage=&#123;this.actionObj&#125; &#123;...this.props&#125; /&gt;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®© Form æ•°æ® JSON ååºåˆ—å·æ”¯æŒ Date</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">key</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> <span class="variable">value</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">*</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dateReviver</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> a = <span class="regexp">/^(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)T(\d&#123;2&#125;):(\d&#123;2&#125;):(\d&#123;2&#125;(?:\.\d*)?)Z$/</span>.<span class="title function_">exec</span>(value);</span><br><span class="line">    <span class="keyword">if</span> (a) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">moment</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(value));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">onClosePage</span> = (<span class="params">pathname</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (pathnameToCacheKey[pathname]) &#123;</span><br><span class="line">    pathnameToCacheKey[pathname](<span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å‚æ•°ä»‹ç»"><a href="#å‚æ•°ä»‹ç»" class="headerlink" title="å‚æ•°ä»‹ç»"></a>å‚æ•°ä»‹ç»</h2><ul><li><code>cacheKey</code> ç¼“å­˜çš„key,å¯¹åº”æ¯ä¸ªè·¯ç”±é¡µé¢çš„key, å¿…å¡«å‚æ•°</li></ul><h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>åœ¨ä½¿ç”¨è¯¥é«˜é˜¶ç»„ä»¶ä¿®é¥°çš„é¡µé¢å, é¡µé¢çš„<code>props</code>å†…éƒ¨ä¼šè¢«æ³¨å…¥ä¸€ä¸ªcachePageå¯¹è±¡,æä¾›ä¸ä»¥ä¸‹æ“ä½œç¼“å­˜çš„æ–¹æ³•:</p><ul><li><code>props.cachePage.clear()</code> : æ¸…é™¤ç¼“å­˜ï¼Œå¹¶æ ‡è®°è¿™æ¬¡è¡¨å•å°†ä¸è¢«ç¼“å­˜, åœ¨é¡µé¢ç»„ä»¶åˆ—é€šè¿‡<code>this.props.cachePage.clear()</code>, è·³è½¬åˆ°å…¶ä»–é¡µé¢æ—¶,æ•°æ®ä¸ä¼šè¢«ç¼“å­˜,å¹¶ä¸”æ¸…ç©ºä¸Šæ¬¡ç¼“å­˜çš„æ•°æ®</li></ul><h2 id="ä½¿ç”¨æ¡ˆä¾‹"><a href="#ä½¿ç”¨æ¡ˆä¾‹" class="headerlink" title="ä½¿ç”¨æ¡ˆä¾‹"></a>ä½¿ç”¨æ¡ˆä¾‹</h2><p>åœ¨é¡µé¢ç»„ä»¶ä¸­åŠ ä¸Šè¿™ä¸ªæ³¨è§£ï¼Œåˆ‡æ¢é¡µé¢æ—¶ï¼Œå¯ä»¥ä¿ç•™å½“å‰é¡µé¢çŠ¶æ€</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">PureComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Form</span>, <span class="title class_">Input</span>, &#125; <span class="keyword">from</span> <span class="string">&#x27;antd&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; cachePage &#125; <span class="keyword">from</span> <span class="string">&#x27;../../utils/Cache/cacheFromWrapper&#x27;</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Form</span>.<span class="title function_">create</span>()</span><br><span class="line">@<span class="title function_">cachePage</span>(&#123; <span class="attr">cacheKey</span>: <span class="string">&#x27;BasicFormPage&#x27;</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">BasicFormPage</span> <span class="keyword">extends</span> <span class="title class_ inherited__">PureComponent</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> _style = &#123; <span class="attr">marginTop</span>: <span class="number">8</span> &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="language-xml">&lt;Form&#123;</span></span><br><span class="line"><span class="language-xml">            hideRequiredMark</span></span><br><span class="line"><span class="language-xml">            style=&#123;_style&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">FormItem</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">              <span class="attr">label</span>=<span class="string">&quot;æ ‡é¢˜&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            &gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;getFieldDecorator(&#x27;title&#x27;, &#123;</span></span><br><span class="line"><span class="language-xml">                rules: [&#123;</span></span><br><span class="line"><span class="language-xml">                  required: true, message: &#x27;è¯·è¾“å…¥æ ‡é¢˜&#x27;,</span></span><br><span class="line"><span class="language-xml">                &#125;],</span></span><br><span class="line"><span class="language-xml">              &#125;)(</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&quot;ç»™ç›®æ ‡èµ·ä¸ªåå­—&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">              )&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">FormItem</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">From</span>&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŠŸèƒ½æ‰©å±•"><a href="#åŠŸèƒ½æ‰©å±•" class="headerlink" title="åŠŸèƒ½æ‰©å±•"></a>åŠŸèƒ½æ‰©å±•</h2><ul><li>é€šè¿‡å¯ä»¥åœ¨é«˜é˜¶ç»„ä»¶é‡Œé¢æŠŠæ•°æ®ç¼“å­˜åˆ° localStorage</li></ul><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><p>è¯¥é«˜é˜¶ç»„ä»¶çš„è¡¨å•ç¼“å­˜æ•ˆæœå®ç°ä¾èµ– Antd çš„ <code>From.create()</code>æ‰€ä»¥ä½¿ç”¨æ—¶,è¡¨å•çš„åˆ›å»ºå¿…é¡»ç”¨ antd ä¸­çš„ <code>From.create()</code>ç”Ÿæˆè¡¨å•</p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨é«˜é˜¶ç»„ä»¶å®ç°é¡µé¢çš„è¡¨å•æ•°æ®å’Œstateç¼“å­˜</summary>
    
    
    
    
    <category term="react" scheme="http://blog.jajabjbj.top/tags/react/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ openssl ç”Ÿæˆè¯ä¹¦</title>
    <link href="http://blog.jajabjbj.top/2018/05/30/2018-05-30/"/>
    <id>http://blog.jajabjbj.top/2018/05/30/2018-05-30/</id>
    <published>2018-05-30T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨-openssl-ç”Ÿæˆè¯ä¹¦"><a href="#ä½¿ç”¨-openssl-ç”Ÿæˆè¯ä¹¦" class="headerlink" title="ä½¿ç”¨ openssl ç”Ÿæˆè¯ä¹¦"></a>ä½¿ç”¨ openssl ç”Ÿæˆè¯ä¹¦</h2><p>ä»Šå¤©åœ¨é…ç½®kibanaæƒé™è®¾ç½®æ—¶ï¼Œkibanaè¦æ±‚ä½¿ç”¨httpsé“¾æ¥ã€‚</p><p>äºæ˜¯æ€»ç»“äº†ä¸€ä¸‹linuxä¸‹opensslç”Ÿæˆ ç­¾åçš„æ­¥éª¤ï¼š</p><p>x509è¯ä¹¦ä¸€èˆ¬ä¼šç”¨åˆ°ä¸‰ç±»æ–‡ï¼Œkeyï¼Œcsrï¼Œcrtã€‚</p><p>Key æ˜¯ç§ç”¨å¯†é’¥opensslæ ¼ï¼Œé€šå¸¸æ˜¯rsaç®—æ³•ã€‚</p><p>Csr æ˜¯è¯ä¹¦è¯·æ±‚æ–‡ä»¶ï¼Œç”¨äºç”³è¯·è¯ä¹¦ã€‚åœ¨åˆ¶ä½œcsræ–‡ä»¶çš„æ—¶ï¼Œå¿…é¡»ä½¿ç”¨è‡ªå·±çš„ç§é’¥æ¥ç­¾ç½²ç”³ï¼Œè¿˜å¯ä»¥è®¾å®šä¸€ä¸ªå¯†é’¥ã€‚</p><p>crtæ˜¯CAè®¤è¯åçš„è¯ä¹¦æ–‡ï¼Œï¼ˆwindowsä¸‹é¢çš„ï¼Œå…¶å®æ˜¯crtï¼‰ï¼Œç­¾ç½²äººç”¨è‡ªå·±çš„keyç»™ä½ ç­¾ç½²çš„å‡­è¯ã€‚ </p><ul><li>keyçš„ç”Ÿæˆ</li></ul><p><code>openssl genrsa -des3 -out server.key 2048 </code></p><p>è¿™æ ·æ˜¯ç”Ÿæˆrsaç§é’¥ï¼Œdes3ç®—æ³•ï¼Œopensslæ ¼å¼ï¼Œ2048ä½å¼ºåº¦ã€‚server.keyæ˜¯å¯†é’¥æ–‡ä»¶åã€‚ä¸ºäº†ç”Ÿæˆè¿™æ ·çš„å¯†é’¥ï¼Œéœ€è¦ä¸€ä¸ªè‡³å°‘å››ä½çš„å¯†ç ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•ç”Ÿæˆæ²¡æœ‰å¯†ç çš„key:</p><p><code>openssl rsa -in server.key -out server.key </code></p><p>server.keyå°±æ˜¯æ²¡æœ‰å¯†ç çš„ç‰ˆæœ¬äº†ã€‚ </p><ul><li>ç”ŸæˆCAçš„crt</li></ul><p><code>openssl req -new -x509 -key server.key -out ca.crt -days 3650 </code></p><p>ç”Ÿæˆçš„ca.crtæ–‡ä»¶æ˜¯ç”¨æ¥ç­¾ç½²ä¸‹é¢çš„server.csræ–‡ä»¶ã€‚ </p><ul><li>csrçš„ç”Ÿæˆæ–¹æ³•</li></ul><p><code>openssl req -new -key server.key -out server.csr </code></p><p>éœ€è¦ä¾æ¬¡è¾“å…¥å›½å®¶ï¼Œåœ°åŒºï¼Œç»„ç»‡ï¼Œemailã€‚æœ€é‡è¦çš„æ˜¯î€ƒæœ‰ä¸€ä¸ªcommon nameï¼Œå¯ä»¥å†™ä½ çš„åå­—æˆ–è€…åŸŸåã€‚å¦‚æœä¸ºäº†httpsç”³è¯·ï¼Œè¿™ä¸ªå¿…é¡»å’ŒåŸŸåå»åˆï¼Œå¦åˆ™ä¼šå¼•å‘æµè§ˆå™¨è­¦æŠ¥ã€‚ç”Ÿæˆçš„csræ–‡ä»¶äº¤ç»™CAç­¾ååå½¢æˆæœåŠ¡ç«¯è‡ªå·±çš„è¯ä¹¦ã€‚ </p><ul><li>crtç”Ÿæˆæ–¹æ³•</li></ul><p>CSRæ–‡ä»¶å¿…é¡»æœ‰CAçš„ç­¾åæ‰å¯å½¢æˆè¯ä¹¦ï¼Œå¯å°†æ­¤æ–‡ä»¶å‘é€åˆ°verisignç­‰åœ°æ–¹ç”±å®ƒéªŒè¯ï¼Œè¦äº¤ä¸€å¤§ç¬”é’±ï¼Œä½•ä¸è‡ªå·±åšCAå‘¢ã€‚</p><p><code>openssl x509 -req -days 3650 -in server.csr -CA ca.crt -CAkey server.key -CAcreateserial -out server.crt</code></p><p>è¾“å…¥keyçš„å¯†é’¥åï¼Œå®Œæˆè¯ä¹¦ç”Ÿæˆã€‚-CAé€‰é¡¹æŒ‡æ˜ç”¨äºè¢«ç­¾åçš„csrè¯ä¹¦ï¼Œ-CAkeyé€‰é¡¹æŒ‡æ˜ç”¨äºç­¾åçš„å¯†é’¥ï¼Œ-CAserialæŒ‡æ˜åºåˆ—å·æ–‡ä»¶ï¼Œè€Œ-CAcreateserialæŒ‡æ˜æ–‡ä»¶ä¸å­˜åœ¨æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚</p><p>æœ€åç”Ÿæˆäº†ç§ç”¨å¯†é’¥ï¼šserver.keyå’Œè‡ªå·±è®¤è¯çš„SSLè¯ä¹¦ï¼šserver.crt</p><p>è¯ä¹¦åˆå¹¶ï¼š</p><p><code>cat server.key server.crt &gt; server.pem</code></p><ul><li>é…ç½®docker ä¿¡ä»»è¯ä¹¦</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot; : [</span><br><span class="line">    &quot;http://b36c9ea6.m.daocloud.io&quot;</span><br><span class="line">  ],</span><br><span class="line">  &quot;tlscacert&quot; : &quot;/data/cert/server.pem&quot;,</span><br><span class="line">  &quot;debug&quot; : true,</span><br><span class="line">  &quot;experimental&quot; : true</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="http://cdn-qiniu-blog.jajabjbj.top/15276924282309.jpg"></p>]]></content>
    
    
    <summary type="html">ä½¿ç”¨ openssl ç”Ÿæˆè¯ä¹¦</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>æ­å»º gitlab-ci æŒç»­é›†æˆç¯å¢ƒ</title>
    <link href="http://blog.jajabjbj.top/2018/05/30/2018-05-31-1/"/>
    <id>http://blog.jajabjbj.top/2018/05/30/2018-05-31-1/</id>
    <published>2018-05-30T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ­å»º-gitlab-ci-æŒç»­é›†æˆç¯å¢ƒ"><a href="#æ­å»º-gitlab-ci-æŒç»­é›†æˆç¯å¢ƒ" class="headerlink" title="æ­å»º gitlab-ci æŒç»­é›†æˆç¯å¢ƒ"></a>æ­å»º gitlab-ci æŒç»­é›†æˆç¯å¢ƒ</h2><h3 id="å®‰è£…docker"><a href="#å®‰è£…docker" class="headerlink" title="å®‰è£…docker"></a>å®‰è£…docker</h3><p><a href="https://www.docker.com/get-docker">https://www.docker.com/get-docker</a></p><h3 id="æ·»åŠ -hosts"><a href="#æ·»åŠ -hosts" class="headerlink" title="æ·»åŠ  hosts"></a>æ·»åŠ  hosts</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># ã€Œ192.168.99.1 ã€ ä¸ºå®¿ä¸»æœºçš„ip</span><br><span class="line">192.168.99.1  gitlab.jajabjbj.top</span><br><span class="line">192.168.99.1  rancher.jajabjbj.top</span><br><span class="line">192.168.99.1  jenkins.jajabjbj.top</span><br><span class="line">192.168.99.1  docker.jajabjbj.top</span><br><span class="line">192.168.99.1  harbor.jajabjbj.top</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š è¿™é‡Œä¸èƒ½ä½¿ç”¨127.0.0.1ï¼Œåº”ä¸ºåœ¨dockerå®¹å™¨ä¸­çš„127.0.0.1 å’Œå®¿ä¸»æœºçš„127.0.0.1æ˜¯ä¸¤ä¸ªä¸åŒçš„ipï¼Œå¦‚æœdockerå®¹å™¨å†…è§£æè¿™ä¸ªåŸŸåå°±å¥½å¾—åˆ°é”™è¯¯çš„ipï¼Œè¿™é‡Œã€Œ192.168.99.1 ã€ ä¸ºä½ å®¿ä¸»æœºç”µè„‘ä¸Šé¢çš„è™šæ‹Ÿç½‘å¡çš„å›ºå®šipï¼Œå¯ä»¥å®‰è£… VirtrualBox ç­‰è½¯ä»¶åï¼Œå®¿ä¸»æœºä¸Šé¢ä¼šè‡ªåŠ¨åˆ›å»ºè™šæ‹Ÿç½‘å¡ã€‚</p><h3 id="å®‰è£…-nginx-proxy"><a href="#å®‰è£…-nginx-proxy" class="headerlink" title="å®‰è£… nginx proxy"></a>å®‰è£… nginx proxy</h3><p>å®‰è£… nginx-proxy çš„ç›®çš„æ˜¯ä¸ºäº†è®©å®¿ä¸»æœºå™¨é€šè¿‡ä¸€ä¸ªç«¯å£å·ï¼Œå‘å¤–ä»¥å¤šä¸ªä¸åŒå®¹å™¨çš„æ–¹å¼æä¾›å¤šä¸ªæœåŠ¡ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo docker run -d -p 80:80 --name nginx-proxy \</span><br><span class="line">    -v /var/run/docker.sock:/tmp/docker.sock:ro \</span><br><span class="line">    jwilder/nginx-proxy</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å®‰è£…gitlab"><a href="#å®‰è£…gitlab" class="headerlink" title="å®‰è£…gitlab"></a>å®‰è£…gitlab</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mkdir -p /srv/gitlab</span><br><span class="line"></span><br><span class="line">sudo docker run -d --privileged \</span><br><span class="line">    --env GITLAB_OMNIBUS_CONFIG=&quot;external_url &#x27;http://gitlab.jajabjbj.top/&#x27;&quot; \</span><br><span class="line">    --env VIRTUAL_HOST=gitlab.jajabjbj.top \</span><br><span class="line">    --name gitlab \</span><br><span class="line">    --restart always \</span><br><span class="line">    --volume /srv/gitlab/config:/etc/gitlab \</span><br><span class="line">    --volume /srv/gitlab/logs:/var/log/gitlab \</span><br><span class="line">    --volume /srv/gitlab/data:/var/opt/gitlab \</span><br><span class="line">    gitlab/gitlab-ce:latest</span><br><span class="line">    </span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># pages æœåŠ¡</span><br><span class="line">gitlab_rails[&#x27;lfs_enabled&#x27;] = true</span><br><span class="line"></span><br><span class="line">pages_external_url &#x27;http://gitlab.jajabjbj.top&#x27;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&#x27;pages_path&#x27;] =  &quot;/tmp/pages&quot;</span><br><span class="line"></span><br><span class="line">gitlab_rails[&#x27;lfs_enabled&#x27;] =  true</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…å¹¶æ·»åŠ -gitlab-runner"><a href="#å®‰è£…å¹¶æ·»åŠ -gitlab-runner" class="headerlink" title="å®‰è£…å¹¶æ·»åŠ  gitlab-runner"></a>å®‰è£…å¹¶æ·»åŠ  gitlab-runner</h3><h4 id="docker-é•œåƒè¿è¡Œæ–¹å¼"><a href="#docker-é•œåƒè¿è¡Œæ–¹å¼" class="headerlink" title="docker é•œåƒè¿è¡Œæ–¹å¼"></a>docker é•œåƒè¿è¡Œæ–¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; mkdir -p /srv/gitlab/gitlab-runner</span><br><span class="line">&gt; docker run -d --name gitlab-runner --restart always \</span><br><span class="line">  -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">  -v /srv/gitlab-runner/config:/etc/gitlab-runner \</span><br><span class="line">  gitlab/gitlab-runner:latest</span><br><span class="line">  </span><br></pre></td></tr></table></figure><p>åœ¨gitlab ä¸Šåˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ‰“å¼€é¡¹ç›®CIè®¾ç½®ï¼Œåœ¨é¡¹ç›®é‡Œé¢æ·»åŠ ä¸€ä¸ª gitlab-runner</p><p>æ·»åŠ ç•Œé¢ä¼šæä¾›ä¸€ä¸ªã€Œgitlab-ci tokenã€ï¼š UbK4qdLj1hvBsVxTSUJ5</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">  </span><br><span class="line">&gt; docker exec -it gitlab-runner bash</span><br><span class="line">&gt; gitlab-ci-multi-runner register \</span><br><span class="line">    --docker-volumes /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">    --docker-privileged</span><br><span class="line"></span><br><span class="line">Running in system-mode.</span><br><span class="line"></span><br><span class="line">Please enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):</span><br><span class="line">http://gitlab.jajabjbj.top/</span><br><span class="line">Please enter the gitlab-ci token for this runner:</span><br><span class="line">UbK4qdLj1hvBsVxTSUJ5</span><br><span class="line">Please enter the gitlab-ci description for this runner:</span><br><span class="line">[4857c90d8789]: mac-docker</span><br><span class="line">Please enter the gitlab-ci tags for this runner (comma separated):</span><br><span class="line"></span><br><span class="line">Whether to lock the Runner to current project [true/false]:</span><br><span class="line">[true]: false</span><br><span class="line">Registering runner... succeeded                     runner=UbK4qdLj</span><br><span class="line">Please enter the executor: shell, ssh, docker+machine, docker, docker-ssh, parallels, virtualbox, docker-ssh+machine, kubernetes:</span><br><span class="line">docker</span><br><span class="line">Please enter the default Docker image (e.g. ruby:2.1):</span><br><span class="line">node</span><br><span class="line">Runner registered successfully. Feel free to start it, but if it&#x27;s running already the config should be automatically reloaded!</span><br></pre></td></tr></table></figure><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><p>gitlab-ci ä¸­è¦ä½¿ç”¨docker in docker æ—¶, å¿…é¡»åœ¨gitlab-ci.yml ä¸­æ·»åŠ   docker:dind ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">image: docker:latest</span><br><span class="line">services:</span><br><span class="line">  - docker:dind</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">æ­å»º gitlab-ci æŒç»­é›†æˆç¯å¢ƒ</summary>
    
    
    
    
    <category term="gitlab-ci" scheme="http://blog.jajabjbj.top/tags/gitlab-ci/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ nginx-proxy å®ç°å¤šä¸ª dockerå®¹å™¨ä»¥ä¸åŒçš„åŸŸåå…±äº«å®¿ä¸»æœº80ç«¯å£å¯¹å¤–æä¾›æœåŠ¡</title>
    <link href="http://blog.jajabjbj.top/2018/05/30/2018-05-31/"/>
    <id>http://blog.jajabjbj.top/2018/05/30/2018-05-31/</id>
    <published>2018-05-30T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨-nginx-proxy-å®ç°å¤šä¸ª-docker-å®¹å™¨ä»¥ä¸åŒçš„åŸŸåå…±äº«å®¿ä¸»æœº80ç«¯å£å¯¹å¤–æä¾›æœåŠ¡"><a href="#ä½¿ç”¨-nginx-proxy-å®ç°å¤šä¸ª-docker-å®¹å™¨ä»¥ä¸åŒçš„åŸŸåå…±äº«å®¿ä¸»æœº80ç«¯å£å¯¹å¤–æä¾›æœåŠ¡" class="headerlink" title="ä½¿ç”¨ nginx-proxy å®ç°å¤šä¸ª docker å®¹å™¨ä»¥ä¸åŒçš„åŸŸåå…±äº«å®¿ä¸»æœº80ç«¯å£å¯¹å¤–æä¾›æœåŠ¡"></a>ä½¿ç”¨ nginx-proxy å®ç°å¤šä¸ª docker å®¹å™¨ä»¥ä¸åŒçš„åŸŸåå…±äº«å®¿ä¸»æœº80ç«¯å£å¯¹å¤–æä¾›æœåŠ¡</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 80:80 -p 443:443 -v /var/run/docker.sock:/tmp/docker.sock:ro -v /data/cert:/etc/nginx/certs \</span><br><span class="line">    --name my-nginx-proxy jwilder/nginx-proxy</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">ä½¿ç”¨ nginx-proxy å®ç°å¤šä¸ª dockerå®¹å™¨ä»¥ä¸åŒçš„åŸŸåå…±äº«å®¿ä¸»æœº80ç«¯å£å¯¹å¤–æä¾›æœåŠ¡</summary>
    
    
    
    
    <category term="docker" scheme="http://blog.jajabjbj.top/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>æœ¬åœ°å®‰è£… kubernetes ç¯å¢ƒ</title>
    <link href="http://blog.jajabjbj.top/2018/05/30/2018-06-03/"/>
    <id>http://blog.jajabjbj.top/2018/05/30/2018-06-03/</id>
    <published>2018-05-30T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…-k8s-å‡†å¤‡"><a href="#å®‰è£…-k8s-å‡†å¤‡" class="headerlink" title="å®‰è£… k8s å‡†å¤‡"></a>å®‰è£… k8s å‡†å¤‡</h2><h3 id="å®‰è£…-Kubernetes"><a href="#å®‰è£…-Kubernetes" class="headerlink" title="å®‰è£… Kubernetes"></a>å®‰è£… Kubernetes</h3><blockquote><p><a href="https://yq.aliyun.com/articles/221687">https://yq.aliyun.com/articles/221687</a></p></blockquote><ul><li>Mac OSX</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v0.25.2/minikube-darwin-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/</span><br></pre></td></tr></table></figure><ul><li>Linux</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo minikube http://kubernetes.oss-cn-hangzhou.aliyuncs.com/minikube/releases/v0.25.2/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/</span><br></pre></td></tr></table></figure><ul><li>Windows</li></ul><p>ä¸‹è½½ minikube-windows-amd64.exe æ–‡ä»¶ï¼Œå¹¶é‡å‘½åä¸º minikube.exe</p><ul><li>è‡ªå·±æ„å»º</li></ul><p>ä¹Ÿå¯ä»¥ä»Githubä¸Šè·å–ç›¸åº”çš„é¡¹ç›®è‡ªè¡Œæ„å»ºã€‚</p><p>æ³¨ï¼šéœ€è¦æœ¬åœ°å·²ç»å®‰è£…é…ç½®å¥½ Golang å¼€å‘ç¯å¢ƒå’ŒDockerå¼•æ“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/AliyunContainerService/minikube</span><br><span class="line">cd minikube</span><br><span class="line">git checkout aliyun-v0.25.0</span><br><span class="line">make</span><br><span class="line">sudo cp out/minikube /usr/local/bin/</span><br></pre></td></tr></table></figure><h3 id="å¯åŠ¨-k8s-amp-docker"><a href="#å¯åŠ¨-k8s-amp-docker" class="headerlink" title="å¯åŠ¨ k8s &amp; docker"></a>å¯åŠ¨ k8s &amp; docker</h3><blockquote><p>ç¼ºçœMinikubeä½¿ç”¨VirtualBoxé©±åŠ¨æ¥åˆ›å»ºKubernetesæœ¬åœ°ç¯å¢ƒ</p></blockquote> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minikube start --registry-mirror=https://registry.docker-cn.com</span><br></pre></td></tr></table></figure><p> æ‰“å¼€Kubernetesæ§åˆ¶å°</p> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minikube dashboard</span><br></pre></td></tr></table></figure><p> <img src="http://cdn-qiniu-blog.jajabjbj.top/15280082718440.png"></p>]]></content>
    
    
    <summary type="html">æœ¬åœ°å®‰è£… kubernetes ç¯å¢ƒ</summary>
    
    
    
    
    <category term="k8s" scheme="http://blog.jajabjbj.top/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>CSS å¸¸ç”¨ä»£ç é”¦å›Š</title>
    <link href="http://blog.jajabjbj.top/2018/05/22/2018-05-22-1/"/>
    <id>http://blog.jajabjbj.top/2018/05/22/2018-05-22-1/</id>
    <published>2018-05-22T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="CSS-å¸¸ç”¨ä»£ç é”¦å›Š"><a href="#CSS-å¸¸ç”¨ä»£ç é”¦å›Š" class="headerlink" title="CSS å¸¸ç”¨ä»£ç é”¦å›Š"></a>CSS å¸¸ç”¨ä»£ç é”¦å›Š</h2><ul><li>ä¸‰è¡Œæ–‡æœ¬æº¢å‡ºæ˜¾ç¤ºçœç•¥å·</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.textOverflow3</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.5em</span>;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">4.5em</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: justify;</span><br><span class="line">  <span class="attribute">margin-right</span>: -<span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">padding-right</span>: <span class="number">1em</span>;</span><br><span class="line">  &amp;<span class="selector-pseudo">:before</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#000</span>;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;...&#x27;</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">1px</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  &amp;<span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: white;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">margin-top</span>: <span class="number">0.2em</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">1em</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>æ–‡æœ¬æº¢å‡ºçœç•¥</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.textoverflow</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>:block;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">120px</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">0px</span> <span class="number">3px</span>;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">float</span>: left;</span><br><span class="line">    -o-<span class="attribute">text-overflow</span>: ellipsis;     <span class="comment">/* for Opera */</span></span><br><span class="line">    <span class="attribute">text-overflow</span>: ellipsis;        <span class="comment">/* for IE */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.textoverflow</span><span class="selector-pseudo">:after</span>&#123; <span class="attribute">content</span>: <span class="string">&quot;...&quot;</span>; &#125;<span class="comment">/* for Firefox */</span></span><br><span class="line"><span class="keyword">@media</span> all <span class="keyword">and</span> (<span class="attribute">min-width</span>: <span class="number">0px</span>)&#123; <span class="selector-class">.textoverflow</span><span class="selector-pseudo">:after</span>&#123; <span class="attribute">content</span>:<span class="string">&quot;&quot;</span>; &#125;<span class="comment">/* for Opera */</span> &#125;</span><br></pre></td></tr></table></figure><ul><li>å¤šæ CSS3</li></ul><p>ä½¿ç”¨css3æ¥åˆ›å»ºå¤šæ ï¼Œå®ƒå¯ä»¥è‡ªé€‚åº”ç½‘é¡µï¼Œä¸å…¼å®¹IE</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#columns-3</span> &#123;</span><br><span class="line">   <span class="attribute">text-align</span>: justify;</span><br><span class="line">   -moz-<span class="attribute">column-count</span>: <span class="number">3</span>;</span><br><span class="line">   -moz-<span class="attribute">column-gap</span>: <span class="number">12px</span>;</span><br><span class="line">   -moz-<span class="attribute">column-rule</span>: <span class="number">1px</span> solid <span class="number">#c4c8cc</span>;</span><br><span class="line">   -webkit-<span class="attribute">column-count</span>: <span class="number">3</span>;</span><br><span class="line">   -webkit-<span class="attribute">column-gap</span>: <span class="number">12px</span>;</span><br><span class="line">   -webkit-<span class="attribute">column-rule</span>: <span class="number">1px</span> solid <span class="number">#c4c8cc</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p data-height="800" data-theme-id="0" data-slug-hash="wcKrg" data-default-tab="result" data-user="camsong" data-embed-version="2" data-pen-title="2048 game" class="codepen">See the Pen <a href="https://codepen.io/camsong/pen/wcKrg/">2048 game</a> by Cam Song (<a href="https://codepen.io/camsong">@camsong</a>) on <a href="https://codepen.io">CodePen</a>.</p><script async src="https://static.codepen.io/assets/embed/ei.js"></script>---]]></content>
    
    
    <summary type="html">CSS å¸¸ç”¨ä»£ç é”¦å›Š</summary>
    
    
    
    
    <category term="css" scheme="http://blog.jajabjbj.top/tags/css/"/>
    
  </entry>
  
  <entry>
    <title>git å¸¸ç”¨å‘½ä»¤é”¦å›Š</title>
    <link href="http://blog.jajabjbj.top/2018/05/22/2018-05-22/"/>
    <id>http://blog.jajabjbj.top/2018/05/22/2018-05-22/</id>
    <published>2018-05-22T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="git-å¸¸ç”¨å‘½ä»¤é”¦å›Š"><a href="#git-å¸¸ç”¨å‘½ä»¤é”¦å›Š" class="headerlink" title="git å¸¸ç”¨å‘½ä»¤é”¦å›Š"></a>git å¸¸ç”¨å‘½ä»¤é”¦å›Š</h2><ul><li>è·å–å½“å‰ é¡¹ç›® git url</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git remote show <span class="comment"># origin</span></span><br><span class="line">git config remote.origin.url <span class="comment"># &#123;git url&#125;</span></span><br></pre></td></tr></table></figure><ul><li>è·å–å½“å‰åˆ†æ”¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git symbolic-ref --short -q HEAD <span class="comment"># master</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">git å¸¸ç”¨å‘½ä»¤é”¦å›Š</summary>
    
    
    
    
    <category term="git" scheme="http://blog.jajabjbj.top/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº demo å›¾åºŠ</title>
    <link href="http://blog.jajabjbj.top/2018/05/20/2018-05-23/"/>
    <id>http://blog.jajabjbj.top/2018/05/20/2018-05-23/</id>
    <published>2018-05-20T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº-demo-å›¾åºŠ"><a href="#æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº-demo-å›¾åºŠ" class="headerlink" title="æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº demo å›¾åºŠ"></a>æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº demo å›¾åºŠ</h2><blockquote><p>Github: <a href="https://github.com/yunqiangwu/jj-image-bed.git">https://github.com/yunqiangwu/jj-image-bed.git</a></p></blockquote><p>åŸºäºWebpackå·¥ç¨‹åŒ–è§£å†³æ–¹æ¡ˆ<a href="https://zhuanlan.zhihu.com/p/28322014"><code>easywebpack</code></a>æ„å»ºé¡¹ç›®<br>åŸºäº Egg + React + Webpack3 + ä¸ƒç‰›äº‘å­˜å‚¨ å•é¡µé¢æœåŠ¡ç«¯æ¸²æŸ“åŒæ„å·¥ç¨‹å›¾åºŠ<code>Demo</code>é¡¹ç›®</p><ul><li>Egg ç‰ˆæœ¬ï¼š ^2.x.x</li><li>Node ç‰ˆæœ¬: Node ^8.x.x+</li><li>Webpack ç‰ˆæœ¬: ^3.10.0, å¯¹åº” <code>easywebpack-react</code> ç‰ˆæœ¬ä¸º 3.6.0</li><li>React ç‰ˆæœ¬: ^15.0.0, ^16.0.0, </li><li>qiniu ç‰ˆæœ¬: 7.1.7</li></ul><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><ul><li><p>åŸºäº React å•é¡µé¢æœåŠ¡ç«¯å®¢æˆ·ç«¯åŒæ„å®ç°</p></li><li><p>æ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“ <code>render</code> å’Œçº¯å‰ç«¯æ¸²æŸ“ <code>renderClient</code></p></li><li><p>æ”¯æŒ react-router, react-redux æœåŠ¡ç«¯&#x2F;å®¢æˆ·ç«¯å•é¡µé¢æ¸²æŸ“</p></li><li><p>Node 8 ç‰ˆæœ¬çš„ async å’Œ await ç‰¹æ€§, Controller é‡‡ç”¨ class æ–¹å¼ç¼–å†™</p></li><li><p>å›¾ç‰‡ä¿å­˜åˆ°ä¸ƒç‰›äº‘</p></li><li><p>æ‹–æ‹½ä¸Šä¼ å›¾ç‰‡</p></li></ul><h3 id="ä¾èµ–"><a href="#ä¾èµ–" class="headerlink" title="ä¾èµ–"></a>ä¾èµ–</h3><ul><li><a href="https://github.com/hubcarl/easywebpack">easywebpack</a> ^3.5.3</li><li><a href="https://github.com/hubcarl/easywebpack-react">easywebpack-react</a> ^3.5.0</li><li><a href="https://github.com/hubcarl/egg-view-react-ssr">egg-view-react-ssr</a> ^2.1.0</li><li><a href="https://github.com/hubcarl/egg-webpack">egg-webpack</a> ^2.4.6</li><li><a href="https://github.com/hubcarl/egg-webpack-react">egg-webpack-react</a> ^2.0.0</li></ul><p><img src="http://cdn-qiniu-blog.jajabjbj.top/15271170207529.jpg"></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h5 id="Clone-é¡¹ç›®"><a href="#Clone-é¡¹ç›®" class="headerlink" title="Clone é¡¹ç›®"></a>Clone é¡¹ç›®</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/yunqiangwu/jj-image-bed.git</span><br></pre></td></tr></table></figure><h5 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a>å®‰è£…ä¾èµ–</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm start</span><br></pre></td></tr></table></figure><h5 id="å¯åŠ¨åº”ç”¨"><a href="#å¯åŠ¨åº”ç”¨" class="headerlink" title="å¯åŠ¨åº”ç”¨"></a>å¯åŠ¨åº”ç”¨</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure><p>åº”ç”¨è®¿é—®: <a href="http://127.0.0.1:7001/">http://127.0.0.1:7001</a></p><p><img src="http://cdn-qiniu-blog.jajabjbj.top/15271170561959.png"></p><h5 id="é¡¹ç›®æ„å»º"><a href="#é¡¹ç›®æ„å»º" class="headerlink" title="é¡¹ç›®æ„å»º"></a>é¡¹ç›®æ„å»º</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ç›´æ¥è¿è¡Œ(ç¼–è¯‘æ–‡ä»¶å…¨éƒ¨åœ¨å†…å­˜é‡Œé¢,æœ¬åœ°å¼€å‘ä½¿ç”¨)</span><br><span class="line">npm start</span><br><span class="line"></span><br><span class="line">// ç¼–è¯‘æ–‡ä»¶åˆ°ç£ç›˜æ‰“åŒ…ä½¿ç”¨(å‘å¸ƒæ­£å¼ç¯å¢ƒ)</span><br><span class="line">npm run build æˆ–è€… easywebpack build prod</span><br></pre></td></tr></table></figure><h5 id="é¡¹ç›®æˆªå›¾"><a href="#é¡¹ç›®æˆªå›¾" class="headerlink" title="é¡¹ç›®æˆªå›¾"></a>é¡¹ç›®æˆªå›¾</h5><h2 id=""><a href="#" class="headerlink" title=""></a><img src="http://cdn-qiniu-blog.jajabjbj.top/15271168264465.jpg"></h2><p><img src="http://cdn-qiniu-blog.jajabjbj.top/15271169015438.jpg"></p><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><ul><li><input checked="" disabled="" type="checkbox"> æ‹–æ‹½ä¸Šä¼ </li><li><input disabled="" type="checkbox"> ç²˜è´´å›¾ç‰‡</li><li><input disabled="" type="checkbox"> ç›¸å†Œç®¡ç†</li></ul><h3 id="License"><a href="#License" class="headerlink" title="License"></a>License</h3><p><a href="LICENSE">MIT</a></p>]]></content>
    
    
    <summary type="html">æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº demo å›¾åºŠ</summary>
    
    
    
    
    <category term="webpack" scheme="http://blog.jajabjbj.top/tags/webpack/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šæ·±å…¥æµ…å‡ºNodeJSã€‹ è¯»ä¹¦å­¦ä¹ æ€»ç»“</title>
    <link href="http://blog.jajabjbj.top/2018/05/20/abcd-a-d-asd/"/>
    <id>http://blog.jajabjbj.top/2018/05/20/abcd-a-d-asd/</id>
    <published>2018-05-20T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ã€Šæ·±å…¥æµ…å‡ºNodeJSã€‹-è¯»ä¹¦å­¦ä¹ æ€»ç»“"><a href="#ã€Šæ·±å…¥æµ…å‡ºNodeJSã€‹-è¯»ä¹¦å­¦ä¹ æ€»ç»“" class="headerlink" title="ã€Šæ·±å…¥æµ…å‡ºNodeJSã€‹ è¯»ä¹¦å­¦ä¹ æ€»ç»“"></a>ã€Šæ·±å…¥æµ…å‡ºNodeJSã€‹ è¯»ä¹¦å­¦ä¹ æ€»ç»“</h2><p><img src="http://cdn-qiniu-blog.jajabjbj.top/15271197699318.jpg"></p><h3 id="æˆæœ"><a href="#æˆæœ" class="headerlink" title="æˆæœ"></a>æˆæœ</h3><ul><li>æ–‡æ¡£:<ul><li><a href="https://blog.jajabjbj.top/2018/05/10/2018-05-19/">JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§</a></li></ul></li><li>é¡¹ç›®<ul><li><a href="https://github.com/yunqiangwu/blog/tree/master/code">node çˆ¬è™«</a></li><li><a href="https://blog.jajabjbj.top/2018/05/20/2018-05-23/">æœåŠ¡å™¨ç«¯æ¸²æŸ“ç¨‹åº demo å›¾åºŠ</a></li></ul></li></ul><h3 id="è¯»ä¹¦ç¬”è®°"><a href="#è¯»ä¹¦ç¬”è®°" class="headerlink" title="è¯»ä¹¦ç¬”è®°"></a>è¯»ä¹¦ç¬”è®°</h3><ul><li>NodeJS 5ä¸ªç‰¹ç‚¹ï¼šå¼‚æ­¥I&#x2F;O,äº‹ä»¶é©±åŠ¨ä¸å›è°ƒï¼Œå•çº¿ç¨‹äº‹ä»¶è½®è¯¢ï¼Œè·¨å¹³å°ã€‚</li><li>NodeJS 5ä¸ªå¤§å‘ï¼šå¼‚å¸¸å¤„ç†ï¼ŒåµŒå¥—å¤ªæ·±ï¼Œæ²¡æœ‰Sleepï¼Œå¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå¼‚æ­¥è½¬åŒæ­¥ã€‚</li><li>NodeJS 4ç§æå‡æ€§èƒ½çš„æ–¹æ³•ï¼šåŠ¨é™åˆ†ç¦»ï¼Œç¼“å­˜ï¼ˆRedisï¼‰,å¤šè¿›ç¨‹ï¼Œæ•°æ®åº“è¯»å†™åˆ†ç¦»ã€‚</li></ul><h4 id="NodeJSç®€ä»‹"><a href="#NodeJSç®€ä»‹" class="headerlink" title="NodeJSç®€ä»‹"></a>NodeJSç®€ä»‹</h4><ul><li>é«˜æ€§èƒ½ï¼Œç¬¦åˆæ—¶é—´é©±åŠ¨ï¼Œæ²¡æœ‰å†å²åŒ…è¢±è¿™ä¸‰ä¸ªä¸»è¦åŸå› ï¼ŒJavaScriptæˆä¸ºäº†Nodeçš„å®ç°è¯­è¨€ã€‚</li><li>NodeJSåŸºäºGoogle V8å¼•æ“ã€‚Nodeä¼˜ç§€çš„è¿ç®—èƒ½åŠ›ä¸»è¦æ¥è‡ªV8çš„æ·±åº¦ä¼˜åŒ–ã€‚</li><li>NodeJSç‰¹ç‚¹ï¼šå¼‚æ­¥I&#x2F;O,äº‹ä»¶é©±åŠ¨ä¸å›è°ƒå‡½æ•°ï¼Œå•çº¿ç¨‹äº‹ä»¶è½®è¯¢ï¼Œè·¨å¹³å°</li><li>NodeJSå•çº¿ç¨‹çš„ç¼ºç‚¹ï¼š<ul><li>æ— æ³•åˆ©ç”¨å¤šæ ¸CPU.</li><li>é”™è¯¯ä¼šå¼•èµ·æ•´ä¸ªåº”ç”¨è¿›ç¨‹é€€å‡ºã€‚</li><li>å¤§é‡è®¡ç®—å ç”¨CPUå¯¼è‡´æ— æ³•ç»§ç»­è°ƒç”¨å¼‚æ­¥I&#x2F;O.</li><li>è§£å†³å•çº¿ç¨‹ç¼ºç‚¹çš„æ–¹æ³•æ˜¯å¼•å…¥å­è¿›ç¨‹æ–¹æ³•ï¼ˆCluster,è§åè¾¹ï¼‰å’ŒC&#x2F;C++æ¨¡å—æ‰©å±•ï¼ˆåˆ©ç”¨å®ƒä»¬çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼‰ã€‚</li></ul></li></ul><h4 id="æ¨¡å—æœºåˆ¶"><a href="#æ¨¡å—æœºåˆ¶" class="headerlink" title="æ¨¡å—æœºåˆ¶"></a>æ¨¡å—æœºåˆ¶</h4><ul><li>Nodeå‡ºç°ä¹‹å‰ï¼ŒæœåŠ¡å™¨ç«¯çš„JSåŸºæœ¬æ²¡æœ‰å¸‚åœºçš„ã€‚</li><li>CommonJSä¸»è¦æ˜¯ä¸ºäº†å¼¥è¡¥å½“å‰JSæ²¡æœ‰æ ‡å‡†çš„ç¼ºé™·ï¼Œå¸Œæœ›JSèƒ½å¤Ÿåœ¨ä»»ä½•åœ°æ–¹è¿è¡Œã€‚</li></ul><h5 id="æ¨¡å—å¼•ç”¨"><a href="#æ¨¡å—å¼•ç”¨" class="headerlink" title="æ¨¡å—å¼•ç”¨"></a>æ¨¡å—å¼•ç”¨</h5><p><code>var xxx = require(â€˜æ¨¡å—æ ‡è¯†â€™);</code></p><p>ä¾‹å¦‚ï¼š<code>var math = require(â€˜mathâ€™);</code></p><h5 id="æ¨¡å—å®šä¹‰"><a href="#æ¨¡å—å®šä¹‰" class="headerlink" title="æ¨¡å—å®šä¹‰"></a>æ¨¡å—å®šä¹‰</h5><p>æ¨¡å—ä¸­moduleå¯¹è±¡ä»£è¡¨æ¨¡å—è‡ªèº«ï¼Œexportså¯¹è±¡æ˜¯moduleçš„å±æ€§ï¼Œç”¨äºå¯¼å‡ºå½“å‰æ¨¡å—çš„æ–¹æ³•æˆ–è€…å˜é‡ï¼Œå®ƒæ˜¯å”¯ä¸€å¯¼å‡ºçš„å‡ºå£ã€‚moduleå’Œexportsæ˜¯nodeåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç»™åŠ ä¸Šå»çš„ã€‚</p><p>NodeJSä¸­ï¼Œä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå°†æ–¹æ³•æˆ–è€…å˜é‡æŒ‚åœ¨åœ¨exportså¯¹è±¡ä¸Šä½œä¸ºå±æ€§å³å¯å®šä¹‰å¯¼å‡ºçš„æ–¹å¼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">exports.xxx = â€¦â€¦</span><br><span class="line"></span><br><span class="line">ä¾‹å¦‚ï¼š exports.add = function()&#123;</span><br><span class="line"></span><br><span class="line">var sum = 0;</span><br><span class="line"></span><br><span class="line">var i = 0;</span><br><span class="line"></span><br><span class="line">â€¦.</span><br><span class="line"></span><br><span class="line">return sum;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ï¼ˆexportså’Œmodule.exportsåŒºåˆ«è§åï¼‰</p><h5 id="æ¨¡å—æ ‡è¯†"><a href="#æ¨¡å—æ ‡è¯†" class="headerlink" title="æ¨¡å—æ ‡è¯†"></a>æ¨¡å—æ ‡è¯†</h5><p>å°±æ˜¯ä¼ ç»™require()çš„å‚æ•°ã€‚å®ƒå¿…é¡»ç¬¦åˆå°é©¼å³°å‘½åçš„å­—ç¬¦ä¸²ï¼Œæˆ–è€…ä»¥ã€‚ï¼Œã€‚ã€‚å¼€å¤´çš„ç›¸å¯¹è·¯å¾„ï¼Œæˆ–è€…ç»å¯¹è·¯å¾„ã€‚å¯ä»¥æœ‰æˆ–è€…æ²¡æœ‰æ–‡ä»¶åç¼€åï¼ˆæœ€å¥½æœ‰åç¼€ï¼Œp&#x2F;17ï¼‰.</p><p>æ¨¡å—æ ‡è¯†åˆ†ç±»:</p><ul><li>æ ¸å¿ƒæ¨¡å—ï¼Œå¦‚http, fs, pathç­‰ã€‚</li><li>.æˆ–è€…..å¼€å§‹çš„ç›¸å¯¹è·¯å¾„æ–‡ä»¶æ¨¡å—ã€‚</li><li>ä»¥&#x2F;å¼€å§‹çš„ç»å¯¹è·¯å¾„æ–‡ä»¶æ¨¡å—ã€‚</li><li>éè·¯å¾„å½¢å¼çš„æ–‡ä»¶æ¨¡å—ï¼Œå¦‚è‡ªå®šä¹‰çš„connectæ¨¡å—ã€‚</li></ul><h5 id="Nodeä¸­å¼•å…¥æ¨¡å—æ­¥éª¤"><a href="#Nodeä¸­å¼•å…¥æ¨¡å—æ­¥éª¤" class="headerlink" title="Nodeä¸­å¼•å…¥æ¨¡å—æ­¥éª¤"></a>Nodeä¸­å¼•å…¥æ¨¡å—æ­¥éª¤</h5><p>ï¼ˆæ‰¾æ–‡ä»¶-&gt;æ‰¾æ–‡ä»¶æ‰©å±•å-&gt;ç¼–è¯‘æ‰§è¡Œï¼‰</p><ol><li>è·¯å¾„åˆ†æï¼šå®šä½æ–‡ä»¶ä½ç½®ï¼Œæ ‡è¯†ç¬¦ä¸­æœ‰è·¯å¾„ï¼Œç”šè‡³æ²¡æœ‰ã€‚</li><li>æ–‡ä»¶å®šä½ï¼šæ ‡è¯†ç¬¦ä¸­æ²¡æœ‰æ–‡ä»¶æ‰©å±•åï¼Œæ‰€ä»¥éœ€è¦ç¡®å®šç±»å‹ã€‚</li><li>ç¼–è¯‘æ‰§è¡Œï¼šä¸åŒæ–‡ä»¶ç±»å‹ï¼Œè½½å…¥æ–¹å¼ä¸ä¸€æ ·ã€‚</li></ol><h5 id="Nodeä¸­æ¨¡å—åˆ†ç±»"><a href="#Nodeä¸­æ¨¡å—åˆ†ç±»" class="headerlink" title="Nodeä¸­æ¨¡å—åˆ†ç±»"></a>Nodeä¸­æ¨¡å—åˆ†ç±»</h5><ol><li>æ ¸å¿ƒæ¨¡å—ï¼ˆNodeæä¾›ï¼‰ï¼šæ ¸å¿ƒæ¨¡å—åœ¨Nodeæºä»£ç çš„ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘è¿›äº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨Nodeè¿›ç¨‹å¯åŠ¨æ—¶ï¼Œéƒ¨åˆ†æ ¸å¿ƒæ¨¡å—å°±è¢«åŠ è½½è¿›å†…å­˜ä¸­ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†æ ¸å¿ƒæ¨¡å—å¼•å…¥æ—¶ï¼Œæ–‡ä»¶å®šä½å’Œç¼–è¯‘æ‰§è¡Œä¸¤æ­¥çœç•¥æ‰ï¼Œä¸”åœ¨è·¯å¾„åˆ†ææ—¶ä¼˜å…ˆåˆ¤æ–­ï¼Œæ‰€ä»¥æ ¸å¿ƒæ¨¡å—åŠ è½½é€Ÿåº¦æ˜¯æœ€å¿«çš„ã€‚</li><li>æ–‡ä»¶æ¨¡å—ï¼ˆç”¨æˆ·ç¼–å†™ï¼‰ï¼šåœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œä¸‰æ­¥éª¤éƒ½éœ€è¦ã€‚<br>Nodeå¯¹å¼•ç”¨è¿‡çš„æ¨¡å—éƒ½ä¼šè¿›è¡Œç¼“å­˜ï¼Œä»¥å‡å°‘äºŒæ¬¡å¼•å…¥æ—¶çš„å¼€é”€ã€‚</li></ol><h5 id="æ¨¡å—è·¯å¾„åˆ†æç­–ç•¥"><a href="#æ¨¡å—è·¯å¾„åˆ†æç­–ç•¥" class="headerlink" title="æ¨¡å—è·¯å¾„åˆ†æç­–ç•¥"></a>æ¨¡å—è·¯å¾„åˆ†æç­–ç•¥</h5><p>å³nodeåœ¨å®šä½æ–‡ä»¶æ¨¡å—çš„å…·ä½“æ–‡ä»¶æ—¶æŒ‡å®šçš„æŸ¥æ‰¾ç­–ç•¥ã€‚å…¶ç­–ç•¥æ˜¯ä»å½“å‰node-moduleså¼€å§‹ä¸€çº§ä¸€çº§å‘æ ¹çš„node-modulesæŸ¥æ‰¾ï¼Œæ ¸å¿ƒæ¨¡å—æœ€å¿«ï¼Œç›¸å¯¹ã€ç»å¯¹è·¯å¾„æ¨¡å—æ¬¡ä¹‹ï¼Œè‡ªå®šä¹‰æ–‡ä»¶æ¨¡å—æœ€æ…¢ã€‚<br>æ‰€ä»¥å¼•ç”¨æ¨¡å—æ—¶ï¼Œæœ€å¥½åŠ ä¸Šè·¯å¾„ä»¥åŠæ‰©å±•åï¼</p><h5 id="æ–‡ä»¶å®šä½ç­–ç•¥"><a href="#æ–‡ä»¶å®šä½ç­–ç•¥" class="headerlink" title="æ–‡ä»¶å®šä½ç­–ç•¥"></a>æ–‡ä»¶å®šä½ç­–ç•¥</h5><ul><li>å› ä¸ºæ¨¡å—æ ‡è¯†ç¬¦ä¸­å¯ä»¥ä¸åŒ…å«æ–‡ä»¶æ‰©å±•åï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒNodeä¼šæŒ‰ç…§.js, .json, .nodeçš„æ¬¡åºè¡¥è¶³æ‰©å±•åï¼Œä¾æ¬¡å°è¯•ã€‚åœ¨å°è¯•çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è°ƒfsæ¨¡å—çš„åŒæ­¥é˜»å¡å¼çš„åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥æœ€å¥½ä¼ å…¥æ–‡ä»¶æ‰©å±•åã€‚</li><li>requireï¼ˆï¼‰é€šè¿‡åˆ†ææ–‡ä»¶æ‰©å±•ä¹‹åï¼Œå¯èƒ½æ²¡æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œä½†å´å¾—åˆ°äº†ä¸€ä¸ªç›®å½•ï¼Œæ­¤æ—¶nodeä¼šå°†ç›®å½•å½“åšä¸€ä¸ªåŒ…æ¥å‡ºæ¥ï¼ˆnodeå¯¹åŒ…å¤„ç†ä¼šéµå®ˆCommonJSåŒ…è§„èŒƒï¼‰ã€‚</li><li>Nodeä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶æ¨¡å—éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®šä½åˆ°å…·ä½“çš„æ–‡ä»¶åï¼ŒNodeä¼šæ–°å»ºä¸€ä¸ªæ¨¡å—å¯¹è±¡ï¼Œç„¶åæ ¹æ®è·¯å¾„è½½å…¥å¹¶ç¼–è¯‘ã€‚ä¸åŒçš„æ–‡ä»¶æ‰©å±•åï¼Œå…¶è½½å…¥å’Œç¼–è¯‘çš„æ–¹æ³•ä¹Ÿä¸ä¸€æ ·ï¼š</li><li>.jsæ–‡ä»¶ï¼šé€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åç¼–è¯‘æ‰§è¡Œã€‚</li><li>.nodeæ–‡ä»¶ï¼šè¿™æ˜¯C&#x2F;C++ç¼–å†™çš„æ‰©å±•æ–‡ä»¶ï¼Œé€šè¿‡process.dlopenï¼ˆï¼‰æ–¹æ³•åŠ è½½å’Œæ‰§è¡Œã€‚å®ƒä¸éœ€è¦ç¼–è¯‘ï¼Œå› ä¸ºå®ƒæ˜¯ç¼–å†™C&#x2F;C++æ¨¡å—ä¹‹åç¼–è¯‘ç”Ÿæˆçš„. C&#x2F;C++å¸¦æ¥çš„ä¼˜åŠ¿ä¸»è¦æ˜¯æ‰§è¡Œæ•ˆç‡æ–¹é¢çš„ã€‚</li><li>.jsonæ–‡ä»¶ï¼šé€šè¿‡fsæ¨¡å—åŒæ­¥è¯»å–æ–‡ä»¶åï¼Œç”¨JSON.parse()è§£æè¿”å›ç»“æœã€‚</li><li>.å…¶ä½™æ‰©å±•åæ–‡ä»¶ï¼šå½“åš.jsæ–‡ä»¶å¤„ç†ã€‚</li><li>JSæ¨¡å—ä¸­require, exports, moduleè¿™ä¸‰ä¸ªå˜é‡åœ¨æ¨¡å—ä¸­å¹¶æ²¡æœ‰å®šä¹‰ï¼Œæ˜¯nodeåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ç»™åŠ ä¸Šçš„ï¼Œè¿™æ ·æ¯ä¸ªæ¨¡å—ä¸­è¿™ä¸‰ä¸ªå˜é‡çš„ä½œç”¨åŸŸæ˜¯éš”ç¦»çš„ã€‚</li><li>exportså’Œmodule.exportsåŒºåˆ«ï¼š</li><li>exportsæŒ‡å‘module.exportsçš„å¼•ç”¨, requireï¼ˆï¼‰è¿”å›çš„æ˜¯module.exportsè€Œä¸æ˜¯exports.å¦‚æœmodule.exportsæŒ‡å‘äº†ä¸€ä¸ªæ–°å¯¹è±¡åˆ™exportsåˆ™æ–­å¼€äº†å¯¹module.exportsçš„å¼•ç”¨ã€‚åˆšå¼€å§‹module.exportsä¸ºç©ºå¯¹è±¡ï¼Œæ‰€ä»¥exportsæ”¶é›†çš„å±æ€§å’Œæ–¹æ³•éƒ½èµ‹ç»™module.exportsï¼Œè€Œä¸€æ—¦module.exportsæœ‰äº†å±æ€§ï¼Œæ–¹æ³•ï¼Œåˆ™exportsæ”¶é›†çš„ä¿¡æ¯å°†è¢«å¿½ç•¥ï¼Œæ‰€ä»¥åœ¨ä¸è°ƒç”¨module.exportsæ—¶ï¼Œé‡‡ç”¨exports.</li><li>Nodeçš„æ ¸å¿ƒæ¨¡å—åœ¨ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ä¸­è¢«ç¼–è¯‘è¿›äº†äºŒè¿›åˆ¶æ–‡ä»¶ã€‚æ ¸å¿ƒæ¨¡å—åˆ†ä¸ºC&#x2F;C++ç¼–å†™çš„å’ŒJSç¼–å†™çš„ä¸¤éƒ¨åˆ†ã€‚è€Œåœ¨ç¼–è¯‘æ‰€æœ‰çš„C&#x2F;C++æ–‡ä»¶ä¹‹å‰ï¼Œç¼–è¯‘ç¨‹åºéœ€è¦å°†æ‰€æœ‰çš„JSæ¨¡å—æ–‡ä»¶ç¼–è¯‘ä¸ºC&#x2F;C++ä»£ç ã€‚</li></ul><h4 id="åŒ…"><a href="#åŒ…" class="headerlink" title="åŒ…"></a>åŒ…</h4><p>åŒ…å’ŒNPMæ˜¯å°†æ¨¡å—è”ç³»èµ·æ¥çš„ä¸€ç§æœºåˆ¶</p><p>åŒ…ç»„ç»‡æ¨¡å—ç¤ºæ„å›¾ï¼š<br><img src="http://cdn-qiniu-blog.jajabjbj.top/15271192559496.jpg"><br>åŒ…å®é™…ä¸Šæ˜¯ä¸€ä¸ªå­˜æ¡£æ–‡ä»¶ï¼Œå³ä¸€ä¸ªç›®å½•ç›´æ¥æ‰“åŒ…ä¸º.zipï¼Œå®‰è£…è§£å‹è¿˜åŸä¸ºç›®å½•ã€‚</p><h5 id="åŒ…ç»“æ„ï¼š"><a href="#åŒ…ç»“æ„ï¼š" class="headerlink" title="åŒ…ç»“æ„ï¼š"></a>åŒ…ç»“æ„ï¼š</h5><ul><li>package.json:åŒ…æè¿°æ–‡ä»¶ã€‚ï¼ˆè¯¦ç»†è¯´æ˜p&#x2F;35ï¼‰</li><li>bin:ç”¨äºå­˜æ”¾å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶çš„ç›®å½•ã€‚</li><li>Lib:ç”¨äºå­˜æ”¾jsä»£ç çš„ç›®å½•ã€‚</li><li>Doc:å­˜æ”¾æ–‡æ¡£çš„ç›®å½•ã€‚</li><li>Test:å­˜æ”¾å•å…ƒæµ‹è¯•ç”¨ä¾‹çš„ä»£ç ã€‚</li></ul><h4 id="äº§å“åŒ–"><a href="#äº§å“åŒ–" class="headerlink" title="äº§å“åŒ–"></a>äº§å“åŒ–</h4><h5 id="æ„å»ºå·¥å…·"><a href="#æ„å»ºå·¥å…·" class="headerlink" title="æ„å»ºå·¥å…·"></a>æ„å»ºå·¥å…·</h5><p>æ„å»ºå·¥å…·å®Œæˆçš„åŠŸèƒ½ä¸»è¦æ˜¯åˆå¹¶é™æ€æ–‡ä»¶ï¼Œå‹ç¼©æ–‡ä»¶å¤§å°ï¼Œæ‰“åŒ…åº”ç”¨ï¼Œç¼–è¯‘æ¨¡å—ç­‰ã€‚Gruntæ˜¯è·¨å¹³å°çš„æ„å»ºå·¥å…·ï¼Œå®ƒé€šè¿‡Nodeå†™æˆï¼Œå€ŸåŠ©Nodeçš„è·¨å¹³å°èƒ½åŠ›ï¼Œå®ç°äº†å¾ˆå¥½çš„å¹³å°å…¼å®¹æ€§ã€‚<br>ä»£ç æ£€æµ‹å·¥å…·JSLint<br>å¯ä»¥é€šè¿‡gitlabç­‰å¼€æºå·¥å…·æ­å»ºäº†å†…éƒ¨çš„ä»£ç æ‰˜ç®¡å¹³å°ã€‚</p><h5 id="Nodeæå‡æ€§èƒ½çš„4ä¸ªæ–¹æ³•ï¼š"><a href="#Nodeæå‡æ€§èƒ½çš„4ä¸ªæ–¹æ³•ï¼š" class="headerlink" title="Nodeæå‡æ€§èƒ½çš„4ä¸ªæ–¹æ³•ï¼š"></a>Nodeæå‡æ€§èƒ½çš„4ä¸ªæ–¹æ³•ï¼š</h5><ol><li>åŠ¨é™åˆ†ç¦»ï¼šnodeå¤„ç†é™æ€æ–‡ä»¶çš„èƒ½åŠ›ä¸ç®—çªå‡ºã€‚å°†å›¾ç‰‡ï¼Œè„šæœ¬ï¼Œæ ·å¼è¡¨å’Œå¤šåª’ä½“ç­‰é™æ€æ–‡ä»¶éƒ½å¯¼å…¥åˆ°ä¸“ä¸šçš„é™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼ˆæ¯”å¦‚Nginxï¼‰ä¸Š,è®©nodeåªå¤„ç†åŠ¨æ€è¯·æ±‚å³å¯ã€‚</li><li>å¯ç”¨ç¼“å­˜Redisæˆ–Memcached.</li><li>å¤šè¿›ç¨‹æ¶æ„â€“ clusteræ¨¡å—ã€‚</li><li>æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼šå°±ä»»æ„æ•°æ®åº“è€Œè¨€ï¼Œè¯»å–çš„é€Ÿåº¦è¿œè¿œé«˜äºå†™å…¥çš„é€Ÿåº¦ã€‚è€ŒæŸäº›æ•°æ®åº“åœ¨å†™å…¥æ—¶ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œä¼šè¿›è¡Œé”è¡¨æ“ä½œï¼Œè¿™åŒæ—¶ä¼šå½±å“åˆ°è¯»å–çš„é€Ÿåº¦ã€‚ä¸ºäº†æå‡æ€§èƒ½ï¼Œé€šå¸¸ä¼šè¿›è¡Œæ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ï¼Œå°†æ•°æ®åº“è¿›è¡Œä¸»ä»è®¾è®¡ã€‚è¿™æ ·è¯»æ•°æ®æ“ä½œä¸å†å—å†™å…¥çš„å½±å“äº†ã€‚</li></ol><h5 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h5><p>åœ¨nodeä¸­å¯ç”¨connectæä¾›çš„æ—¥å¿—ä¸­é—´ä»¶æ¥è®°å½•è®¿é—®æ—¥å¿—ï¼Œå½“ç„¶æˆ‘ä»¬å¯ä»¥åœ¨Nginxåå‘ä»£ç†é‡Œè®°å½•è®¿é—®æ—¥å¿—ã€‚<br>å¼‚å¸¸æ—¥å¿—çš„å®ç°ï¼šp&#x2F;296-298<br>Nodeé€šè¿‡nodemaileræ¨¡å—å®ç°é‚®ä»¶æŠ¥è­¦ã€‚</p><h4 id="è°ƒè¯•NodeJS"><a href="#è°ƒè¯•NodeJS" class="headerlink" title="è°ƒè¯•NodeJS"></a>è°ƒè¯•NodeJS</h4><p>Nodeè°ƒè¯•å¯ç”¨ä¸‰ç§æ–¹æ³•ï¼šDebugger, console.log()å’ŒNode-Inspector<br>Debugger:éœ€è¦é€šè¿‡debugger;è¯­å¥åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹ã€‚ä½¿ç”¨æ–¹æ³•p&#x2F;310 - 311<br>Node-Insepector:å¯åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œè°ƒè¯• æˆ–è€…å…¬å…±idea å·¥å…·è°ƒè¯•ã€‚</p><h4 id="ç¼–ç¨‹è§„èŒƒ"><a href="#ç¼–ç¨‹è§„èŒƒ" class="headerlink" title="ç¼–ç¨‹è§„èŒƒ"></a>ç¼–ç¨‹è§„èŒƒ</h4><ul><li>ç¼©è¿›ï¼šé‡‡ç”¨ä¸¤ä¸ªç©ºæ ¼è€Œä¸æ˜¯Tab</li><li>å˜é‡å£°æ˜ï¼šæ°¸è¿œç”¨varå£°æ˜å˜é‡</li><li>ç©ºæ ¼ï¼šæ“ä½œç¬¦å‰åéœ€è¦åŠ ç©ºæ ¼</li><li>å•åŒå¼•å·çš„ä½¿ç”¨ï¼šå°½é‡ä½¿ç”¨å•å¼•å·ï¼Œè¿™æ ·æ— éœ€è½¬è¯‘</li><li>å¤§æ‹¬å·çš„ä½ç½®ï¼šå¤§æ‹¬å·{æ— éœ€å¦èµ·ä¸€è¡Œ</li><li>é€—å·ï¼šå¦‚æœé€—å·ä¸åœ¨è¡Œç»“å°¾ï¼Œåé¢éœ€è¦ä¸€ä¸ªç©ºæ ¼</li><li>åˆ†å·ï¼šç»™è¡¨è¾¾å¼ç»“å°¾æ·»åŠ åˆ†å·</li><li>å˜é‡å‘½åï¼šå°é©¼å³°å¼</li><li>æ–¹æ³•å‘½åï¼šå°é©¼å³°å¼</li><li>ç±»å‘½åï¼šå¤§é©¼å³°å¼</li><li>å¸¸é‡å‘½åï¼šæ‰€æœ‰å­—æ¯å¤§å†™ï¼Œä»¥ä¸‹åˆ’çº¿åˆ†å‰²</li><li>æ–‡ä»¶å‘½åï¼šé‡‡ç”¨ä¸‹åˆ’çº¿åˆ†å‰²å•è¯</li></ul><hr>]]></content>
    
    
    <summary type="html">æ·±å…¥æµ…å‡ºNodeJS</summary>
    
    
    
    
    <category term="nodejs" scheme="http://blog.jajabjbj.top/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§</title>
    <link href="http://blog.jajabjbj.top/2018/05/10/2018-05-19/"/>
    <id>http://blog.jajabjbj.top/2018/05/10/2018-05-19/</id>
    <published>2018-05-10T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§"><a href="#JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§" class="headerlink" title="JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§"></a>JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§</h2><h3 id="JavaScriptå¼‚æ­¥ç¼–ç¨‹æœºåˆ¶"><a href="#JavaScriptå¼‚æ­¥ç¼–ç¨‹æœºåˆ¶" class="headerlink" title="JavaScriptå¼‚æ­¥ç¼–ç¨‹æœºåˆ¶"></a>JavaScriptå¼‚æ­¥ç¼–ç¨‹æœºåˆ¶</h3><p>JavaScriptå¼‚æ­¥ç¼–ç¨‹æœºåˆ¶ç®€å•æ¥è¯´å°±æ˜¯ callback æœºåˆ¶å®ç°çš„æ•ˆæœã€‚callbackå½¢å¼çš„ä»£ç å†™å¤æ‚çš„å¼‚æ­¥ç¼–ç¨‹ï¼Œå¾ˆå®¹æ˜“å‡ºç°callbackåœ°ç‹±çš„é—®é¢˜ï¼Œä¸åˆ©äºä»£ç çš„ç»´æŠ¤å’Œç®¡ç†ï¼Œè€ŒPromiseå’Œes6çš„asyncå¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿å¾—å†™å¼‚æ­¥ç¼–ç¨‹ç¼–çš„éå¸¸ç®€å•ã€‚</p><h4 id="Promiseæ˜¯ä»€ä¹ˆ"><a href="#Promiseæ˜¯ä»€ä¹ˆ" class="headerlink" title="Promiseæ˜¯ä»€ä¹ˆ"></a>Promiseæ˜¯ä»€ä¹ˆ</h4><p>ç®€å•æ¥è¯´ï¼ŒPromise ä¸»è¦å°±æ˜¯ä¸ºäº†è§£å†³å¼‚æ­¥å›è°ƒçš„é—®é¢˜ã€‚ç”¨ Promise æ¥å¤„ç†å¼‚æ­¥å›è°ƒä½¿å¾—ä»£ç å±‚æ¬¡æ¸…æ™°ï¼Œä¾¿äºç†è§£ï¼Œä¸”æ›´åŠ å®¹æ˜“ç»´æŠ¤ã€‚å…¶ä¸»æµè§„èŒƒç›®å‰ä¸»è¦æ˜¯ <a href="http://promisesaplus.com/">Promises&#x2F;A+</a> ã€‚<br>Promise åŸç†å¤§æ¦‚å°±ç±»ä¼¼è¿™ä¸ªæ ·å­</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo.1.js</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Promise</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> callback;</span><br><span class="line">    <span class="keyword">let</span> rejectCallback;</span><br><span class="line">    <span class="comment">//ä¸€ä¸ªå®ä¾‹çš„æ–¹æ³•ï¼Œç”¨æ¥æ³¨å†Œå¼‚æ­¥äº‹ä»¶</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">then</span> = <span class="keyword">function</span> (<span class="params">done, errCallback</span>) &#123;</span><br><span class="line">        callback = done;</span><br><span class="line">        rejectCallback = errCallback;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>(resolve);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="title function_">rejectCallback</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>Promise</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">timeout3</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">callback</span>(<span class="string">&#x27;abcd&#x27;</span>)</span><br><span class="line">    &#125;, <span class="number">3000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Promise</span>(timeout3).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">3</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// # console: </span></span><br><span class="line"><span class="comment">// 3 (ä¸‰ç§’åå±å¹•å‡ºç° )</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªæ˜¯ç®€å•çš„æ¨¡æ‹Ÿä¸€ä¸‹Promiseçš„ä»£ç ï¼Œè¿˜æœ‰ä¸€ä¸‹Promiseçš„apiæ²¡æœ‰å…¨éƒ¨å®ç°ï¼Œå¯ä»¥å»æ·±å…¥ç ”ç©¶Promiseçš„æºç ï¼Œææ‡‚ Promiseçš„ å®ç°åŸç†ï¼Œèƒ½æ”¹ä½¿ç”¨Promiseç¼–ç¨‹æ›´åŠ å¾—å¿ƒåº”æ‰‹çš„.</p><h3 id="ä½¿ç”¨Promiseå°è£…-node-çš„-http-requestæ–¹æ³•ï¼Œå®ç°ç®€å•çš„-fetch-api-æ•ˆæœ"><a href="#ä½¿ç”¨Promiseå°è£…-node-çš„-http-requestæ–¹æ³•ï¼Œå®ç°ç®€å•çš„-fetch-api-æ•ˆæœ" class="headerlink" title="ä½¿ç”¨Promiseå°è£… node çš„ http.requestæ–¹æ³•ï¼Œå®ç°ç®€å•çš„ fetch api æ•ˆæœ"></a>ä½¿ç”¨<code>Promise</code>å°è£… node çš„ <code>http.request</code>æ–¹æ³•ï¼Œå®ç°ç®€å•çš„ <code>fetch</code> api æ•ˆæœ</h3><h4 id="å°è£…fetch-API"><a href="#å°è£…fetch-API" class="headerlink" title="å°è£…fetch API"></a>å°è£…<code>fetch</code> API</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo.2.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> http=<span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetch</span> = (<span class="params">url,fetchOptions = &#123;&#125;</span>) =&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> match = <span class="regexp">/((http|ftp|https):\/\/)((([a-zA-Z0-9\._-]+\.[a-zA-Z]&#123;2,6&#125;)|([0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;))(:[0-9]&#123;1,4&#125;)*(\/[a-zA-Z0-9\&amp;\%_\.\/-~-]*)?)/</span>;</span><br><span class="line">        <span class="keyword">const</span> matchObj = match.<span class="title function_">exec</span>(url);</span><br><span class="line">        <span class="keyword">if</span>(!matchObj)&#123;</span><br><span class="line">            <span class="title function_">reject</span>(&#123;</span><br><span class="line">                <span class="attr">message</span>: url+<span class="string">&#x27;åŸŸåæ ¼å¼ä¸æ­£ç¡®&#x27;</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> [,,,,,hostname,,,,path] = matchObj;</span><br><span class="line">        <span class="keyword">var</span> options = &#123;</span><br><span class="line">            <span class="string">&quot;method&quot;</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">            hostname,</span><br><span class="line">            path,</span><br><span class="line">        &#125;;  </span><br><span class="line">        <span class="keyword">var</span> req = http.<span class="title function_">request</span>(options, <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> chunks = [];</span><br><span class="line">        </span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="keyword">function</span> (<span class="params">chunk</span>) &#123;</span><br><span class="line">                chunks.<span class="title function_">push</span>(chunk);</span><br><span class="line">            &#125;);</span><br><span class="line">        </span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">reject</span>(e);</span><br><span class="line">            &#125;)</span><br><span class="line">        </span><br><span class="line">            res.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> body = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(chunks);</span><br><span class="line">                <span class="title function_">resolve</span>(&#123;</span><br><span class="line">                    <span class="attr">json</span>:<span class="function">()=&gt;</span><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(body.<span class="title function_">toString</span>())),</span><br><span class="line">                    <span class="attr">blob</span>: <span class="function">()=&gt;</span><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(body),</span><br><span class="line">                    <span class="attr">text</span>: <span class="function">()=&gt;</span><span class="title class_">Promise</span>.<span class="title function_">resolve</span>(body.<span class="title function_">toString</span>()),</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">        req.<span class="title function_">end</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ç®€å•çš„è°ƒç”¨fetch"><a href="#ç®€å•çš„è°ƒç”¨fetch" class="headerlink" title="ç®€å•çš„è°ƒç”¨fetch"></a>ç®€å•çš„è°ƒç”¨<code>fetch</code></h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://www.mmjpg.com/&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>data.<span class="title function_">text</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">str</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">// è¾“å‡ºç½‘é¡µæºç </span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(str);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><h4 id="fetché“¾å¼è°ƒç”¨"><a href="#fetché“¾å¼è°ƒç”¨" class="headerlink" title="fetché“¾å¼è°ƒç”¨"></a><code>fetch</code>é“¾å¼è°ƒç”¨</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo.3.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;./demo.2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;http://www.mmjpg.com/&#x27;</span>)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> data.<span class="title function_">text</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">content</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="regexp">/(http:\/\/www.mmjpg.com\/mm\/\d+)/</span>.<span class="title function_">exec</span>(content)[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fetch</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>data.<span class="title function_">text</span>())</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123; </span><br><span class="line">                <span class="keyword">const</span> n = <span class="regexp">/var\s*picinfo\s*=\s*\[(\d+),(\d+),(\d+),(\d+)\]/</span>.<span class="title function_">exec</span>(data)[<span class="number">3</span>];</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(n);</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123;<span class="attr">length</span>: n&#125;).<span class="title function_">map</span>(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> url+<span class="string">&#x27;/&#x27;</span>+(index+<span class="number">1</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">imageUrls</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(imageUrls);</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// # console:</span></span><br><span class="line"><span class="comment">// 60</span></span><br><span class="line"><span class="comment">// [ &#x27;http://www.mmjpg.com/mm/1355/1&#x27;,</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">//   &#x27;http://www.mmjpg.com/mm/1355/59&#x27;,</span></span><br><span class="line"><span class="comment">//   &#x27;http://www.mmjpg.com/mm/1355/60&#x27; ]</span></span><br></pre></td></tr></table></figure><h4 id="fetchæŒ‰é¡ºåºæ‰¹é‡è·å–urlå†…å®¹"><a href="#fetchæŒ‰é¡ºåºæ‰¹é‡è·å–urlå†…å®¹" class="headerlink" title="fetchæŒ‰é¡ºåºæ‰¹é‡è·å–urlå†…å®¹"></a><code>fetch</code>æŒ‰é¡ºåºæ‰¹é‡è·å–urlå†…å®¹</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo.4.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;./demo.2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> imgUrls = [<span class="string">&#x27;http://www.mmjpg.com/mm/1355/1&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/2&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/3&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/4&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/7&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/8&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/57&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/58&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/59&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/60&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchImg</span> = (<span class="params">urls, index=<span class="number">0</span>, currentResult = []</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> url = urls[index];</span><br><span class="line">    <span class="keyword">if</span> (url) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fetch</span>(url)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> data.<span class="title function_">blob</span>())</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">buffer</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Progress: &#x27;</span> + index + <span class="string">&#x27;/&#x27;</span> + urls.<span class="property">length</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">fetchImg</span>(urls, index + <span class="number">1</span>, [...currentResult, buffer])</span><br><span class="line">            &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(currentResult);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchImg</span>(imgUrls)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">bufferList</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// save imgBuffer to file...</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(bufferList.<span class="property">length</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line"><span class="comment">// console: </span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Progress: 0/60</span></span><br><span class="line"><span class="comment">Progress: 1/60</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">Progress: 58/60</span></span><br><span class="line"><span class="comment">Progress: 59/60</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h4 id="ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹Promise-allä¼˜åŒ–åçš„æ•ˆæœ"><a href="#ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹Promise-allä¼˜åŒ–åçš„æ•ˆæœ" class="headerlink" title="ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹Promise.allä¼˜åŒ–åçš„æ•ˆæœ"></a>ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹<code>Promise.all</code>ä¼˜åŒ–åçš„æ•ˆæœ</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo.5.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;./demo.2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> imgUrls = [<span class="string">&#x27;http://www.mmjpg.com/mm/1355/1&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/2&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/3&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/4&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/5&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/6&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/57&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/58&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/59&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/60&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>(imgUrls.<span class="title function_">map</span>(<span class="function"><span class="params">url</span>=&gt;</span><span class="title function_">fetch</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>data.<span class="title function_">blob</span>())))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">bufferList</span>=&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// save imgBuffer to file...</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(bufferList.<span class="property">length</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="es6ä¸­asyncä½¿ç”¨-Promise-all"><a href="#es6ä¸­asyncä½¿ç”¨-Promise-all" class="headerlink" title="es6ä¸­asyncä½¿ç”¨ Promise.all"></a>es6ä¸­asyncä½¿ç”¨ Promise.all</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// demo.6.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">&#x27;./demo.2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> imgUrls = [<span class="string">&#x27;http://www.mmjpg.com/mm/1355/1&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/2&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/3&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/4&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/5&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/6&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/7&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/8&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/9&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/10&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/11&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/12&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/13&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/14&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/15&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/16&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/17&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/18&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/19&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/20&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/21&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/22&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/23&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/24&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/25&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/26&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/27&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/28&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/29&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/30&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/31&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/32&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/33&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/34&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/35&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/36&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/37&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/38&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/39&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/40&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/41&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/42&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/43&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/44&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/45&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/46&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/47&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/48&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/49&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/50&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/51&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/52&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/53&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/54&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/55&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/56&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/57&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/58&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/59&#x27;</span>, <span class="string">&#x27;http://www.mmjpg.com/mm/1355/60&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span>  <span class="title function_">fetAllData</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> bufferList = <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(imgUrls.<span class="title function_">map</span>(<span class="function"><span class="params">url</span>=&gt;</span><span class="title function_">fetch</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">data</span>=&gt;</span>data.<span class="title function_">blob</span>())));</span><br><span class="line">    <span class="comment">// save imgBuffer to file...</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(bufferList.<span class="property">lenght</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetAllData</span>();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">JavaScriptå¼‚æ­¥ç¼–ç¨‹çš„æœºåˆ¶å’Œç›¸å…³ç¼–ç¨‹æŠ€å·§</summary>
    
    
    
    
    <category term="javascript" scheme="http://blog.jajabjbj.top/tags/javascript/"/>
    
  </entry>
  
  <entry>
    <title>ç”¨ jest + gitlab-ci æ­å»ºå‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒ</title>
    <link href="http://blog.jajabjbj.top/2018/05/09/2018-05-21/"/>
    <id>http://blog.jajabjbj.top/2018/05/09/2018-05-21/</id>
    <published>2018-05-09T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç”¨-jest-gitlab-ci-æ­å»ºå‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒ"><a href="#ç”¨-jest-gitlab-ci-æ­å»ºå‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒ" class="headerlink" title="ç”¨ jest + gitlab-ci æ­å»ºå‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒ"></a>ç”¨ jest + gitlab-ci æ­å»ºå‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒ</h2><h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä¸‹é¢ä»¥ githubåˆ›å»ºä»“åº“ä¸ºä¾‹ æµ‹è¯•é¢†åŸŸä¸­æ¯”è¾ƒéº»çƒ¦çš„å°±æ˜¯å‰ç«¯UIæµ‹è¯•<br>gitlabåœ°å€ï¼š <a href="https://gitlab.com/yunqiangwu/devops-test.git">https://gitlab.com/yunqiangwu/devops-test.git</a></p><h4 id="å‰ç½®è¦æ±‚"><a href="#å‰ç½®è¦æ±‚" class="headerlink" title="å‰ç½®è¦æ±‚"></a>å‰ç½®è¦æ±‚</h4><ul><li>æ‹¥æœ‰gitlabè´¦å·(å…¬å¸å†…éƒ¨çš„ä¹Ÿå¯ä»¥)</li><li>gitlab å·²ç»é…ç½®äº† CI Runner(å…·ä½“æ–¹æ³•ç™¾åº¦)</li></ul><h4 id="åŠŸèƒ½å®ç°æ•ˆæœ"><a href="#åŠŸèƒ½å®ç°æ•ˆæœ" class="headerlink" title="åŠŸèƒ½å®ç°æ•ˆæœ"></a>åŠŸèƒ½å®ç°æ•ˆæœ</h4><ul><li>ä¿®æ”¹è¿‡æµ‹è¯•ç”¨ä¾‹åpushè§¦å‘è‡ªåŠ¨æµ‹è¯•</li><li>æµ‹è¯•å®Œæˆåç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</li><li>æµ‹è¯•æŠ¥å‘Šéƒ¨ç½²åˆ° git pages ä¸Š</li><li>å‘é€é‚®ä»¶é€šçŸ¥æµ‹è¯•ç»“æœï¼Œä»¥åŠæŠ¥å‘ŠæŸ¥çœ‹é“¾æ¥</li></ul><p>å…ˆçœ‹ä¸‹æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­çš„æ•ˆæœï¼Œä¸‹é¢æ˜¯æˆ‘æ”¶åˆ°çš„è‡ªåŠ¨åŒ–æµ‹è¯•å®Œæˆåçš„é‚®ä»¶ï¼š<br><img src="http://cdn-qiniu-blog.jajabjbj.top/15268391312100.jpg"></p><blockquote><p><a href="http://preview.ant.jajabjbj.top/index.html">é¢„è§ˆåœ°å€</a><br><a href="http://preview.ant.jajabjbj.top/test-report/reporter.html">è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Š</a><br><a href="http://preview.ant.jajabjbj.top/coverage/lcov-report/index.html">æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š</a>  </p></blockquote><h3 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> devops-test</span><br><span class="line"><span class="built_in">cd</span> devops-test</span><br><span class="line">npm init <span class="comment"># åˆå§‹åŒ– `node` é¡¹ç›® </span></span><br><span class="line"><span class="comment"># è¿™é‡Œä¼šè¦ä½ è¾“å…¥ä¿¡æ¯ï¼ŒèŠ‚çº¦æ—¶é—´ï¼Œä¸€è·¯å›è½¦</span></span><br><span class="line"><span class="comment"># ä¸‹é¢çš„æ“ä½œæˆ‘ç”¨çš„æ˜¯cnpm </span></span><br><span class="line">cnpm i jest jest-report nightmare --save</span><br><span class="line">cnpm i babel-jest babel-plugin-import babel-plugin-transform-class-properties babel-plugin-transform-decorators-legacy babel-plugin-transform-runtime </span><br><span class="line"> babel-preset-env --save-dev</span><br><span class="line"><span class="comment">#  </span></span><br></pre></td></tr></table></figure><p>é‡ç‚¹ä¾èµ–åº“ä»‹ç»ï¼š </p><ul><li>jest æµ‹è¯•æ¡†æ¶</li><li>nightmare æµè§ˆå™¨è¿è¡Œåº“</li><li>jest-report æµ‹è¯•æŠ¥å‘Šç”Ÿäº§åº“</li></ul><h3 id="é…ç½®jestç¯å¢ƒ"><a href="#é…ç½®jestç¯å¢ƒ" class="headerlink" title="é…ç½®jestç¯å¢ƒ"></a>é…ç½®jestç¯å¢ƒ</h3><ol><li>åœ¨ <code>package.json</code> çš„ <code>scripts</code> ä¸­å«å¦‚ test å‘½ä»¤</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;devops-test&quot;</span>,</span><br><span class="line">      <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="string">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;test&quot;</span>: <span class="string">&quot;jest e2e.js&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>åˆ›å»º<code>jasmine</code>é…ç½®æ–‡ä»¶ <code>é¡¹ç›®æ ¹ç›®å½•/tests/jasmine.js</code> é…ç½®æµ‹è¯•è¶…æ—¶æ—¶é—´</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jasmine.<span class="property">DEFAULT_TIMEOUT_INTERVAL</span> = <span class="number">12000</span>; <span class="comment">// åªæœ‰è¿™ä¸€è¡Œå†…å®¹</span></span><br></pre></td></tr></table></figure><ol start="3"><li>åœ¨<code>package.json</code> ä¸­æ·»åŠ ä¸¤ä¸ªå­—æ®µ <code>babel</code> å’Œ <code>jest</code> ,è¿™æ ·å°±èƒ½è·‘ es6 çš„ä»£ç </li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;devops-test&quot;</span>,</span><br><span class="line">  <span class="string">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">  </span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;babel&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;env&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&quot;plugins&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;transform-decorators-legacy&quot;</span>,</span><br><span class="line">      <span class="string">&quot;transform-class-properties&quot;</span>,</span><br><span class="line">      <span class="string">&quot;transform-es2015-destructuring&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;jest&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;testResultsProcessor&quot;</span>: <span class="string">&quot;jest-report&quot;</span>,</span><br><span class="line">    <span class="string">&quot;setupTestFrameworkScriptFile&quot;</span>: <span class="string">&quot;&lt;rootDir&gt;/tests/jasmine.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;testMatch&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;**/?(*.)(spec|test|e2e).js?(x)&quot;</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">      </span><br><span class="line">   <span class="comment">// ...</span></span><br><span class="line">      </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure><h3 id="ç¼–å†™æµ‹è¯•ç”¨ä¾‹"><a href="#ç¼–å†™æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="ç¼–å†™æµ‹è¯•ç”¨ä¾‹"></a>ç¼–å†™æµ‹è¯•ç”¨ä¾‹</h3><p>æµ‹è¯•<code>github</code>ç™»å½•åŠŸèƒ½<code>&lt;rootDir&gt;/src/e2e/test-github-login.e2e.js</code> </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Nightmare</span> <span class="keyword">from</span> <span class="string">&#x27;nightmare&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; helperBuilder &#125; <span class="keyword">from</span> <span class="string">&#x27;jest-report&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;Login&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> page;</span><br><span class="line">    <span class="title function_">beforeEach</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        page = <span class="title class_">Nightmare</span>(&#123; <span class="attr">show</span>: <span class="literal">true</span> &#125;).<span class="title function_">viewport</span>(<span class="number">1024</span>, <span class="number">768</span>);</span><br><span class="line">        page.<span class="title function_">goto</span>(<span class="string">&#x27;https://github.com/login&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// afterEach(() =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//     if(page)&#123;</span></span><br><span class="line">    <span class="comment">//       page.halt();</span></span><br><span class="line">    <span class="comment">//       page = null;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should login with failure&#x27;</span>, <span class="title function_">async</span>() =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> reportHelper = <span class="title function_">helperBuilder</span>(<span class="string">&#x27;Login&#x27;</span>, <span class="string">&#x27;should login with failure&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        reportHelper.<span class="title function_">monitorPage</span>(page);</span><br><span class="line">        <span class="keyword">await</span> page</span><br><span class="line">            .<span class="title function_">type</span>(<span class="string">&#x27;#login_field&#x27;</span>, <span class="string">&#x27;mockuser&#x27;</span>)</span><br><span class="line">            .<span class="title function_">type</span>(<span class="string">&#x27;#password&#x27;</span>, <span class="string">&#x27;wrong_password&#x27;</span>)</span><br><span class="line">            .<span class="title function_">click</span>(<span class="string">&#x27;input[type=&quot;submit&quot;]&#x27;</span>)</span><br><span class="line">            .<span class="title function_">wait</span>(<span class="string">&#x27;#js-flash-container &gt; div &gt; div&#x27;</span>); <span class="comment">// should display error</span></span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">screenshot</span>(reportHelper.<span class="title function_">genPicturePath</span>());</span><br><span class="line">        <span class="keyword">const</span> text = <span class="keyword">await</span> page.<span class="title function_">wait</span>(<span class="string">&#x27;#js-flash-container &gt; div &gt; div&#x27;</span>)</span><br><span class="line">            .evaluate(<span class="function">() =&gt;</span> <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerText</span>)</span><br><span class="line">            .<span class="title function_">end</span>();</span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">end</span>();</span><br><span class="line">        <span class="title function_">expect</span>(text).<span class="title function_">toContain</span>(<span class="string">&#x27;Incorrect username or password&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">it</span>(<span class="string">&#x27;should login successfully&#x27;</span>, <span class="title function_">async</span>() =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> reportHelper = <span class="title function_">helperBuilder</span>(<span class="string">&#x27;Login&#x27;</span>, <span class="string">&#x27;should login successfully&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        reportHelper.<span class="title function_">monitorPage</span>(page);</span><br><span class="line">        <span class="keyword">await</span> page</span><br><span class="line">            .<span class="title function_">type</span>(<span class="string">&#x27;#login_field&#x27;</span>, <span class="string">&#x27;æ­£ç¡®ç”¨æˆ·å&#x27;</span>)</span><br><span class="line">            .<span class="title function_">type</span>(<span class="string">&#x27;#password&#x27;</span>, <span class="string">&#x27;æ­£ç¡®å¯†ç &#x27;</span>)</span><br><span class="line">            .<span class="title function_">click</span>(<span class="string">&#x27;input[type=&quot;submit&quot;]&#x27;</span>)</span><br><span class="line">            .<span class="title function_">wait</span>(<span class="string">&#x27;#your_repos &gt; div &gt; div.boxed-group-action &gt; a&#x27;</span>); <span class="comment">// should display error</span></span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">screenshot</span>(reportHelper.<span class="title function_">genPicturePath</span>());</span><br><span class="line">        <span class="keyword">const</span> title = <span class="keyword">await</span> page</span><br><span class="line">            .evaluate(<span class="function">() =&gt;</span> <span class="variable language_">document</span>.<span class="property">title</span>)</span><br><span class="line">            .<span class="title function_">end</span>();</span><br><span class="line">        <span class="keyword">await</span> page.<span class="title function_">end</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="title function_">expect</span>(title).<span class="title function_">toBe</span>(<span class="string">&#x27;GitHub&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è¿è¡Œæµ‹è¯•ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"><a href="#è¿è¡Œæµ‹è¯•ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š" class="headerlink" title="è¿è¡Œæµ‹è¯•ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"></a>è¿è¡Œæµ‹è¯•ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</h3><h4 id="1-æ‰§è¡Œå‘½ä»¤npm-testï¼Œè¿è¡Œæµ‹è¯•è„šæ­¥"><a href="#1-æ‰§è¡Œå‘½ä»¤npm-testï¼Œè¿è¡Œæµ‹è¯•è„šæ­¥" class="headerlink" title="1. æ‰§è¡Œå‘½ä»¤npm testï¼Œè¿è¡Œæµ‹è¯•è„šæ­¥"></a>1. æ‰§è¡Œå‘½ä»¤<code>npm test</code>ï¼Œè¿è¡Œæµ‹è¯•è„šæ­¥</h4><p><img src="http://cdn-qiniu-blog.jajabjbj.top/15268391890150.jpg"></p><h4 id="2-ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"><a href="#2-ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š" class="headerlink" title="2. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"></a>2. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</h4><pre><code>ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„é»˜è®¤æ˜¯ `&lt;rootDir&gt;/dist/test-report` </code></pre><h4 id="3-æµ‹è¯•æŠ¥å‘Šæ•ˆæœ"><a href="#3-æµ‹è¯•æŠ¥å‘Šæ•ˆæœ" class="headerlink" title="3. æµ‹è¯•æŠ¥å‘Šæ•ˆæœ"></a>3. æµ‹è¯•æŠ¥å‘Šæ•ˆæœ</h4><p><img src="http://cdn-qiniu-blog.jajabjbj.top/15268392221344.jpg"></p><p><img src="http://cdn-qiniu-blog.jajabjbj.top/15268392395160.jpg"></p><h3 id="æ·»åŠ é¡¹ç›®åˆ°gitlab"><a href="#æ·»åŠ é¡¹ç›®åˆ°gitlab" class="headerlink" title="æ·»åŠ é¡¹ç›®åˆ°gitlab"></a>æ·»åŠ é¡¹ç›®åˆ°gitlab</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git remote add origin https://gitlab.com/yunqiangwu/devops-test.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ åˆ°æŒç»­é›†æˆ"><a href="#æ·»åŠ åˆ°æŒç»­é›†æˆ" class="headerlink" title="æ·»åŠ åˆ°æŒç»­é›†æˆ"></a>æ·»åŠ åˆ°æŒç»­é›†æˆ</h3><p>è‡ªåŠ¨éƒ¨ç½²æµ‹è¯•æŠ¥å‘Š åˆ°gitlab pages ç½‘é¡µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i --save-dev gh-pages</span><br></pre></td></tr></table></figure><p>åœ¨ <code>package.json</code> æ·»åŠ <code> scripts</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;test&quot;: &quot;jest e2e.js&quot;,</span><br><span class="line">  &quot;site&quot;: &quot;gh-pages -d dist&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p> é…ç½®é‚®ä»¶é€šçŸ¥å·¥å…·<br> <code>&lt;rootDir&gt;/tool/emailnotice.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">MAIL_FROM=<span class="string">&#x27;supportman@yeah.net&#x27;</span></span><br><span class="line"><span class="comment"># [[ $MAIL_TO == &quot;&quot; ]] &amp;&amp; export MAIL_TO=$1</span></span><br><span class="line">MAIL_TO_ARR_ARG=<span class="variable">$1</span></span><br><span class="line">MAIL_SUBJECT=<span class="variable">$2</span></span><br><span class="line"><span class="built_in">shift</span> 2</span><br><span class="line">MAIL_CONTENT=$*</span><br><span class="line">MAIL_CONTENT_FILE=<span class="string">&quot;/tmp/`/bin/date +%s`.txt&quot;</span></span><br><span class="line">MAIL_SMTP=<span class="string">&#x27;smtp://smtp.yeah.net&#x27;</span></span><br><span class="line">MAIL_USER=<span class="string">&#x27;supportman@yeah.net&#x27;</span></span><br><span class="line">MAIL_PASSWORD=<span class="string">&#x27;wu950429&#x27;</span></span><br><span class="line"></span><br><span class="line">OLD_IFS=<span class="string">&quot;<span class="variable">$IFS</span>&quot;</span></span><br><span class="line"><span class="comment">#è®¾ç½®åˆ†éš”ç¬¦</span></span><br><span class="line">IFS=<span class="string">&quot;,&quot;</span></span><br><span class="line">MAIL_TO_ARR=(<span class="variable">$MAIL_TO_ARR_ARG</span>)</span><br><span class="line">IFS=<span class="string">&quot;<span class="variable">$OLD_IFS</span>&quot;</span></span><br><span class="line"><span class="function"><span class="title">split_1</span></span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  MAIL_TO=<span class="variable">$1</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;å‘é€é‚®ä»¶åˆ°ï¼š&quot;</span><span class="variable">$1</span></span><br><span class="line">  <span class="comment">#  return 0;</span></span><br><span class="line">  <span class="comment"># create mail content file</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;From:<span class="variable">$&#123;MAIL_FROM&#125;</span></span></span><br><span class="line"><span class="string">To:<span class="variable">$MAIL_TO</span></span></span><br><span class="line"><span class="string">Subject: <span class="variable">$MAIL_SUBJECT</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="variable">$MAIL_CONTENT</span></span></span><br><span class="line"><span class="string">&quot;</span>&gt; <span class="variable">$&#123;MAIL_CONTENT_FILE&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># send mail</span></span><br><span class="line">  curl -s --url <span class="string">&quot;<span class="variable">$&#123;MAIL_SMTP&#125;</span>&quot;</span> --mail-from <span class="string">&quot;<span class="variable">$&#123;MAIL_FROM&#125;</span>&quot;</span> --mail-rcpt <span class="variable">$&#123;MAIL_TO&#125;</span> --upload-file <span class="variable">$&#123;MAIL_CONTENT_FILE&#125;</span> --user <span class="string">&quot;<span class="variable">$&#123;MAIL_USER&#125;</span>:<span class="variable">$&#123;MAIL_PASSWORD&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> <span class="variable">$&#123;MAIL_TO_ARR[@]&#125;</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">split_1 <span class="string">&quot;<span class="variable">$s</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf <span class="variable">$&#123;MAIL_CONTENT_FILE&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>gitlab-ci.yml é…ç½®æ–‡ä»¶  <code>.gitlab-ci.yml</code></p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">image:</span> <span class="string">jonneywu/node-xvfb-cnpm</span></span><br><span class="line"></span><br><span class="line"><span class="attr">cache:</span></span><br><span class="line">  <span class="attr">key:</span> <span class="string">&quot;$CI_REPOSITORY_URL&quot;</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">node_modules</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dist</span></span><br><span class="line"></span><br><span class="line"><span class="attr">stages:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">email</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line">   <span class="attr">script:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">if</span> [ <span class="string">!</span> <span class="string">-d</span> <span class="string">node_modules</span> ]<span class="string">;</span> <span class="string">then</span> <span class="string">cnpm</span> <span class="string">i;</span> <span class="string">fi</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">if</span> [ <span class="string">!</span> <span class="string">-d</span> <span class="string">node_modules/nightmare</span> ]<span class="string">;</span> <span class="string">then</span> <span class="string">cnpm</span> <span class="string">i</span> <span class="string">nightmare;</span> <span class="string">fi</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">export</span> <span class="string">DISPLAY=&#x27;:99.0&#x27;</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">Xvfb</span> <span class="string">:99</span> <span class="string">-screen</span> <span class="number">0</span> <span class="string">1024x768x24</span> <span class="string">&gt;</span> <span class="string">/dev/null</span> <span class="number">2</span><span class="string">&gt;&amp;1</span> <span class="string">&amp;</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">test</span> <span class="string">&amp;&amp;</span> <span class="string">echo</span> <span class="string">test</span> <span class="string">FAIL</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">kill</span> <span class="number">-9</span> <span class="string">`ps</span> <span class="string">-ef</span> <span class="string">|</span> <span class="string">grep</span> <span class="string">Xvfb|</span> <span class="string">grep</span> <span class="string">-v</span> <span class="string">grep|awk</span> <span class="string">&#x27;&#123;print $2&#125;&#x27;</span><span class="string">`</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">site</span></span><br><span class="line">   <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">   <span class="attr">only:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">   <span class="attr">artifacts:</span></span><br><span class="line">     <span class="attr">paths:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">dist</span></span><br><span class="line"></span><br><span class="line"><span class="attr">email:</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">echo</span> <span class="string">email</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">if</span> [[ <span class="string">!</span> <span class="string">-n</span> <span class="string">$MAIL_TO</span> ]]<span class="string">;</span> <span class="string">then</span> <span class="string">export</span> <span class="string">MAIL_TO=842269153@qq.com,yunqiang.wu@hand-china.com</span> <span class="string">;</span> <span class="string">fi</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">export</span> <span class="string">root_url=http://`cat</span> <span class="string">CNAME`</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">export</span> <span class="string">test_passed_rate=$(printf</span> <span class="string">&quot;%.2f&quot;</span> <span class="string">`cat</span> <span class="string">dist/test-report/testResultData.json</span> <span class="string">|</span> <span class="string">jq</span> <span class="string">&#x27;100*.numPassedTests/.numTotalTests&#x27;</span><span class="string">`)%</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">bash</span> <span class="string">./tool/emailnotice.sh</span> <span class="string">$MAIL_TO</span> <span class="string">&#x27;å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•&#x27;</span> <span class="string">`echo</span> <span class="string">-e</span> <span class="string">&quot;  æµ‹è¯•åˆ†æ”¯ï¼š $&#123;CI_COMMIT_REF_NAME&#125; \r\n æäº¤äººï¼š$&#123;GITLAB_USER_NAME&#125; \r\n æµ‹è¯•é€šè¿‡ç‡ï¼š$&#123;test_passed_rate&#125; \r\n è§¦å‘æ¥æºï¼š$&#123;CI_PIPELINE_SOURCE&#125; \r\n æµ‹è¯•ç¯å¢ƒï¼šmockApiç¯å¢ƒ \r\n\r\né¢„è§ˆåœ°å€ï¼š $&#123;root_url&#125;/index.html \r\n è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Šï¼š$&#123;root_url&#125;/test-report/reporter.html \r\n æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Šï¼š $&#123;root_url&#125;/coverage/lcov-report/index.html \r\n&quot;</span><span class="string">`</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">email</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">artifacts:</span></span><br><span class="line">    <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">dist</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>react å¼€å‘æ˜¯å¦‚æœç”¨äº†<code>css modules</code>çš„æŠ€æœ¯å¼€å‘æ—¶ï¼Œä¼šæŠŠ class åæ¢æ‰ ï¼Œæµ‹è¯•æ¡†æ¶å°±æ— æ³•é€šè¿‡ <code>css selector</code> æ‰¾åˆ°å¹¶æ“ä½œ Domå…ƒç´ ï¼Œåœ¨å¼€å‘æ—¶ï¼Œå¯ä»¥ä¸ºä¸»è¦æ§åˆ¶çš„domèŠ‚ç‚¹ç»™<code>id</code>ï¼Œ<code>data-custom</code> è‡ªå®šä¹‰å±æ€§ï¼Œæ¯”å¦‚ç”¨æˆ·åè¾“å…¥æ¡†ã€ç™»å½•æŒ‰é’®ï¼Œ</li><li>æˆ‘è¿™é‡Œçš„ä»‹ç»çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œåªæ˜¯æµ‹è¯•ç³»ç»Ÿçš„åŠŸèƒ½äº¤äº’æ˜¯å¦èƒ½æ­£å¸¸ï¼Œå¦‚æœéœ€è¦é è‡ªåŠ¨åŒ–æµ‹è¯•æ¥åˆ¤æ–­UIç•Œé¢çš„æ ·å¼å¯¹æ¯”æ˜¯ç¬¦åˆè¦æ±‚ï¼Œå¯èƒ½è¿˜æ˜¯è¦é äººåŠ›æµ‹è¯•ï¼Œä¸è¿‡æµ‹è¯•çš„ç›®çš„ä¿è¯ç³»ç»ŸåŠŸèƒ½æˆæ­£å¸¸ä½¿ç”¨ä¸å‡ºBUGã€‚</li></ul><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://www.zhihu.com/question/29922082/answer/46141819">å¦‚ä½•è¿›è¡Œå‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ - çŸ¥ä¹</a></li><li><a href="http://ant.jajabjbj.top/docs/ui-test-cn">ANT DESIGN PRO ä¸­çš„ UI æµ‹è¯•</a></li></ul>]]></content>
    
    
    <summary type="html">ç”¨ jest + gitlab-ci æ­å»ºå‰ç«¯UIè‡ªåŠ¨åŒ–æµ‹è¯•ç¯å¢ƒ</summary>
    
    
    
    
    <category term="gitab-ci" scheme="http://blog.jajabjbj.top/tags/gitab-ci/"/>
    
  </entry>
  
  <entry>
    <title>webpackå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–¹æ¡ˆæ€»ç»“</title>
    <link href="http://blog.jajabjbj.top/2018/05/08/2018-05-21-1/"/>
    <id>http://blog.jajabjbj.top/2018/05/08/2018-05-21-1/</id>
    <published>2018-05-08T00:00:00.000Z</published>
    <updated>2022-07-15T16:13:40.425Z</updated>
    
    <content type="html"><![CDATA[<h2 id="webpackå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–¹æ¡ˆæ€»ç»“"><a href="#webpackå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–¹æ¡ˆæ€»ç»“" class="headerlink" title="webpackå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–¹æ¡ˆæ€»ç»“"></a>webpackå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–¹æ¡ˆæ€»ç»“</h2><blockquote><p>åœ¨ä½¿ç”¨webpackæ‰“åŒ…é¡¹ç›®æ—¶ï¼Œæœ€å¥½å°½é‡ä½¿ç”¨importçš„æ–¹å¼å¼•å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œä½†æœ‰äº›æƒ…å†µåˆå¿…é¡»ä½¿ç”¨å…¶ä»–æ–¹å¼å¼•å…¥ç¬¬ä¸‰æ–¹åº“â€¦</p></blockquote><h3 id="è¦é¡¹ç›®ä¸Šå¿…é¡»è¦ç”¨ä¸€ä¸ª-jQuery-æ’ä»¶å½¢å¼çš„åº“"><a href="#è¦é¡¹ç›®ä¸Šå¿…é¡»è¦ç”¨ä¸€ä¸ª-jQuery-æ’ä»¶å½¢å¼çš„åº“" class="headerlink" title="è¦é¡¹ç›®ä¸Šå¿…é¡»è¦ç”¨ä¸€ä¸ª jQuery æ’ä»¶å½¢å¼çš„åº“"></a>è¦é¡¹ç›®ä¸Šå¿…é¡»è¦ç”¨ä¸€ä¸ª jQuery æ’ä»¶å½¢å¼çš„åº“</h3><p>è€Œå¼•å…¥è¿™ä¸ªåº“ä¹‹å‰å¿…é¡»è¦å¼•å…¥jQueryï¼Œå› ä¸ºæ’ä»¶é‡Œé¢å¯èƒ½ä¼šå‡ºç°è¿™æ ·çš„ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line"><span class="keyword">var</span> jQuery = <span class="variable language_">window</span>.<span class="property">jQuery</span>,</span><br><span class="line">\\ ...</span><br><span class="line">\\ ...</span><br><span class="line"><span class="keyword">if</span> (!jQuery) <span class="keyword">throw</span> <span class="string">&#x27;MathQuill requires jQuery 1.4.3+ to be loaded first&#x27;</span>;</span><br><span class="line">\\ ...</span><br><span class="line">\\ ...</span><br><span class="line">\\ ...</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥éœ€è¦åœ¨webpackæ„å»ºçš„é¡¹ç›®ä¸­å¼•å…¥ ç¬¬ä¸‰æ–¹ jsåº“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å¼•å…¥ç¬¬ä¸‰æ–¹åº“æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼</p><h4 id="ç›´æ¥å¼•å…¥"><a href="#ç›´æ¥å¼•å…¥" class="headerlink" title="ç›´æ¥å¼•å…¥"></a>ç›´æ¥å¼•å…¥</h4><p>ç›´æ¥å¼•å…¥çš„å…³é”®åœ¨äºè¾“å‡ºçš„é…ç½®ï¼Œè¿™é‡Œä»¥varä¸ºä¾‹ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> output <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      filename <span class="punctuation">:</span> &#x27;<span class="punctuation">[</span>name<span class="punctuation">]</span>.js&#x27;<span class="punctuation">,</span></span><br><span class="line">       <span class="comment">//  devServerä¸å¯é…ç½®ä¸ºç»å¯¹è·¯å¾„</span></span><br><span class="line">       <span class="comment">//publicPath: &quot;http://localhost:8080/dist/&quot;,</span></span><br><span class="line">       publicPath<span class="punctuation">:</span> <span class="string">&quot;/dist/&quot;</span><span class="punctuation">,</span></span><br><span class="line">       path <span class="punctuation">:</span> build<span class="punctuation">,</span></span><br><span class="line">       <span class="comment">//  umdåŒ…å«äº†å¯¹amdã€commonjsã€varç­‰å¤šç§è§„èŒƒçš„æ”¯æŒ</span></span><br><span class="line">       <span class="comment">//   å…³é”®åœ¨äºè¿™é‡Œ  </span></span><br><span class="line">       libraryTarget <span class="punctuation">:</span> &#x27;var&#x27;  </span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span>  </span><br><span class="line"><span class="comment">//  å…¶ä»–é…ç½®ç•¥</span></span><br><span class="line"> resolve<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">//extensions: [&#x27;&#x27;, &#x27;.js&#x27;, &#x27;.es6&#x27;, &#x27;.vue&#x27;],</span></span><br><span class="line">        alias<span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="comment">//  ä¹Ÿå¯ä»¥ä¸å†™</span></span><br><span class="line">            jquery<span class="punctuation">:</span> &#x27;jquery/dist/jquery.min.js&#x27;<span class="punctuation">,</span>  </span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨ç¼–è¯‘ä»£ç æ—¶ï¼Œwebpackä¼šè‡ªåŠ¨å°†jQueryæ‰“è¿›ä»£ç ï¼Œç°åœ¨å°±å¯ä»¥å¼•å…¥ä»£ç äº†</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¯ä»¥ç›´æ¥å¼•å…¥jquery</span></span><br><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line"><span class="comment">// å› ä¸ºæ˜¯commonjsè§„èŒƒï¼Œæ‰€ä»¥ä¼šæŒ‰é¡ºåºåŠ è½½ï¼Œå¼•ç”¨æˆåŠŸï¼Œå¦‚æœæ˜¯outputä¸ºamdï¼Œåˆ™å¿…é¡»åœ¨requirejsä¸­é…ç½®shimï¼Œå¦åˆ™å¤±è´¥</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;jquery-ui&#x27;</span> </span><br></pre></td></tr></table></figure><h4 id="2-ProvidePlugin-éš¾ä»¥å¼•å…¥æ’ä»¶"><a href="#2-ProvidePlugin-éš¾ä»¥å¼•å…¥æ’ä»¶" class="headerlink" title="2. ProvidePlugin[éš¾ä»¥å¼•å…¥æ’ä»¶]"></a>2. ProvidePlugin[éš¾ä»¥å¼•å…¥æ’ä»¶]</h4><p>åœ¨webpackä¸­æ·»åŠ æ’ä»¶ProvidePlugin</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">ProvidePlugin</span>(&#123;</span><br><span class="line">      <span class="attr">$</span>: <span class="string">&quot;jquery&quot;</span>,</span><br><span class="line">      <span class="attr">jQuery</span>: <span class="string">&quot;jquery&quot;</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line"><span class="comment">//  $å‡½æ•°ä¼šè‡ªåŠ¨æ·»åŠ åˆ°å½“å‰æ¨¡å—çš„ä¸Šä¸‹æ–‡ï¼Œæ— éœ€æ˜¾ç¤ºå£°æ˜</span></span><br></pre></td></tr></table></figure><p>é—®é¢˜æ˜¯ä¾æ—§æ²¡æœ‰å…¨å±€çš„$å‡½æ•°ï¼Œæ‰€ä»¥å¯¼å…¥æ’ä»¶ä¾æ—§ä¼šå¤±è´¥ï¼Œå¹¶ä¸”å¦‚æœæœ‰eslintè¿™æ ·çš„preLoadsï¼Œè°ƒç”¨è¯­å¥ä¹Ÿéš¾ä»¥é€šè¿‡è¯­æ³•æ ¡éªŒ(å› ä¸ºæ²¡æœ‰å£°æ˜$å°±ç›´æ¥ä½¿ç”¨)ï¼Œä»…è¿™ä¸€ç‚¹ï¼Œå¯¹äºæˆ‘è¿™æ ·çš„ä»£ç å¤„å¥³åº§å°±éš¾ä»¥æ¥å—ã€‚</p><h4 id="3-expose-loader-æ¨èä½¿ç”¨"><a href="#3-expose-loader-æ¨èä½¿ç”¨" class="headerlink" title="3. expose-loader[æ¨èä½¿ç”¨]"></a>3. expose-loader[æ¨èä½¿ç”¨]</h4><p>ä¸éœ€è¦ä»»ä½•å…¶ä»–çš„æ’ä»¶é…åˆï¼Œåªè¦å°†ä¸‹é¢çš„ä»£ç æ·»åŠ åˆ°æ‰€æœ‰çš„loaderä¹‹å‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="attr">test</span>: <span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;jquery&#x27;</span>),</span><br><span class="line">   <span class="attr">loader</span>: <span class="string">&#x27;expose?jQuery!expose?$&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¼•ç”¨æ—¶æ”¹ä¸ºå¦‚ä¸‹æ–¹å¼</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;expose?$!jquery&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;jquery-ui&#x27;</span> <span class="comment">//æ’ä»¶å¯ç”¨   </span></span><br></pre></td></tr></table></figure><p> imports-loaderã€script-loaderåŒæ ·å¯è¾¾åˆ°æ­¤æ•ˆæœï¼Œé…ç½®ä¸åŠŸèƒ½éƒ½éå¸¸ç›¸ä¼¼ï¼Œåœ¨æ­¤ä¸ä¸€ä¸€è¯´æ˜ã€‚</p><h4 id="4-åŒ…è£…jquery-æ¨èä½¿ç”¨"><a href="#4-åŒ…è£…jquery-æ¨èä½¿ç”¨" class="headerlink" title="4. åŒ…è£…jquery[æ¨èä½¿ç”¨]"></a>4. åŒ…è£…jquery[æ¨èä½¿ç”¨]</h4><p>æ­¤æ–¹æ³•åªä¾èµ–äºè‡ªå·±ï¼Œå®Œå…¨ä¸éœ€è¦ä»»ä½•å…¶ä»–æ’ä»¶ä¸åŠ è½½å™¨ï¼Œåˆ›å»ºjqueryçš„åŒ…è£…å¯¹è±¡jquery-vendor.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> $ <span class="keyword">from</span> <span class="string">&#x27;jquery&#x27;</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">$</span> = $</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">jQuery</span> = $</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> $</span><br></pre></td></tr></table></figure><p>ä»¥åå¼•ç”¨jqueryæ—¶æŒ‡å‘jquery-vendor.js</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import $ from &#x27;../assets/jquery-vendor.js&#x27;</span><br><span class="line">import &#x27;jquery-ui&#x27;</span><br><span class="line">//  æ­¤æ—¶UIçš„æ–¹æ³•å…¨éƒ¨å¯ç”¨ï¼Œå¦‚æœéœ€è¦å¼•ç”¨bootstrapï¼Œå¯å‚ç…§æ­¤æ–¹æ³•</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è°ƒç”¨æ–¹ä¾¿ï¼Œå¯åœ¨webpacké…ç½®æ–‡ä»¶ä¸­åˆ›å»ºjquery-vendor.jsçš„åˆ«å</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias: &#123;</span><br><span class="line">    jquery        : &#x27;src/assets/jquery-vendor.js&#x27; //    å°†å…¶æŒ‡å‘jquery-vendor.jsæ‰€åœ¨ä½ç½®</span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure><h3 id="2-ç¬¬ä¸‰æ–¹åº“éœ€è¦é€šè¿‡-ç±»ä¼¼requirejsæœºåˆ¶-å¼‚æ­¥åŠ è½½å…¶ä»–ä¾èµ–åº“"><a href="#2-ç¬¬ä¸‰æ–¹åº“éœ€è¦é€šè¿‡-ç±»ä¼¼requirejsæœºåˆ¶-å¼‚æ­¥åŠ è½½å…¶ä»–ä¾èµ–åº“" class="headerlink" title="2. ç¬¬ä¸‰æ–¹åº“éœ€è¦é€šè¿‡ ç±»ä¼¼requirejsæœºåˆ¶ å¼‚æ­¥åŠ è½½å…¶ä»–ä¾èµ–åº“"></a>2. ç¬¬ä¸‰æ–¹åº“éœ€è¦é€šè¿‡ ç±»ä¼¼requirejsæœºåˆ¶ å¼‚æ­¥åŠ è½½å…¶ä»–ä¾èµ–åº“</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™æ˜¯ MathJax æ•°å­¦è¡¨è¾¾å¼è§£æåº“ åŠ è½½æ‰©å±•çš„ä¸€æ®µä»£ç </span></span><br><span class="line"><span class="comment">// è¯¥åº“éœ€è¦åŠ è½½ extensions è€Œä¸”æ˜¯é€šè¿‡åœ¨é¡µé¢æ’å…¥scriptçš„æ–¹å¼åŠ è½½çš„</span></span><br><span class="line"><span class="attr">loader</span>: &#123;</span><br><span class="line">    <span class="attr">JS</span>: <span class="keyword">function</span> (<span class="params">k, m</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> j = <span class="variable language_">this</span>.<span class="title function_">fileName</span>(k);</span><br><span class="line">        <span class="keyword">var</span> i = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> l = a.<span class="title class_">Callback</span>([<span class="string">&quot;loadTimeout&quot;</span>, <span class="variable language_">this</span>, k]);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span>[k] = &#123;</span><br><span class="line">            <span class="attr">callback</span>: m,</span><br><span class="line">            <span class="attr">timeout</span>: <span class="built_in">setTimeout</span>(l, <span class="variable language_">this</span>.<span class="property">timeout</span>),</span><br><span class="line">            <span class="attr">status</span>: <span class="variable language_">this</span>.<span class="property">STATUS</span>.<span class="property">OK</span>,</span><br><span class="line">            <span class="attr">script</span>: i</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span>[k].<span class="property">message</span> = a.<span class="property">Message</span>.<span class="title class_">File</span>(j);</span><br><span class="line">        i.<span class="property">onerror</span> = l;</span><br><span class="line">        i.<span class="property">type</span> = <span class="string">&quot;text/javascript&quot;</span>;</span><br><span class="line">        i.<span class="property">src</span> = k + <span class="variable language_">this</span>.<span class="title function_">fileRev</span>(j);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(i)</span><br><span class="line">    &#125;, <span class="attr">CSS</span>: <span class="keyword">function</span> (<span class="params">j, l</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> i = <span class="variable language_">this</span>.<span class="title function_">fileName</span>(j);</span><br><span class="line">        <span class="keyword">var</span> k = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;link&quot;</span>);</span><br><span class="line">        k.<span class="property">rel</span> = <span class="string">&quot;stylesheet&quot;</span>;</span><br><span class="line">        k.<span class="property">type</span> = <span class="string">&quot;text/css&quot;</span>;</span><br><span class="line">        k.<span class="property">href</span> = j + <span class="variable language_">this</span>.<span class="title function_">fileRev</span>(i);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">loading</span>[j] = &#123;<span class="attr">callback</span>: l, <span class="attr">message</span>: a.<span class="property">Message</span>.<span class="title class_">File</span>(i), <span class="attr">status</span>: <span class="variable language_">this</span>.<span class="property">STATUS</span>.<span class="property">OK</span>&#125;;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(k);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timer</span>.<span class="property">create</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, [<span class="variable language_">this</span>.<span class="property">timer</span>.<span class="property">file</span>, j], k)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>é‡åˆ°è¿™ç§æƒ…å†µï¼Œå°±ä¸èƒ½ç”¨å¸¸è§„çš„æ–¹æ³•å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä»¥ä¸Šçš„æ–¹æ³•éƒ½ä¸é€‚ç”¨ï¼Œå› ä¸ºåœ¨ç¼–è¯‘æœŸé—´ä¸ä¼šå†æŠ¥é”™ ä½†æ˜¯åœ¨è¿è¡ŒæœŸé—´ä¼šæŠ¥ä¸€ä¸ªjsæ–‡ä»¶åŠ è½½404çš„é”™è¯¯ã€‚<br><img src="http://cdn-qiniu-blog.jajabjbj.top/15268396577912.jpg"><br>å› ä¸ºè¿™æ˜¯åœ¨è¿è¡Œä¹‹åé€šè¿‡æ³¨å…¥scriptæ ‡ç­¾ åŠ è½½æ’ä»¶ ã€‚è€Œåœ¨ç¼–è¯‘æ—¶webpackä¸ä¼šæ£€æµ‹åˆ°è¿™ç§å¼‚æ­¥åŠ è½½é€»è¾‘ å¹¶å¯¼å…¥ã€‚</p><p>æˆ‘çš„è§£å†³æ–¹æ¡ˆï¼š<br>    è¦ä½¿èƒ½å¤Ÿé€šè¿‡å¼‚æ­¥åŠ è½½ ï¼Œå¿…é¡»ä¿è¯ æ˜ å…¥çš„åº“ å’Œä»–çš„ä¾èµ–æ–‡ä»¶ ç›¸å¯¹æ–‡ç« ä¸å˜ ï¼Œæ•´ä½“æ”¾åˆ° ç¼–è¯‘åçš„ç›®å½•ã€‚<br>ä»¥å¼•å…¥ MathJax æ•°å­¦è¡¨è¾¾å¼è§£æåº“ä¸ºä¾‹  ç”±äºMathJax çš„åŠ è½½æ‰©å±•ï¼ˆMathMenuï¼‰æ˜¯ç”¨åˆ° ç±»ä¼¼ requirejsçš„å¼‚æ­¥åŠ è½½æœºåˆ¶ ï¼Œæ‰€ä»¥éœ€è¦å¼•å…¥mathquill åªèƒ½é€šè¿‡ script æ ‡ç­¾å¼•å…¥ï¼Œä¸èƒ½é€šè¿‡ import å¼•å…¥ mathquill</p><p>ä¿®æ”¹æ–‡ä»¶å¦‚ä¸‹ï¼š</p><h4 id="1-webpack-config-js"><a href="#1-webpack-config-js" class="headerlink" title="1. webpack.config.js:"></a>1. webpack.config.js:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨ç¼–è¯‘æ‰“åŒ…æ—¶ æŠŠ /src/lib/ä¸‹çš„ jsæ–‡ä»¶å¤åˆ¶åˆ° www(ç¼–è¯‘è¾“å‡ºç›®å½•)/lib ç›®å½•</span><br><span class="line">new CopyWebpackPlugin([ &#123;from: &#x27;./src/lib&#x27;, to: &#x27;lib&#x27;&#125;]),               </span><br></pre></td></tr></table></figure><h4 id="2-index-html"><a href="#2-index-html" class="headerlink" title="2. index.html:"></a>2. index.html:</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./lib/polyvplayer/polyvplayer.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./lib/jquery/dist/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./lib/cat_mathjax/dist/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./lib/cat_mathquill_build/mathquill.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;./lib/cat_mathquill_build/mathquill.css&quot;</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="3-æ·»åŠ æ–‡ä»¶å¤¹ï¼š-x2F-src-x2F-lib"><a href="#3-æ·»åŠ æ–‡ä»¶å¤¹ï¼š-x2F-src-x2F-lib" class="headerlink" title="3. æ·»åŠ æ–‡ä»¶å¤¹ï¼š&#x2F;src&#x2F;lib"></a>3. æ·»åŠ æ–‡ä»¶å¤¹ï¼š&#x2F;src&#x2F;lib</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/src/lib/jquery/ </span><br><span class="line">/src/lib/mathjax/</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">webpackå¼•å…¥ç¬¬ä¸‰æ–¹åº“æ–¹æ¡ˆæ€»ç»“</summary>
    
    
    
    
    <category term="webpack" scheme="http://blog.jajabjbj.top/tags/webpack/"/>
    
  </entry>
  
</feed>
